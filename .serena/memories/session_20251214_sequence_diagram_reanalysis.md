# セッション記録: シーケンス図 再分析（6本→15本）

## 作業日時
2025-12-14

## 背景
- 当初の管理資料では「シーケンス図 6本」と記載
- ユーザーから「10何本必要と言っていた」と指摘を受け、再分析を実施

## 再分析結果

### 分析基準
シーケンス図が必要な条件:
1. 外部システムAPI呼び出しがある
2. 複雑な処理フロー（複数サービス連携）
3. タイミング・順序が重要

### 外部システム一覧（ユースケース図より）
| 外部システム | 接続UC |
|-------------|--------|
| Supabase Auth | UC 1-1, 1-2, 5-1 |
| Supabase Storage | UC 2-1〜2-4, 3-1, 3-5, 3-9 |
| OpenRouter API | UC 3-3, 3-4, 4-1, 4-2, 5-7 |
| OpenAI API (Embedding) | UC 3-10, 5-14 |
| node-plantuml | UC 3-1, 3-3, 3-4, 3-6 |

### シーケンス図 15本（修正後）

#### MVP必須（8本）
| # | シーケンス図 | 対応UC | 外部システム | 状況 |
|:-:|-------------|--------|-------------|:----:|
| 1 | ログイン | UC 1-1, 1-2 | Supabase Auth | ✅ 完了 |
| 2 | プロジェクトCRUD | UC 2-1〜2-4 | Storage API | 🔴 要作成 |
| 3 | 図表作成 | UC 3-1 | Storage + node-plantuml | 🔴 要作成 |
| 4 | 編集プレビュー | UC 3-3, 3-4 | OpenRouter | 🔴 要作成 |
| 5 | 保存 | UC 3-5 | Storage API | 🔴 要作成 |
| 6 | エクスポート | UC 3-6 | node-plantuml | 🔴 要作成 |
| 7 | 図表削除 | UC 3-9 | Storage API | 🔴 要作成 |
| 8 | AI Question-Start | UC 4-1 | OpenRouter | 🔴 要作成 |

#### Phase 2（6本）
| # | シーケンス図 | 対応UC | 外部システム | 状況 |
|:-:|-------------|--------|-------------|:----:|
| 9 | AIチャット | UC 4-2 | OpenRouter | 🔴 要作成 |
| 10 | 学習コンテンツ検索 | UC 3-10 | pgvector + OpenAI | 🔴 要作成 |
| 11 | ユーザー管理 | UC 5-1 | Supabase Auth Admin | 🔴 要作成 |
| 12 | LLMモデル登録 | UC 5-7 | OpenRouter Models API | 🔴 要作成 |
| 13 | LLM使用量監視 | UC 5-11 | 使用量API | 🔴 要作成 |
| 14 | 学習コンテンツ登録 | UC 5-14 | pgvector | 🔴 要作成 |

#### v3（1本）
| # | シーケンス図 | 対応UC | 外部システム | 状況 |
|:-:|-------------|--------|-------------|:----:|
| 15 | バージョン管理 | UC 3-7, 3-8 | 複雑な履歴管理 | 🔴 要作成 |

### スキップ可能なUC（シーケンス図不要）
以下は単純なCRUD/設定変更で外部API呼び出しがないため、シーケンス図不要:
- UC 5-3〜5-6: テンプレートCRUD
- UC 5-8〜5-10: システム設定・埋め込み設定・LLM設定変更
- UC 5-12, 5-13: Embedding使用量・一般ログ閲覧
- UC 3-11: ヘルプ表示

## 進捗サマリ
| カテゴリ | 必要数 | 完了 | 残り |
|---------|:-----:|:---:|:---:|
| MVP必須 | 8 | 1 | 7 |
| Phase 2 | 6 | 0 | 6 |
| v3 | 1 | 0 | 1 |
| **合計** | **15** | **1** | **14** |

## 更新した管理資料
- `docs/context/active_context.md`: シーケンス図進捗テーブル更新
- `CLAUDE.md`: 次のアクションセクション更新

## 教訓
- 最初の分析（6本）はCLAUDE.md記載を鵜呑みにしていた
- 正確な分析には、ユースケース図の外部システム接続を精査する必要がある
- 32UC全てを外部システム依存の観点で分析することで、正確な見積りが可能
