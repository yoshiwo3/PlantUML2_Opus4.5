# Phase 2目的別AIチャット機能設計完了（2025-11-29）

## セッション概要

**日時**: 2025-11-29 11:00-12:35 JST
**主要成果**: Phase 2目的別AIチャット機能仕様確定、2フェーズ開発計画確定

## 完了した作業

### 1. 2フェーズ開発計画の確定

**合計開発期間**: 7ヶ月（旧13ヶ月から6ヶ月短縮、46%削減）

**Phase 1: 統合MVP（5ヶ月）**:
- 基本エディタ・プレビュー機能
- プロジェクト管理・バージョン管理（ファイルベース）
- テンプレート50種類 + 18図表タイプ対応
- **AIの問いかけスタート機能**（最重要）
  - 新規図表作成時にAIが「何を作りたいですか？」と問いかけ
  - 会話的テンプレート提案（最大3つ）
  - テンプレート修正支援（AIがテンプレートを修正）
- AI機能（自然言語→PlantUML/Excalidraw、最適化、補完、説明文生成）
- Excalidrawワイヤーフレーム（AI自動生成対応）

**Phase 2: 高度AI拡張（2ヶ月）**:
- **目的別AIチャット機能**（1ヶ月、最重要）
  - プロジェクトの目的理解（要件定義、設計、実装など）
  - 必要な図表セットを自動提案
  - 図表間の一貫性を自動管理（用語統一、要素継承、ナビゲーション）
  - フェーズごとのベストプラクティスをガイド
- 学習コンテンツRAG（0.5ヶ月）
- 画像逆変換（0.5ヶ月）

### 2. 重要な設計決定

#### AIの問いかけスタート（Phase 1）

**従来の誤解**:
- ❌ 自然言語入力 → AIが0から全自動生成

**正しいワークフロー**:
- ✅ AIが問いかけ → テンプレート提案 → AIが修正 → ユーザーが細かい調整

**実装内容**:
1. 新規図表作成時にAIが問いかけ
2. ユーザーが自然言語で回答（例: 「ECサイトの決済フローを作りたい」）
3. AIが最適な図表タイプとテンプレート3つを提案
4. ユーザーがテンプレート選択 → エディタに挿入
5. AIに修正指示（例: 「承認者を2段階にして」）
6. ユーザーがエディタで細かい調整

#### 目的別AIチャット（Phase 2）

**機能概要**:
- プロジェクトの作成目的（要件定義、設計など）を理解
- 必要な図表セットを提案（例: 要件定義なら5つの必須図表 + 3つの推奨図表）
- 図表間の連携を自動管理

**具体例（要件定義フェーズ）**:
1. ユーザー: 「ECサイトの要件定義書を作成したい」
2. AI: 必要な図表セット提案
   - ✅ 必須（5つ）: コンテキスト図、ユースケース図、業務フロー図、データフロー図、画面遷移図
   - ⚠️ 推奨（3つ）: 概念クラス図、ER図、対比表
3. AIが順番に図表作成を支援（コンテキスト図 → ユースケース図 → ...）
4. 図表間の一貫性を自動チェック
   - 用語統一（「顧客」vs「ユーザー」の表記揺れを検出）
   - 要素の自動継承（コンテキスト図のアクター → ユースケース図のアクター）
   - ナビゲーション自動追加（関連図表へのリンク）

### 3. 作成したドキュメント

**ファイル**: `docs/design/PlantUML_Studio_目的別AIチャット機能仕様_20251129.md`（約1,200行）

**内容**:
- 機能概要、ユースケース（要件定義フェーズの詳細フロー）
- データ構造仕様（プロジェクトメタデータ拡張、フェーズ別テンプレートセット）
- AI機能仕様（フェーズ認識、図表セット提案、図表間連携）
- UI/UXフロー、API仕様（7つ）
- 実装例（TypeScript、5つの主要機能）
- Phase 2への位置づけ、競合優位性、非機能要件

### 4. 競合優位性

**業界初の機能**:
1. ✅ フェーズ認識型図表作成（プロジェクトの目的とフェーズを理解するAI）
2. ✅ 図表セット提案（必要な図表を漏れなく提案）
3. ✅ 図表間一貫性の自動管理（用語統一、要素継承、ナビゲーション自動追加）
4. ✅ ドキュメント作成支援システム（単なるエディタから「プロジェクトアシスタント」へ進化）

## 技術的な決定

### Phase 1の優先機能

| 機能 | 優先度 | 理由 |
|------|--------|------|
| テンプレート50種類 | 🔴 High | 基本形はテンプレートから開始 |
| 業務カテゴリUI | 🔴 High | AIの問いかけスタート |
| AIテンプレート修正 | 🔴 High | 主機能（テンプレート修正） |
| AI 0から生成 | 🟡 Medium | 補助機能（フォールバック） |

### Phase 2の開発内訳

| タスク | 期間 | 優先度 |
|--------|------|--------|
| 目的別AIチャット | 1ヶ月 | 🔴 最重要 |
| 学習コンテンツRAG | 0.5ヶ月 | 🟡 重要 |
| 画像逆変換 | 0.5ヶ月 | 🟢 あれば便利 |

## データ構造

### プロジェクトメタデータ拡張（Phase 2）

```typescript
interface Project {
  // 既存フィールド（Phase 1）
  project_id: string;
  title: string;
  description: string;
  
  // 🆕 Phase 2で追加
  purpose: ProjectPurpose;           // プロジェクトの目的
  phase: ProjectPhase;               // 現在のフェーズ
  domain: string;                    // 業務ドメイン
  entity_glossary: EntityGlossary;   // 用語集（一貫性管理用）
  phase_progress: PhaseProgress;     // フェーズ別進捗
}
```

### フェーズ別テンプレートセット

要件定義フェーズ: 5つの必須図表 + 3つの推奨図表
- コンテキスト図、ユースケース図、業務フロー図、データフロー図、画面遷移図
- 概念クラス図、ER図、対比表

設計フェーズ: 3つの必須図表
- 詳細クラス図、シーケンス図、コンポーネント図

## API仕様

1. `POST /api/ai/analyze-project-purpose` - プロジェクト目的分析
2. `POST /api/ai/recommend-diagram-set` - 図表セット推薦
3. `POST /api/ai/check-diagram-consistency` - 図表間連携チェック
4. `POST /api/ai/apply-consistency-fix` - 自動修正適用
5. `GET /api/projects/{project_id}/phase-progress` - フェーズ進捗取得

## 次のステップ

1. 開発ロードマップv3.0のドキュメント化
2. 企画書への反映（ユーザー承認後）
3. active_context.md更新
