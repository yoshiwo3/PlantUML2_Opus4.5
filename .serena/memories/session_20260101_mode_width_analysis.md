# Session 2026-01-01: Mode幅設計の問題分析

## 分析対象
`docs/evidence/20251224_1955_ui_design_login/wireframes/04_editor/05_sequence_diagram_spec.md`

## 発見した問題

### 1. Mode 2の950pxはリサイザー制約(max:800px)を超えている
- §2.3 リサイザー: GUIパネル min:200px, max:800px
- §3.1 Mode 2: 950px ← 制約違反

### 2. 概念の混同
- モードの本質は「パネル構成」（GUI+Code+Preview vs GUI+Preview）
- 現在は「固定幅」として機能制限を設けている（誤り）

### 3. リサイザーとの整合性欠如
- Mode 1でもリサイザーで800pxまで拡大可能
- 「600px固定」という前提で機能制限する意味がない

## ユーザー指摘
- Mode 1でメッセージ並び替えできるべき
- リサイザーで動的に幅変更できるのに固定幅前提はおかしい

## 推奨解決策: A案（幅ベースの動的機能制御）

| 操作 | 幅200-399px | 幅400px以上 |
|------|:-----------:|:-----------:|
| メッセージ並び替え | ✅ メニュー | ✅ D&D |
| メッセージ編集 | ✅ インライン | ✅ インライン |

**ポイント**: 全幅で機能は有効（UIの表現方法が変わるだけ）

## 修正対象セクション
- §3.1, §3.2, §3.3, §6.4, §6.5, §6.8

## ステータス
- ✅ B案採用・実装完了 (v3.11 → v3.12)
- ✅ v3.13追加改善完了
- ✅ v3.14 UI統一完了
- ✅ v3.15 TD-037 D&D楽観的検証方式完了
- ✅ v3.16 TD-038 コンテキスト位置追加完了

## 実施した変更（2026-01-01）

### v3.12: B案（Mode幅制限撤廃）
- §3.1: モード定義を「パネル構成」に再定義、固定幅→リサイザー調整可能
- §3.2: Layer構造からMode幅削除
- §3.3: 操作権限マトリクスをLayer1/Layer2の2層に簡素化
- §6.4/§6.5: UI統合（D&Dハンドル☰/編集ボタン✏を常時表示）
- §6.5-§6.9: リナンバリング
- §6.7: D&D仕様からMode別対応を削除（常時有効）
- §4.2,§5.4,§7.5,§7.8,§8.1,§8.5,§9.4,§10.4,§10.5,§11.11,§12: 固定幅記述を削除
- Git commit: e5f1989

### v3.13: 選択モード仕様改善 + §6.3表示方式修正
**選択モード仕様改善:**
- §2.5「連動動作」→「連動動作（モード切替）」に名称変更
- §2.5「選択状態の連動」→「選択状態の双方向同期」に全面改訂
- §2.5 非連続選択の対応セクション追加（GUI: 累積クリック、Code: Ctrl+クリック）
- §13.2.1 条件2にAIへの送信列追加、双方向同期の注記追加
- §13.3「複数カード選択時の処理（非連続対応）」に改訂
- §13.5 AI依頼文に**全体コード（行番号付き）**を追加

**§6.3表示方式修正:**
- フラグメント: 「ラッパー + 条件ラベル」→「ラッパー（条件ラベル付き）+ 内部要素はカードUI」
- ノート: 「バッジ表示」→「カードUI（📝アイコン + [✏] + [🗑]）」
- 設計思想: バッジ表示はUX低下のため却下、メッセージと同等の操作性を確保

### v3.14: フラグメント編集ボタンUI統一
- §6.4 S2要素一覧UIのフラグメントヘッダーに[✏]追加
  - group「認証処理」、group「DB処理」
- フラグメントフッターから`[編集 →]`を削除
- §6.5 UI統一原則明記（全要素は`[✏]` `[🗑]`アイコンボタン統一、テキストボタン禁止）
- §10.11 方式I表示例のフッターから`[編集 →]`削除
- §12.2 Layer遷移図の`[編集 →]`→`[✏]`に変更
- Git commit: e96223e

### v3.15: TD-037 D&D楽観的検証方式（Preview-as-Validator）
- §6.7 D&D並べ替え仕様を全面改訂
- D&D制約を撤廃（フラグメント境界跨ぎ/内外移動/フラグメント移動を許可）
- 楽観的検証方式を採用（Preview描画時にローカルJARが自動検証）
- 追加メモリ0MB（既存Previewパイプライン流用）
- エラー表示UI + Undo仕様追加
- D-68/D-69を改訂、D-70追加
- Git commit: ac7af6b

### v3.16: TD-038 コンテキスト位置追加（Context-aware Position Addition）
- **インライン展開方式のみに適用**
- §5.5 参加者追加フォーム、§8.1 メッセージ追加、§9.2 フラグメント、§10.3 ノート
- インライン: 選択要素の直後/末尾
- §11.1 Group/アクティブバー: **TD-038適用外**（モーダルで選択した範囲の位置に挿入、追加ボタン時のカード選択は影響しない）
- §12.5 入力画面遷移マトリクスに「挿入位置」列追加
- D-71/D-73追加、D-72削除
- Git commit: eb3d8e1 → 訂正コミット予定
