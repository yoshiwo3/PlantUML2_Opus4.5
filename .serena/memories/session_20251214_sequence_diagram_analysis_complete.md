# セッション記録: シーケンス図要件分析完了

## 作業日時
2025-12-14

## 作業内容

### 分析目的
機能一覧表（v3.12）とユースケース図（32UC）を照合し、シーケンス図作成要件を明確化

### 分析結果

#### 整合性確認
| 項目 | ユースケース図 | 機能一覧表 | 結果 |
|------|:------------:|:----------:|:----:|
| 総UC数 | 32 | 32 | ✅ 一致 |
| MVP | 14 | 14 | ✅ 一致 |
| Phase 2 | 16 | 16 | ✅ 一致 |
| v3 | 2 | 2 | ✅ 一致 |

**結論**: 両ドキュメントに不整合なし。32UC = 32機能の1:1対応を確認。

#### シーケンス図6本の内訳（確定）

| # | シーケンス図 | 対応UC | 外部システム | 優先度 | 状況 |
|:-:|-------------|--------|-------------|:------:|:----:|
| 1 | 認証フロー | UC 1-1, 1-2 | Supabase Auth (OAuth PKCE) | MVP | ✅ 完了 |
| 2 | 編集プレビュー | UC 3-3, 3-4 | OpenRouter (AI修正提案) | MVP | 🔴 要作成 |
| 3 | 保存 | UC 3-5 | Storage + OpenRouter (用語チェック) | MVP | 🔴 要作成 |
| 4 | エクスポート | UC 3-6 | ローカル変換 | MVP | 🔴 要作成 |
| 5 | AI Question-Start | UC 4-1 | OpenRouter (ストリーミング) | MVP | 🔴 要作成 |
| 6 | AIチャット | UC 4-2 | OpenRouter (継続会話) | **Phase 2** | 🔴 要作成 |

#### 重要発見
- **UC 4-2（AIチャット）はPhase 2機能**
- MVP必須: 4本（編集プレビュー/保存/エクスポート/AI Question-Start）
- Phase 2: 1本（AIチャット）

#### 作成優先順位（MVP）
| 優先度 | シーケンス図 | 理由 |
|:------:|-------------|------|
| 1 | 編集プレビュー (UC 3-3, 3-4) | コア機能、AI連携あり |
| 2 | AI Question-Start (UC 4-1) | MVP差別化機能 |
| 3 | 保存 (UC 3-5) | 用語一貫性チェック連携 |
| 4 | エクスポート (UC 3-6) | 基本機能 |

### プロジェクト管理・図表作成シーケンス図について
- プロジェクト管理（UC 2-1〜2-4）: 単純なStorage CRUD → 機能一覧表で十分
- 図表作成（UC 3-1, 3-2）: ファイル作成 → 機能一覧表で十分
- 図表削除（UC 3-9）: 確認→削除 → 機能一覧表で十分

**CLAUDE.md「6本」の判断基準:**
- 複雑な外部システム連携がある機能を優先
- 単純なCRUD操作は機能一覧表の処理フローで十分

## 成果物

| ファイル | 更新内容 |
|---------|---------|
| `docs/context/active_context.md` | シーケンス図詳細進捗テーブル追加、最近の変更追記 |
| `CLAUDE.md` | シーケンス図セクション更新（優先度明記、Phase 2分離）、次のアクション更新 |

## 技術的決定

- シーケンス図6本（MVP 5本 + Phase 2 1本）で確定
- 単純CRUD操作はシーケンス図不要（機能一覧表で十分）
- 外部システム連携の複雑さを優先度判断基準とする

## 次のステップ

Phase 4: シーケンス図作成（残り5件）
1. 編集プレビュー（UC 3-3, 3-4）- OpenRouter連携
2. AI Question-Start（UC 4-1）- ストリーミング
3. 保存（UC 3-5）- 用語一貫性チェック
4. エクスポート（UC 3-6）- ローカル変換
5. AIチャット（UC 4-2）- Phase 2
