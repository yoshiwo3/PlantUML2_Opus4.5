# セッション記録: 3.4 認証フロー作成

**作成日**: 2025-12-02
**作業内容**: 業務フロー図 3.4 認証フローの追加

## 技術決定

### TD: Email/Password認証は不使用

**決定内容**: PlantUML Studioの認証方式はOAuthのみ（GitHub, Google）とする。Email/Password認証は実装しない。

**理由**: ユーザー指定

**影響**:
- ユースケース図(UC 1-1)の説明に「Email/Password」の記述がある場合は後日修正が必要
- 業務フロー図3.4でOAuthのみを明記済み

## 作成内容

### 3.4 認証フロー

- **対応UC**: 1-1 ログインする, 1-2 ログアウトする
- **アクター**: エンドユーザー, Frontend Service, Supabase Auth, OAuthプロバイダー

### ログインフロー
1. アプリアクセス → セッション確認
2. OAuthプロバイダー選択（GitHub or Google）
3. OAuthリダイレクト → 認証・許可
4. コールバック処理 → トークン検証・セッション作成
5. ダッシュボード表示

### ログアウトフロー
1. ログアウトボタンクリック
2. Supabase Authでセッション終了
3. ログイン画面リダイレクト

### セッション管理
- セッション保持: Supabase Auth（JWT）
- 自動更新: アクセストークン自動リフレッシュ
- 期限切れ: 自動ログアウト

## 更新したファイル

1. `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md`
   - 3.4 認証フロー追加
   - 図表構成テーブル更新
   - マイクロサービス一覧更新
   - 外部システム一覧更新（Supabase Auth, OAuthプロバイダー追加）
   - レビュー観点追加（認証仕様の整合性）

2. `CLAUDE.md`
   - 業務フロー図進捗: 3/10 → 4/10 (40%)
   - ユースケースカバレッジ: 認証 0→2 カバー済み

## 整合性修正（同セッション内で実施）

### ユースケース図からEmail/Password削除

**修正ファイル**: `docs/proposals/PlantUML_Studio_ユースケース図_20251130.md`

**変更箇所**:
1. PlantUML内note（旧Line 383）: `- Email/Password` 行を削除
2. UC 1-1説明（旧Line 708）: `OAuth（GitHub/Google）による認証` に変更

**理由**: 上記TD「Email/Password認証は不使用」との整合性確保

## 現在の進捗

**業務フロー図**: 4/10 完了（40%）

| # | フロー | 状態 | 対応UC |
|---|--------|:----:|--------|
| 3.1 | PlantUML図表作成フロー | ✅ | 3-1〜3-4 |
| 3.2 | PlantUML AI支援フロー | ✅ | 4-1〜4-3 |
| 3.3 | Excalidrawワイヤーフレーム作成フロー | ✅ | 3-3 |
| 3.4 | 認証フロー | ✅ | 1-1, 1-2 |
| 3.5 | プロジェクト管理フロー | 🔴 | 2-1〜2-3 |
| 3.6 | 保存・エクスポートフロー | 🔴 | 3-5, 3-6 |
| 3.7 | バージョン管理フロー | 🔴 | 3-7, 3-8 |
| 3.8 | 図表削除フロー | 🔴 | 3-9 |
| 3.9 | 学習コンテンツフロー | ⏸️ | 3-10, 3-11 (Phase 2) |
| 3.10 | 管理機能フロー | ⏸️ | 5-1〜5-5 (Phase 2) |

## 次のステップ

残り6フロー（MVP 4 + Phase2 2）:
- MVP: 3.5 プロジェクト管理, 3.6 保存・エクスポート, 3.7 バージョン管理, 3.8 図表削除
- Phase 2: 3.9 学習コンテンツ, 3.10 管理機能
