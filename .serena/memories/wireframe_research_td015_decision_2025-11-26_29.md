# ワイヤーフレーム機能調査フェーズとTD-015決定（2025-11-26〜11-29）

## セッション概要

**期間**: 2025年11月26日〜11月29日（4日間）
**フェーズ**: ワイヤーフレーム機能方針決定
**主要成果**: TD-015決定（Excalidraw採用）、TD-014凍結（Salt/Draw.io併用）

## 調査活動サマリー

### 調査レポート作成（11件、約420ページ、290,000文字）

1. **要件定義フェーズにおけるワイヤーフレーム作成_中レベルLLM適合性分析_20251126.md**
   - 中レベルLLM（GPT-4o-mini、Claude 3.5 Haiku、Gemini 1.5 Flash）の適合性評価
   - 要件定義フェーズのベストプラクティス調査
   - 評価軸の転換点（高性能LLM前提 → 要件定義フェーズ + 中レベルLLM）

2. **PlantUML_Salt代替手段包括評価_20251126.md**
   - Salt、HTML/CSS、Excalidraw、Figma、Penpotの5候補評価
   - 新評価結果: Excalidraw 98/100、HTML/CSS 50/100、Salt 50/100

3. **Excalidraw_MCP詳細技術仕様_20251126.md**（第2候補の徹底解説）
   - Excalidraw JSON構造解析（100トークン以下）
   - MCP実装方式3案（HTTP、Stdio、プラグイン）
   - Next.js統合手順（Dynamic Import、SSR無効化）

4. **Playwright+Draw.io GUI自動操作AI成功率分析完了_20251124.md**
   - Playwright MCPでのGUI自動化検証
   - AI成功率: 20-40%（低評価）

5. 他7件の調査レポート

### WebSearch実行（43回）

- PlantUML Salt最新ドキュメント検索
- Excalidraw公式サイト、GitHub、ドキュメント確認
- 業界標準ワイヤーフレーム手法調査
- 中レベルLLM価格・性能比較
- Figma、Penpot、Draw.io調査

## TD-015決定の経緯

### 評価の転換

**旧評価（高性能LLM前提、2025-11-23）**:
- HTML/CSS: 95/100（高精度、ピクセルパーフェクト）
- Excalidraw: 88/100（手書き風、低精度だが軽量）
- Salt: 85/100（PlantUML統合）

**新評価（要件定義フェーズ + 中レベルLLM、2025-11-26）**:
- **Excalidraw: 98/100** ← 要件定義フェーズに最適（低精度が逆に強み）
- HTML/CSS: 50/100 ← 高精度が過剰、トークン消費大
- Salt: 50/100 ← 中レベルLLMで成功率低下（60-70%）

### 決定要因

| 項目 | PlantUML Salt | Excalidraw | 効果 |
|------|-------------|-----------|------|
| **トークン消費** | 250-300 | 80-100 | **67%削減** |
| **API料金（年間）** | $180-$1,500 | $60-$500 | **67%削減** |
| **開発コスト** | 24人日 | 8人日 | **66%削減** |
| **LLM成功率** | 60-70% | 80-90% | **+20%向上** |
| **業界標準準拠** | ❌ | ✅ | 要件定義フェーズのベストプラクティス |

### TD-015承認（2025-11-26）

- **決定内容**: ワイヤーフレーム機能にExcalidrawを採用
- **採用理由**:
  1. 要件定義フェーズの業界標準（低精度ワイヤーフレーム）に準拠
  2. 中レベルLLMでの高成功率（80-90%）
  3. トークン消費67%削減 → API料金67%削減
  4. 開発工数66%削減（24人日 → 8人日）
  5. 21人日（約1ヶ月）の総合開発期間短縮

### TD-014凍結（2025-11-29）

- **凍結内容**: Salt/Draw.io併用検討を終了
- **凍結理由**: TD-015（Excalidraw採用）により技術方針確定

## 実装計画への反映

### 企画書更新（2025-11-29）

- `docs/proposals/企画書.md` 全面更新
  - Line 76: 図表タイプ一覧（Salt → Excalidraw）
  - Lines 1568-1592: ワイヤーフレーム詳細セクション（開発工数8人日明記）
  - Line 2307: フェーズ3実装計画（Excalidraw統合、8人日）
  - TypeScript設定例、図表タイプ検出関数をExcalidraw対応に変更

### 新規ドキュメント作成

- `PlantUML_Studio_実装機能整理_20251129.md`（5,000行、~60ページ）
  - TD-015影響分析
  - 22図表タイプ実装状況
  - フェーズ別実装計画（13ヶ月）
  - コスト削減効果の詳細分析

### Memory Bank更新

- `technical_decisions.md`: TD-015追加（~180行）、TD-014凍結
- `active_context.md`: 調査フェーズ完了記録、次ステップ明記

## 技術的学び

### Excalidraw統合のベストプラクティス

1. **Next.js統合**: Dynamic Import with `ssr: false` 必須
2. **データ形式**: Excalidraw JSON（軽量、100トークン以下）
3. **ストレージ**: Supabase Storage（`wireframes/<project_id>/<diagram_id>.excalidraw`）
4. **スタイル設定**:
   - roughness（手書き風度）プリセット提供
   - グレースケールモード（要件定義フェーズ向け）
5. **エクスポート**: PNG、SVG、Excalidraw JSON

### 要件定義フェーズのワイヤーフレーム原則

- ✅ **低精度・低忠実度（Low-Fidelity）が正解**
- ✅ **手書き風スタイルで要件変更の柔軟性を示す**
- ✅ **グレースケールで色の議論を避ける**
- ❌ **ピクセルパーフェクトは過剰** → 設計フェーズ以降で使用

### 中レベルLLMの制約

- トークン消費に敏感（300トークン超えると精度低下）
- 複雑構文（PlantUML Salt）での成功率60-70%
- シンプル構文（Excalidraw JSON）での成功率80-90%

## コスト削減効果の詳細

### API料金削減（67%）

**PlantUML Salt**:
- トークン消費: 250-300トークン/回
- 月間想定生成回数: 1,000回（100ユーザー × 10回）
- 月間トークン消費: 250,000-300,000トークン
- 月間API料金: $15-$125（GPT-4o-mini〜Claude 3.5 Sonnet）
- **年間API料金: $180-$1,500**

**Excalidraw**:
- トークン消費: 80-100トークン/回
- 月間トークン消費: 80,000-100,000トークン
- 月間API料金: $5-$42
- **年間API料金: $60-$500**

**削減額**: $120-$1,000/年（67%削減）

### 開発コスト削減（66%）

**PlantUML Salt**:
- 構文学習: 3人日
- UI要素パレット実装: 8人日
- Salt専用エディタ機能: 5人日
- テスト・デバッグ: 4人日
- ドキュメント作成: 4人日
- **合計: 24人日**

**Excalidraw**:
- npmパッケージ統合: 2人日
- Dynamic Import設定: 1人日
- プリセット実装: 2人日
- テスト・デバッグ: 2人日
- ドキュメント作成: 1人日
- **合計: 8人日**

**削減**: 16人日（66%削減）

### 総合開発期間短縮

- ワイヤーフレーム機能: 16人日短縮
- 調査・検証工数削減: 5人日短縮
- **合計: 21人日（約1ヶ月）短縮**

## 次のステップ

### 実装準備（Phase 3）

1. **Excalidraw統合実装**（8人日）
   - `@excalidraw/excalidraw` npmパッケージインストール
   - Next.js Dynamic Importコンポーネント作成
   - Supabase Storage統合
   - プリセットライブラリ作成

2. **学習コンテンツ作成**
   - Excalidrawクイックスタートガイド
   - UI要素プリセット一覧
   - 業務カテゴリ別テンプレート

3. **AI連携最適化**
   - 中レベルLLM向けプロンプト最適化
   - Excalidraw JSON生成テンプレート
   - 検証ループ実装

### 技術検証

- [ ] Excalidrawコンポーネントのパフォーマンステスト
- [ ] Supabase Storageの容量・コスト試算
- [ ] 中レベルLLMでの生成精度検証（実データ）

## 参考資料

### 調査レポート（docs/research/20251126/）

- `README.md`: 11件のレポート索引
- `要件定義フェーズにおけるワイヤーフレーム作成_中レベルLLM適合性分析_20251126.md`
- `PlantUML_Salt代替手段包括評価_20251126.md`
- `Excalidraw_MCP詳細技術仕様_20251126.md`

### Memory Bank（docs/context/）

- `technical_decisions.md`: TD-015、TD-014
- `active_context.md`: 調査フェーズ完了記録

### 企画書（docs/proposals/）

- `企画書.md`: Salt → Excalidraw全面置換完了
- `PlantUML_Studio_実装機能整理_20251129.md`: TD-015影響分析

## まとめ

2025年11月26日〜29日の4日間にわたる包括的な調査により、PlantUML Studioのワイヤーフレーム機能方針が確定しました。

**主要成果**:
- ✅ TD-015決定: Excalidraw採用
- ✅ TD-014凍結: Salt/Draw.io併用検討終了
- ✅ 11件の調査レポート作成（420ページ）
- ✅ 企画書全面更新（Salt → Excalidraw）
- ✅ 実装機能整理ドキュメント作成（5,000行）

**コスト削減効果**:
- 📉 開発期間: 21人日短縮（約1ヶ月）
- 💰 API料金: 67%削減（年間$120-$1,000削減）
- 📈 LLM成功率: +20%向上（80-90%）
- 🎯 業界標準準拠: 要件定義フェーズのベストプラクティス準拠

この決定により、PlantUML Studioは要件定義フェーズに最適化されたワイヤーフレーム機能を、コスト効率的に提供できるようになります。
