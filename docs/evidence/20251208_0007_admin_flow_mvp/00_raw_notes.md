# 作業メモ: 3.9 管理機能フロー（MVP）

**開始日時**: 2025-12-08 00:07
**完了日時**: 2025-12-08 00:45

---

## 作業ログ

### 00:07 - 作業開始

- エビデンスフォルダ作成
- ユースケース図を確認、対象UC:
  - 5-1: ユーザー管理
  - 5-2: LLMモデル登録
  - 5-3: LLMモデル切替
  - 5-4: LLMプロンプト管理
  - 5-5: LLMパラメータ設定
  - 5-7: LLM使用量監視
  - 5-8: LLMフォールバック設定
  - 5-13: システム設定変更

### 00:11 - Context7で仕様確認

- PlantUMLアクティビティ図のスイムレーン構文を確認
- 既存の業務フロー図を参考にスタイルを確認

### 00:12 - 初回PNG生成開始

- 10フロー分の.pumlファイルを作成
- 一括PNG生成実行

### 00:15 - 初回レビュー完了

- 3.9 概要図: ❌ endif後スイムレーン遷移で接続線途切れ
- 他9フローは初回レビュー通過（後に再確認で問題発見）

### 00:16 - 3.9概要図修正

- 「:機能選択を待機;」アクション追加
- 再レビュー ✅ 通過

### 00:20 - 追加問題発見（ユーザー指摘）

- 3.9.1 ユーザー管理フロー: switch内でスイムレーン遷移 → 孤立ノード発生
- 同様のパターンを全フローで検索
- 3.9.2.3 LLMプロンプト管理、3.9.2.6 LLMフォールバック設定でも発見

### 00:30 - 修正実施

- 4フローを修正（回避策2: 1スイムレーン内に収めnoteで詳細説明）
  - 3.9 概要図
  - 3.9.1 ユーザー管理
  - 3.9.2.3 LLMプロンプト管理
  - 3.9.2.6 LLMフォールバック設定

### 00:40 - 最終レビュー完了

- 全10フロー ✅ 通過
- 元のMarkdownファイルに修正反映

---

## レビュー結果サマリ

| # | フロー | 初回 | 修正内容 | 最終 |
|:-:|--------|:---:|---------|:---:|
| 1 | 3.9 概要図 | ❌ | endif後アクション追加 | ✅ |
| 2 | 3.9.1 ユーザー管理 | ❌ | switch内スイムレーン遷移削除 | ✅ |
| 3 | 3.9.2 LLM管理概要 | ✅ | - | ✅ |
| 4 | 3.9.2.1 LLMモデル登録 | ✅ | - | ✅ |
| 5 | 3.9.2.2 LLMモデル切替 | ✅ | - | ✅ |
| 6 | 3.9.2.3 LLMプロンプト管理 | ❌ | switch内スイムレーン遷移削除 | ✅ |
| 7 | 3.9.2.4 LLMパラメータ設定 | ❌ | if内スイムレーン遷移削除 | ✅ |
| 8 | 3.9.2.5 LLM使用量監視 | ❌ | if内スイムレーン遷移削除 | ✅ |
| 9 | 3.9.2.6 LLMフォールバック設定 | ❌ | switch内スイムレーン遷移削除 | ✅ |
| 10 | 3.9.3 システム設定 | ✅ | - | ✅ |

---

## 発見した問題・回避策

### 問題1: endif直後のスイムレーン遷移

**症状**: 接続線が途切れる
**原因**: PlantUMLのバグ（憲法§3禁止事項#1）
**回避策**: endif後に1行アクションを追加してからスイムレーン遷移

### 問題2: switch/case内でのスイムレーン遷移

**症状**: 最初のcase以外のノードが孤立（上流接続線なし）
**原因**: PlantUMLのバグ（憲法§3禁止事項#1の亜種）
**回避策**: switch全体を1スイムレーン内に収め、他レーンの処理はnoteで説明

---

## 修正ファイル一覧

- `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md`
  - 3.9 概要図（1921行目）
  - 3.9.1 ユーザー管理（1980-2006行目）
  - 3.9.2.3 LLMプロンプト管理（2223-2249行目）
  - 3.9.2.6 LLMフォールバック設定（2374-2402行目）
