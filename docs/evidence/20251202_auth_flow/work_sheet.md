# 業務フロー図 3.4-3.5 ワークシート

## 作業サマリー

| 項目 | 内容 |
|------|------|
| **作業名** | 業務フロー図 3.4 認証フロー + 3.5 プロジェクト管理フローの作成 |
| **作成日** | 2025-12-02 |
| **ステータス** | 完了 |
| **成果物** | 業務フロー図更新（3.4, 3.5追加）、ユースケース図修正 |

---

## 完了条件チェックリスト

| # | 条件 | 状態 |
|---|------|:----:|
| 1 | 3.4 認証フローがPlantUML構文で正しく記述されている | ✅ |
| 2 | フロー説明テーブルが作成されている | ✅ |
| 3 | 図表構成テーブルに3.4が追加されている | ✅ |
| 4 | アクター・マイクロサービス・外部システム一覧が更新されている | ✅ |
| 5 | 他の正式版図表との整合性が確保されている | ✅ |
| 6 | ユースケース図のEmail/Password記述が削除されている | ✅ |
| 7 | CLAUDE.mdの進捗が更新されている | ✅ |
| 8 | Serena memoryに記録されている | ✅ |
| 9 | Gitコミットされている | ✅ |

---

## 作成した図表

### 3.4 認証フロー

| 項目 | 内容 |
|------|------|
| **概要** | OAuth認証によるログイン・ログアウトフロー |
| **対応UC** | 1-1 ログインする, 1-2 ログアウトする |
| **アクター** | エンドユーザー, Frontend Service, Supabase Auth, OAuthプロバイダー |

**特徴:**
- OAuthのみ（GitHub, Google）- Email/Password不使用
- fork分岐でセッション期限切れ/手動ログアウトを表現
- スイムレーン形式（|アクター|構文）

---

## 技術決定

### TD: Email/Password認証は不使用

| 項目 | 内容 |
|------|------|
| **決定** | 認証方式はOAuthのみ（GitHub, Google） |
| **理由** | ユーザー指定 |
| **影響** | ユースケース図の修正が必要 |
| **記録先** | `.serena/memories/session_20251202_auth_flow.md` |

---

## 整合性修正

### ユースケース図の変更

| 箇所 | 変更前 | 変更後 |
|------|--------|--------|
| PlantUML note | `- Email/Password`<br>`- OAuth (GitHub/Google)` | `- OAuth (GitHub/Google)` |
| UC 1-1説明 | `Email/Password または OAuth（GitHub/Google）` | `OAuth（GitHub/Google）による認証` |

---

## 現在の進捗

### 業務フロー図: 5/10 完了（50%）

| # | フロー | 状態 | 対応UC |
|---|--------|:----:|--------|
| 3.1 | PlantUML図表作成フロー | ✅ | 3-1〜3-4 |
| 3.2 | PlantUML AI支援フロー | ✅ | 4-1〜4-3 |
| 3.3 | Excalidrawワイヤーフレーム作成フロー | ✅ | 3-3 |
| 3.4 | 認証フロー | ✅ | 1-1, 1-2 |
| 3.5 | プロジェクト管理フロー | ✅ | 2-1〜2-3 |
| 3.6 | 保存・エクスポートフロー | 🔴 | 3-5, 3-6 |
| 3.7 | バージョン管理フロー | 🔴 | 3-7, 3-8 |
| 3.8 | 図表削除フロー | 🔴 | 3-9 |
| 3.9 | 学習コンテンツフロー | ⏸️ | 3-10, 3-11 (Phase 2) |
| 3.10 | 管理機能フロー | ⏸️ | 5-1〜5-5 (Phase 2) |

### ユースケースカバレッジ

| カテゴリ | 総UC数 | カバー済み |
|---------|:------:|:---------:|
| 認証 | 2 | 2 ✅ |
| プロジェクト管理 | 3 | 3 ✅ |
| 図表作成・編集 | 11 | 4 |
| AI支援 | 2 | 2 ✅ |
| 管理機能 | 5 | 0 (Phase 2) |

---

## 更新したファイル

| ファイル | 変更内容 |
|---------|---------|
| `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` | 3.4 認証フロー追加 |
| `docs/proposals/PlantUML_Studio_ユースケース図_20251130.md` | Email/Password削除 |
| `CLAUDE.md` | 業務フロー図進捗更新 |
| `.serena/memories/session_20251202_auth_flow.md` | 技術決定記録 |

---

## 3.5 視認性改善（2025-12-02 追記）

### 問題点と解決策

| 問題 | 評価前 | 解決策 | 評価後 |
|------|:------:|--------|:------:|
| `stop`がrepeat whileを壊す | 48/100 | `detach`に変更 | ✅ |
| 5階層ネスト | - | 3階層に削減 | ✅ |
| 10回スイムレーン遷移 | - | 5回に削減 | ✅ |
| 163行（長すぎ） | - | 78行に圧縮 | ✅ |

### 改善案分析

| 案 | 説明 | スコア | 採用 |
|:--:|------|:------:|:----:|
| 案1 | 4分割（3.5.1-3.5.4） | 81/100 | ❌ |
| 案2 | **簡略化統合フロー** | 88/100 | ✅ |
| 案3 | 概要+詳細（2図） | 85/100 | ❌ |

**選定理由**: ユーザー要件「統合フロー（1つ）」に最適合

---

## 次のステップ

1. **3.6 保存・エクスポートフロー**（UC 3-5, 3-6）
2. **3.7 バージョン管理フロー**（UC 3-7, 3-8）
3. **3.8 図表削除フロー**（UC 3-9）

---

## 関連ドキュメント

| ドキュメント | パス |
|-------------|------|
| 業務フロー図（成果物） | `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` |
| ユースケース図（修正済） | `docs/proposals/PlantUML_Studio_ユースケース図_20251130.md` |
| Serena Memory | `.serena/memories/session_20251202_auth_flow.md` |
| 下書き参照 | `docs/design/PlantUML_Studio_設計図表_20251130.md` |
