# エディタ画面構成 ベストプラクティス分析

**作成日時**: 2025-12-28 18:00
**セッション**: Session 12
**対象**: #04 エディタ画面
**分析対象TD**: TD-017〜TD-023（エディタ画面関連）

---

## 1. 分析目的

TD-017〜TD-023で決定された画面構成がベストプラクティスに適合しているかを評価し、改善点を特定する。

---

## 2. 現在の画面構成（TD決定事項ベース）

### 2.1 基本レイアウト（TD-023: エディタ画面基本レイアウト）

> **TD-023**: エディタ画面の基本レイアウト定義。1920×1080を基準解像度とし、3パネル（GUI 300px / Code 650px / Preview 962px）＋ボトムAIチャットで構成。

#### モード1: GUI+Code（デフォルト）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ヘッダー                                    [GUI+Code] [GUI] [Code] ← 新規 │
├────────┬─────────────┬──────────────────────────────────────────────────────┤
│ GUI    │ Code        │ Preview                                              │
│ Panel  │ Panel       │ Panel                                                │
│ 300px  │ 650px       │ 962px                                                │
│        │ (Monaco)    │ (PlantUML SVG)                                       │
│ 5セク  │             │                                                      │
│ ション │             │                                                      │
├────────┴─────────────┴──────────────────────────────────────────────────────┤
│ AIチャットパネル（ボトム）                                                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### モード2: GUIのみ（非コーダー向け）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ヘッダー                                    [GUI+Code] [GUI] [Code]         │
├────────────────────────────────┬────────────────────────────────────────────┤
│ GUIパネル（拡張）               │ Preview                                    │
│ 950px                          │ 962px                                      │
│                                │                                            │
│ ← Codeは内部で維持（非表示）    │                                            │
├────────────────────────────────┴────────────────────────────────────────────┤
│ AIチャットパネル                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### モード3: Codeのみ（上級者向け）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ヘッダー                                    [GUI+Code] [GUI] [Code]         │
├────────────────────────────────┬────────────────────────────────────────────┤
│ Codeパネル（拡張）              │ Preview                                    │
│ 950px                          │ 962px                                      │
│ (Monaco Editor)                │                                            │
├────────────────────────────────┴────────────────────────────────────────────┤
│ AIチャットパネル                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 GUIパネル内部構造（TD-019 層1）

```
┌──────────────────────────────┐
│ Section 1: 参加者             │ ← participant管理
├──────────────────────────────┤
│ Section 2: メッセージ表示     │ ← D&D並べ替え可能
│  [メッセージ管理] ボタン      │ → 層2モーダルへ
├──────────────────────────────┤
│ Section 3: Note追加           │ ← ポップオーバーでNote追加
├──────────────────────────────┤
│ Section 4: フラグメント       │ ← 層3モーダルへ
│  [フラグメント挿入] ボタン    │
├──────────────────────────────┤
│ Section 5: 補助要素           │ ← 区切り線/遅延/スペース
└──────────────────────────────┘
     300px（モード1）
     950px（モード2）
```

### 2.3 3層モーダル構造（TD-019）

#### 層2: メッセージ管理モーダル（900×700px）

```
┌─────────────────────────────────────────────────────────────────┐
│ メッセージ管理                                            [×]  │
├─────────────────────────────────────────────────────────────────┤
│ 【参加者管理セクション】                                        │
├─────────────────────┬───────────────────────────────────────────┤
│ メッセージ作成      │ 全メッセージ一覧                          │
│ フォーム            │                                           │
│ (350px)             │ ┌─────────────────────────────────────┐   │
│                     │ │ [カード1] Alice→Bob: hello         │   │
│ [フラグメント挿入]  │ │ [カード2] Bob→Alice: hi            │   │
│                     │ │ [カード3] ...                       │   │
│                     │ │         ↕ D&D並べ替え可能           │   │
│                     │ └─────────────────────────────────────┘   │
├─────────────────────┴───────────────────────────────────────────┤
│ 【全体Note（across）管理セクション】                            │
└─────────────────────────────────────────────────────────────────┘
```

#### 層3: フラグメント編集モーダル（700×600px）

```
┌───────────────────────────────────────────────────────┐
│ フラグメント編集（alt/opt/loop等）              [×]  │
├───────────────────────────────────────────────────────┤
│ 条件1: [condition text        ]                       │
│ ┌─────────────────────────────────────────────────┐   │
│ │ メッセージ1                                     │   │
│ │ メッセージ2                     ↕ D&D可能       │   │
│ └─────────────────────────────────────────────────┘   │
│ [+ else追加]                                          │
├───────────────────────────────────────────────────────┤
│ 条件2 (else): [else condition   ]                     │
│ ┌─────────────────────────────────────────────────┐   │
│ │ メッセージ3                                     │   │
│ └─────────────────────────────────────────────────┘   │
├───────────────────────────────────────────────────────┤
│ フラグメントNote: [                ]                  │
│                                    [適用] [キャンセル]│
└───────────────────────────────────────────────────────┘
```

### 2.4 GUI編集レベル（TD-020）

| レベル | 対象構文 | GUIパネルでの表示・操作 |
|:------:|---------|------------------------|
| **1** | message, participant, note, fragment, 補助要素 | フォーム、D&D、モーダル |
| **2** | skinparam, title, header, footer, autonumber | クリック → ポップオーバー → テキスト入力 |
| **3** | !include, !define, !ifdef, box, newpage | 折りたたみ表示 → 展開でコード断片 → 「Codeで編集」リンク |

### 2.5 ヘッダー構成（TD-021）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ [Logo] PlantUML Studio │ ファイル名.puml │ [保存] [エクスポート] ... │ [■■□] │
└─────────────────────────────────────────────────────────────────────────────┘
                                                                      ↑
                                                            パネルモード切替トグル
                                                            [GUI+Code][GUI][Code]
```

**キーボードショートカット**: Ctrl+1, Ctrl+2, Ctrl+3

### 2.6 パネル間同期（TD-018）

```
        0ms（即時）           500ms（デバウンス）
GUIパネル ─────────→ Codeパネル ─────────────────→ Previewパネル
    ↑                    │
    └────────────────────┘
         300ms（デバウンス）
```

---

## 3. 評価フレームワーク

| 観点 | 評価基準 |
|------|---------|
| UXベストプラクティス | 業界標準、認知負荷、操作効率 |
| ターゲットユーザー適合性 | ペルソナ（非コーダー〜上級者） |
| 競合ツール比較 | VS Code, Figma, Mermaid Live Editor等 |
| 技術的実現可能性 | 実装複雑度、パフォーマンス |
| アクセシビリティ | WCAG準拠、キーボード操作 |
| レスポンシブ対応 | 解像度別対応 |

### 採点基準

| スコア | 評価 | 定義 |
|:------:|:----:|------|
| 90-100 | A | ベストプラクティス完全準拠 |
| 80-89 | B | 軽微な改善余地あり |
| 70-79 | C | 中程度の問題あり、要改善 |
| 60-69 | D | 重大な問題あり、必須修正 |
| <60 | F | 設計見直し必要 |

---

## 4. 各要素の詳細評価

### 4.1 3パネルレイアウト（GUI + Code + Preview）

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| 関心の分離 | ✅ | 編集（GUI/Code）と出力（Preview）の明確な分離 |
| ユーザースキル対応 | ✅ | 非コーダー（GUI）〜上級者（Code）をカバー |
| スペース効率 | ⚠️ | **300pxのGUIパネルは狭い** |

**競合比較**（※2025年12月時点の公式ドキュメント参照）:

| ツール | レイアウト | 備考 |
|--------|-----------|------|
| VS Code | サイドバー(250-300px) + エディタ + パネル | リサイズ可能 |
| Figma | 左パネル + キャンバス + 右パネル | 左右パネルは折りたたみ可能 |
| Mermaid Live | 2パネル（Code + Preview）| シンプル |
| PlantUML Server | 2パネル（Code + Preview）| シンプル |

**問題点**:
- **300px幅は業界標準の下限**。複雑なGUI操作には不足
- 1920px幅で3パネル＋AIチャットは情報密度が高い

**評価: 85/100**（-15: GUIパネル幅の制約）

---

### 4.2 パネルモード切替（3モード）

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| 柔軟性 | ✅ | ユーザータイプ別に最適化可能 |
| 発見可能性 | ⚠️ | トグルボタンが目立たない可能性 |
| 認知負荷 | ⚠️ | モード切替の学習コスト |

**代替案との比較**:

| アプローチ | メリット | デメリット |
|-----------|---------|-----------|
| **固定3モード（現行案）** | シンプル、予測可能 | 柔軟性不足 |
| リサイズ可能パネル | 完全な柔軟性 | 実装複雑、レイアウト崩れリスク |
| 折りたたみ式パネル | 中間的柔軟性 | 状態管理が複雑 |

**評価: 90/100**（-10: 発見可能性の懸念）

---

### 4.3 3層モーダル構造 ⚠️ **要注意**

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| 幅制約の解決 | ✅ | 300px制約を900px/700pxモーダルで解消 |
| 操作階層 | ❌ | **3層は深すぎる** |
| コンテキスト維持 | ❌ | モーダル内で元の画面が見えない |
| 戻り操作 | ❌ | 層3→層2→層1の3ステップ必要 |

**業界ベストプラクティスとの乖離**:

| パターン | 使用例 | 評価 |
|---------|--------|------|
| **センターモーダル** | 確認ダイアログ、設定 | 1-2層が限界 |
| **スライドオーバー** | Notion, Linear, Figma | コンテキスト維持、推奨 |
| **ドロワー** | Material Design | 部分的なコンテンツ表示 |
| **インプレース編集** | Figma | 最もシームレス |

**問題点**:
1. **モーダル疲れ**: 3層のモーダルはユーザーを「閉じ込められた」感覚にさせる
2. **コンテキスト喪失**: メインのPreviewが見えなくなる
3. **操作効率低下**: 層を行き来する操作が多発

**評価: 65/100**（-35: UXベストプラクティスからの乖離）

---

### 4.4 GUI編集レベル（3レベル）

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| 技術的合理性 | ✅ | 構文複雑度に応じた分類 |
| 一貫性 | ❌ | **3種類の編集体験は混乱を招く** |
| 学習コスト | ⚠️ | 「なぜ編集できないのか」の理解が必要 |

**ユーザー視点の問題**:

```
ユーザーの期待:
「GUIで全部編集できるはず」

現実:
- Level 1: フォーム編集 ✓
- Level 2: ポップオーバー編集 △（異なるUX）
- Level 3: 編集不可、Codeへ誘導 ✗（期待はずれ）
```

**評価: 75/100**（-25: 一貫性の欠如）

---

### 4.5 パネル間同期（TD-018）

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| アーキテクチャ | ✅ | Codeを正のソースとする設計は堅牢 |
| タイミング定義 | ✅ | 0ms/300ms/500msは業界標準 |
| 体感遅延 | ⚠️ | 300ms遅延は知覚可能 |

**評価: 95/100**（-5: 遅延の知覚可能性）

---

### 4.6 AIチャットパネル（ボトム）

| 評価項目 | スコア | 詳細 |
|---------|:------:|------|
| アクセス性 | ✅ | 常時表示で即座にアクセス可能 |
| スペース効率 | ❌ | **折りたたみ機能の欠如** |
| 配置 | ✅ | ボトム配置はチャットUIの標準 |

**問題点**:
- 固定表示は編集スペースを圧迫
- 使用頻度が低い場合、無駄なスペース消費

**評価: 80/100**（-20: 折りたたみ機能欠如）

---

### 4.7 レスポンシブ対応 ⚠️ **未定義**

| 解像度 | 現状 | 問題 |
|--------|------|------|
| 1920×1080 | ✅ 対応（TD-023基準）| - |
| 1440×900 | ❓ 未定義 | パネル幅の調整必要 |
| 1366×768 | ❓ 未定義 | 3パネルは困難 |
| 1280×720 | ❓ 未定義 | モード2/3強制？ |

> **ブレークポイント参照**: 上記解像度は一般的なWebアプリケーションのブレークポイント（Tailwind CSS、Bootstrap等）を参考にしている。TD-023でレスポンシブ定義を追加済み。

**評価: 50/100**（-50: レスポンシブ未定義）

---

### 4.8 アクセシビリティ ⚠️ **未定義**

| 要件 | 現状 | 問題 |
|------|------|------|
| キーボードショートカット | ✅ Ctrl+1/2/3 | 定義済み |
| フォーカス管理 | ❓ 未定義 | モーダル内フォーカストラップ必要 |
| スクリーンリーダー | ❓ 未定義 | ARIA属性必要 |
| 色コントラスト | ❓ 未定義 | WCAG AA準拠必要 |

**評価: 40/100**（-60: アクセシビリティ未定義）

---

## 5. 総合評価

| 項目 | スコア | 評価 |
|------|:------:|:----:|
| 3パネルレイアウト | 85 | B |
| パネルモード切替 | 90 | A |
| **3層モーダル構造** | **65** | **D** |
| GUI編集レベル | 75 | C |
| パネル間同期 | 95 | A |
| AIチャットパネル | 80 | B |
| **レスポンシブ対応** | **50** | **F** |
| **アクセシビリティ** | **40** | **F** |

**総合スコア: 72.5/100（単純平均、評価C）**

> 計算方法: (85+90+65+75+95+80+50+40) / 8 = 580 / 8 = 72.5

---

## 6. 重大な問題点と将来検討事項

> **注記**: 以下の問題点は現時点で特定されたものであり、改善案は**将来検討事項**として記録する。MVPでは現行設計（TD-017〜TD-023）を維持し、v2以降で対応を検討する。

### 問題1: 3層モーダル構造の深さ

**現状**:
```
層1（GUIパネル）→ 層2（メッセージ管理モーダル）→ 層3（フラグメント編集モーダル）
```

**問題**:
- UXベストプラクティスではモーダル深度は**2層まで**
- コンテキスト喪失（Previewが見えない）
- 操作効率低下

**改善案A: 2層に削減**
```
層1（GUIパネル）→ 層2（統合編集モーダル：タブ切替）
                    ├─ [メッセージ] タブ
                    └─ [フラグメント] タブ
```

**改善案B: スライドオーバーパネル**
```
┌────────┬─────────────┬────────────────────────────────────────────┐
│ GUI    │ Code        │ Preview                                    │
│ 300px  │ 650px       │ 962px                                      │
│        │             │                                            │
│ [開く] │             ├──────────────────────┐                     │
│   ↓    │             │ スライドオーバー     │ ← Preview上に重ねる  │
│        │             │ 500px               │    Previewは見える   │
│        │             │ (メッセージ管理)    │                      │
│        │             └──────────────────────┘                     │
└────────┴─────────────┴────────────────────────────────────────────┘
```

---

### 問題2: レスポンシブ対応の欠如

**改善案**:

| ブレークポイント | レイアウト | モード |
|-----------------|-----------|--------|
| ≥1920px | 3パネル（300+650+962）| モード1/2/3選択可 |
| 1440-1919px | 3パネル（250+500+690）| モード1/2/3選択可 |
| 1280-1439px | 2パネル（Code+Preview）| モード3固定 or モード2 |
| <1280px | 1パネル（タブ切替）| タブ: GUI/Code/Preview |

---

### 問題3: アクセシビリティの欠如

**必須追加項目**:

| 項目 | 要件 |
|------|------|
| フォーカストラップ | モーダル内でTabキーが循環 |
| Escape閉じ | モーダルはEscで閉じる |
| ARIA属性 | `role="dialog"`, `aria-modal="true"` |
| フォーカス復帰 | モーダル閉じ後、元の要素にフォーカス |
| 色コントラスト | WCAG AA（4.5:1以上）|

---

## 7. 将来検討アクション（v2以降）

> **注記**: 以下は将来バージョンでの検討事項。MVPでは現行設計を維持。

### 優先度: 高

| # | 課題 | 検討アクション | 対象TD |
|:-:|------|---------------|--------|
| 1 | 3層モーダル | 2層に削減（タブ統合 or スライドオーバー）| TD-019 |
| 2 | レスポンシブ未定義 | 4ブレークポイント定義 | TD-023 |
| 3 | アクセシビリティ未定義 | WCAG AA準拠要件追加 | 新規TD |

### 優先度: 中

| # | 課題 | 検討アクション | 対象TD |
|:-:|------|---------------|--------|
| 4 | AIチャット固定 | 折りたたみ機能追加 | TD-023 |
| 5 | GUI編集レベルの混乱 | 視覚的インジケータ追加 | TD-020 |
| 6 | GUIパネル300px | 最小幅を350pxに拡大 | TD-023 |

### 優先度: 低

| # | 課題 | 検討アクション | 対象TD |
|:-:|------|---------------|--------|
| 7 | モード切替発見性 | オンボーディング追加 | TD-021 |
| 8 | 固定モードの制約 | リサイズ可能パネル対応 | TD-023 |

---

## 8. 改善後の画面構成案（参考）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ヘッダー                              [GUI+Code] [GUI] [Code]  [?] [設定]  │
├────────┬─────────────┬──────────────────────────────────────────────────────┤
│ GUI    │ Code        │ Preview                                              │
│ Panel  │ Panel       │ Panel                                                │
│ 350px  │ 600px       │ 962px                                                │
│        │ (Monaco)    │                                                      │
│ 5セク  │             │ ┌────────────────────────┐                           │
│ ション │             │ │ スライドオーバー       │ ← 層2相当               │
│        │             │ │ [メッセージ][フラグ]   │   タブで切替            │
│ [編集] │             │ │                        │   Previewは見える       │
│   ↓    │             │ └────────────────────────┘                           │
├────────┴─────────────┴──────────────────────────────────────────────────────┤
│ [▼] AIチャット（折りたたみ可能）                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**変更点**:
1. GUIパネル: 300px → 350px
2. 3層モーダル → スライドオーバー（Preview上に重ねる、1層に削減）
3. フラグメント編集はスライドオーバー内のタブで対応
4. AIチャットは折りたたみ可能

---

## 9. 結論

**現在の画面構成はMVPとして機能するが、ベストプラクティスからの乖離がある。**

| 評価 | 内容 |
|------|------|
| **総合スコア** | 72.5/100 |
| **最大の問題** | 3層モーダル構造（UXベストプラクティス違反）|
| **必須対応** | レスポンシブ、アクセシビリティの定義追加 |
| **推奨アクション** | 2層への削減、スライドオーバー採用 |

---

## 10. 次のアクション（ユーザー判断待ち）

### 選択肢A: 現行構成でMVP進行 ✅ **採用**

| 項目 | 内容 |
|------|------|
| **概要** | TD-019の3層モーダル構造をそのまま採用 |
| **スコア** | 72.5/100（評価C）|
| **TD修正** | なし（TD-017〜TD-023そのまま）|
| **メリット** | 即時ワイヤーフレーム作成可能、追加議論不要 |
| **デメリット** | UXベストプラクティス違反（3層モーダル）、将来リファクタリング必要 |
| **次のアクション** | ワイヤーフレーム作成開始 |

### 選択肢B: 3層→2層に修正してMVP

| 項目 | 内容 |
|------|------|
| **概要** | TD-019を修正、メッセージ管理+フラグメント編集を1モーダル（タブ切替）に統合 |
| **スコア** | 約80/100（評価B）|
| **TD修正** | TD-019の「3層構造」セクションを「2層構造（タブ統合）」に変更 |
| **メリット** | UXベストプラクティスに近づく、操作ステップ削減 |
| **デメリット** | TD-019修正作業が発生、議事録更新必要 |
| **次のアクション** | TD-019修正 → 議事録更新 → ワイヤーフレーム作成 |

### 選択肢C: スライドオーバー採用

| 項目 | 内容 |
|------|------|
| **概要** | TD-019を大幅修正、センターモーダルではなくスライドオーバーパネルを採用 |
| **スコア** | 約85-90/100（評価A）|
| **TD修正** | TD-019の「3層構造」「モーダル遷移」セクションを全面改訂 |
| **メリット** | Preview視認性維持、コンテキスト喪失なし、最高UX |
| **デメリット** | TD-019大幅改訂、設計再検討、実装複雑度増 |
| **次のアクション** | TD-019改訂 → 設計レビュー → 議事録更新 → ワイヤーフレーム作成 |

---

**決定**: 選択肢A採用（2025-12-28 Session 12）

---

## 更新履歴

| 日時 | 内容 |
|------|------|
| 2025-12-28 22:00 | v1.1: 9問題対応完了 - TD-017〜TD-023に統一、採点基準追加、加重列削除・単純平均明記、TD-023説明追加、将来検討事項化、選択肢A/B/C詳細化、レスポンシブ根拠追加、選択肢A採用決定 |
| 2025-12-28 18:00 | v1.0: 初版作成（Session 12 ベストプラクティス分析）|
