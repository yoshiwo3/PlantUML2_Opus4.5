# エディタ画面ワイヤーフレーム分割方針書 v1.0

**作成日時**: 2025-12-29
**対象画面**: #04 エディタ画面
**関連TD**: TD-017〜TD-033
**前提ドキュメント**: `02_screen_composition_analysis.md` v10.0

---

## 1. 背景

### 1.1 分割が必要な理由

エディタ画面は以下の特性を持つため、単一ワイヤーフレームでは表現不可能：

| 特性 | 詳細 |
|------|------|
| **対応UC数** | 8UC（UC 3-1〜3-6, UC 4-1〜4-2） |
| **関連TD数** | 17件（TD-017〜TD-033） |
| **パネルモード** | 3モード（GUI+Code / GUIのみ / Codeのみ） |
| **インタラクション状態** | 選択モード、エラー状態、モーダル表示等 |
| **TD-028フロー** | 7ステップの複雑なAIコード適用フロー |

### 1.2 単一ワイヤーフレームの限界

| 問題 | 影響 |
|------|------|
| UI要素の重複 | 状態ごとに異なる表示が混在 |
| 注釈の過密 | 読み取り困難 |
| レビュー困難 | 5パスレビューで見落としリスク |
| 実装参照困難 | 開発者が状態を特定できない |

---

## 2. ワイヤーフレーム一覧

### 2.1 ファイル構成

```
04_editor/
├── 01_default.excalidraw               # 基本状態（Mode 1）
├── 02_selection_mode.excalidraw        # 選択モードON状態
├── 03_ai_code_apply.excalidraw         # AIコード適用フロー
├── 04_error_state.excalidraw           # エラー通知状態
├── 05_sequence_modal.excalidraw        # 層2統合モーダル
├── 06_gui_only.excalidraw              # Mode 2（GUIのみ）
├── 07_code_only.excalidraw             # Mode 3（Codeのみ）
├── 08_ai_chat_collapsed.excalidraw     # AIチャット折りたたみ
└── (archive/)
    └── default_v3.0_archive.excalidraw # 旧版アーカイブ
```

### 2.2 各ファイル詳細

| # | ファイル名 | 状態/画面 | 対応TD | 優先度 | 進捗 |
|:-:|-----------|----------|:------:|:------:|:----:|
| 1 | **01_default** | Mode 1 基本状態 | TD-023, TD-028, TD-032 | **P1** | ✅ 96点 |
| 2 | **02_selection_mode** | 選択モードON | TD-028 §11.3 | **P1** | ✅ 93.6点 |
| 3 | **03_ai_code_apply** | AIコード適用フロー | TD-028 §11.2, §11.4-11.7 | **P1** | 🔴 |
| 4 | **04_error_state** | エラー通知状態 | TD-028 §11.8 | **P1** | 🔴 |
| 5 | **05_sequence_modal** | 層2統合モーダル | TD-019 v2.0, TD-020 v2.0 | **P1** | 🔴 |
| 6 | 06_gui_only | Mode 2（GUIのみ） | TD-021 | P2 | 🔴 |
| 7 | 07_code_only | Mode 3（Codeのみ） | TD-021 | P2 | 🔴 |
| 8 | 08_ai_chat_collapsed | AIチャット折りたたみ | TD-032 | P2 | 🔴 |

**進捗: 2/8 完了（25%）**

---

## 3. 各ワイヤーフレームの仕様

### 3.1 01_default.excalidraw（基本状態）✅ 完成

**目的**: エディタ画面の基本レイアウトを定義

**表現する状態**:
- Mode 1（GUI 300px + Code 650px + Preview 962px）
- AIチャット展開（200px）
- 選択モードOFF（通常状態）
- エラーなし

**実装済みUI要素**:

| エリア | 要素 | 備考 | 状態 |
|--------|------|------|:----:|
| **ヘッダー** | Logo「PlantUML Studio」, ファイル名 | - | ✅ |
| **ヘッダー** | 保存インジケータ「●保存済」 | TD-027 | ✅ |
| **ヘッダー** | [保存][エクスポート]ボタン | - | ✅ |
| **ヘッダー** | パネルモードトグル [GUI+Code][GUI][Code] | TD-021 | ✅ |
| **ヘッダー** | [?]ヘルプボタン | TD-033 | ✅ |
| **GUIパネル** | タイトル + **選択モードトグル** | TD-028 | ✅ |
| **GUIパネル** | Section 1: 参加者（**リスト形式**） | [A][P][D] + [↑][↓][✏][🗑] | ✅ |
| **GUIパネル** | Section 2: メッセージ表示（展開） | ドラッグハンドル付きカード | ✅ |
| **GUIパネル** | Section 3-5: 折りたたみ状態 | フラグメント/ノート/スタイル | ✅ |
| **GUIパネル** | [シーケンス編集を開く]ボタン | →05_sequence_modal | ✅ |
| **Codeパネル** | タイトル + **選択モードトグル** | TD-028 | ✅ |
| **Codeパネル** | Monaco Editor領域 + 行番号 | - | ✅ |
| **Previewパネル** | タイトル + SVG表示領域 | - | ✅ |
| **Previewパネル** | ズームコントロール [−][+][Fit][1:1] | TD-030 | ✅ |
| **AIチャット** | タイトル + **選択モードトグル** | TD-028 | ✅ |
| **AIチャット** | **[学習モード]ボタン** | UC 4-1 Question-Start | ✅ |
| **AIチャット** | **[▶ 適用]ボタン** | TD-028 §11.5 | ✅ |
| **AIチャット** | **[再生成]ボタン** | TD-028 §11.8 | ✅ |
| **AIチャット** | 折りたたみトグル [▼] | TD-032 | ✅ |
| **AIチャット** | 入力欄 + 送信ボタン | - | ✅ |
| **リサイザー** | GUI↔Code, Code↔Preview, パネル↔AIChat | TD-023 | ✅ |

**注釈（実装済み）**:
- 【TD-023】基本レイアウト: GUI 300px / Code 650px / Preview 962px + リサイザー対応
- 【TD-021】Mode 1: GUI+Code+Preview（デフォルト）
- 【TD-032】AIチャット展開状態（200px）
- 【TD-028】選択モード: OFF（通常状態）
- 解像度: 1920×1080 基準

---

### 3.2 02_selection_mode.excalidraw（選択モードON）✅ 完成

**目的**: TD-028の対象コード指定メカニズムを表現

**表現する状態**:
- GUI/Codeパネル選択モードON（トグル黄色）
- 範囲選択中（黄色ハイライト、破線枠）
- 3パネル連動ハイライト（Code↔Preview）

**実装済みUI要素**:

| エリア | 要素 | 備考 | 状態 |
|--------|------|------|:----:|
| **GUIパネル** | 選択モードトグル（**ON状態**） | 黄色#FEF3CD、ノブ右寄せ | ✅ |
| **GUIパネル** | [選択クリア]ボタン | 黄色背景 | ✅ |
| **Codeパネル** | 選択モードトグル（**ON状態**） | 黄色#FEF3CD | ✅ |
| **Codeパネル** | 選択範囲ハイライト | 黄色背景、**破線枠** | ✅ |
| **Previewパネル** | 対応メッセージハイライト | 黄色背景、太枠 | ✅ |

**操作フロー注釈（キャンバス外）**:
```
① メッセージを選択
   ・選択されたカードは枠線が強調される
   ・複数選択時はCtrl+クリック

② 3パネル連動（Code）
   ↑ 選択したメッセージのコードがハイライト

③ 3パネル連動（Preview）
   ↑ 選択したメッセージの文字色が変わる
```

**注釈**:
- TD-028 §11.3 参照
- 「GUI/Code併用は排他（後から選択した方が有効）」
- スコア: 93.6点（合格）

---

### 3.3 03_ai_code_apply.excalidraw（AIコード適用フロー）

**目的**: TD-028の7ステップフローを表現

**表現する状態**:
- AIが回答済み（コードブロック表示中）
- AIチャット内で選択モードON
- 適用ボタンがアクティブ

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **AIチャット** | ユーザーメッセージ（依頼内容） | - |
| **AIチャット** | AI回答（説明文 + コードブロック） | - |
| **AIチャット** | コードブロック内トグル [選択モード: ON] | TD-028 §11.4 |
| **AIチャット** | 選択範囲ハイライト | ドラッグ選択中 |
| **AIチャット** | [📋 コピー]ボタン | - |
| **AIチャット** | [▶ 適用]ボタン（アクティブ） | - |
| **オーバーレイ** | 確認ダイアログ（任意） | 「選択したコードを適用しますか？」 |

**注釈**:
- TD-028 §11.2 フロー図参照
- TD-028 §11.5 適用処理参照
- TD-028 §11.6 依頼文フォーマット参照

**フロー説明（注釈として記載）**:
```
① 対象コード指定（GUI/Code）
② AIチャットで依頼入力
③ AI回答受信
④ AI回答からコード選択 ← このワイヤーフレームの状態
⑤ 適用ボタンクリック
⑥ システム処理
⑦ Preview反映
```

---

### 3.4 04_error_state.excalidraw（エラー通知状態）

**目的**: TD-028 §11.8のエラー修正機能を表現

**表現する状態**:
- PlantUML構文エラー発生
- Previewにエラーバナー表示
- Codeパネルにエラー行ハイライト

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **Codeパネル** | エラー行ハイライト（黄色背景） | TD-017準拠 |
| **Codeパネル** | ガター赤●アイコン | 行番号横 |
| **Previewパネル** | エラー通知バナー（上端） | 背景: #FFF3CD |
| **Previewパネル** | ⚠️アイコン + エラーメッセージ | - |
| **Previewパネル** | [再生成]ボタン | - |
| **Previewパネル** | [閉じる]ボタン | - |
| **AIチャット** | **エラー通知なし** | 会話履歴汚染防止 |

**注釈**:
- TD-028 §11.8 参照
- 「AIチャットにはエラー表示しない」
- 「5回目に警告、6回目以降は再生成ボタン非活性化」

---

### 3.5 05_sequence_modal.excalidraw（層2統合モーダル）

**目的**: TD-019 v2.0の2層統合モーダル構造を表現

**表現する状態**:
- モーダル表示中（900×700px）
- 展開式インライン編集

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **モーダルヘッダー** | 「シーケンス編集」タイトル | - |
| **モーダルヘッダー** | [×]閉じるボタン | - |
| **参加者管理** | 参加者チップ [Alice][Bob][Server][+追加] | - |
| **メッセージ一覧** | メッセージカード（ドラッグハンドル付き） | [≡][×] |
| **メッセージ一覧** | Noteカード（📝アイコン） | - |
| **メッセージ一覧** | フラグメントカード（🔀アイコン） | - |
| **展開式編集** | 折りたたみ/展開トグル | - |
| **展開式編集** | インラインフォーム（種類、条件、内容） | TD-019 v2.0 |
| **展開式編集** | 内包メッセージ管理 | フラグメント用 |
| **フッター** | [キャンセル][適用]ボタン | - |
| **追加ボタン** | [+追加 ▼]ドロップダウン | メッセージ/Note/フラグメント |

**注釈**:
- TD-019 v2.0 参照（v1.0の3層構造は却下）
- TD-020 v2.0 参照（2レベル編集構造）
- 「入れ子モーダルなし」

---

### 3.6 06_gui_only.excalidraw（Mode 2）

**目的**: TD-021のMode 2（非コーダー向け）を表現

**表現する状態**:
- GUIパネル 950px（拡張）
- Codeパネル非表示（内部維持）
- Previewパネル 962px

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **ヘッダー** | パネルモードトグル [GUI]選択状態 | - |
| **GUIパネル** | 950px幅（拡張表示） | - |
| **GUIパネル** | 5セクションアコーディオン（より広い表示） | - |
| **Codeパネル** | **非表示** | - |
| **Previewパネル** | 962px | - |

**注釈**:
- TD-021 参照
- 「Codeは内部で維持（非表示）」
- ショートカット: Ctrl+2

---

### 3.7 07_code_only.excalidraw（Mode 3）

**目的**: TD-021のMode 3（上級者向け）を表現

**表現する状態**:
- GUIパネル非表示
- Codeパネル 950px（拡張）
- Previewパネル 962px

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **ヘッダー** | パネルモードトグル [Code]選択状態 | - |
| **GUIパネル** | **非表示** | - |
| **Codeパネル** | 950px幅（拡張表示） | Monaco Editor |
| **Previewパネル** | 962px | - |

**注釈**:
- TD-021 参照
- ショートカット: Ctrl+3

---

### 3.8 08_ai_chat_collapsed.excalidraw（AIチャット折りたたみ）

**目的**: TD-032のAIチャット折りたたみ状態を表現

**表現する状態**:
- AIチャット折りたたみ（32px）
- 3パネルが縦方向に拡張

**必須UI要素**:

| エリア | 要素 | 備考 |
|--------|------|------|
| **AIチャット** | 32pxバー | - |
| **AIチャット** | 「AI Chat」ラベル | - |
| **AIチャット** | [▲]展開ボタン | - |
| **3パネル** | 縦方向拡張表示 | - |

**注釈**:
- TD-032 参照
- ショートカット: Ctrl+Shift+A
- 状態はlocalStorageに永続化

---

## 4. 作業順序

### 4.1 Phase 1（MVP必須 - P1）

```
01_default → 02_selection_mode → 03_ai_code_apply
→ 04_error_state → 05_sequence_modal
```

| 順序 | ファイル | 依存関係 |
|:----:|----------|---------|
| 1 | 01_default | なし（基盤） |
| 2 | 02_selection_mode | 01_defaultベース |
| 3 | 03_ai_code_apply | 01_defaultベース |
| 4 | 04_error_state | 01_defaultベース |
| 5 | 05_sequence_modal | 独立（モーダル） |

### 4.2 Phase 2（MVP推奨 - P2）

```
06_gui_only → 07_code_only → 08_ai_chat_collapsed
```

| 順序 | ファイル | 依存関係 |
|:----:|----------|---------|
| 6 | 06_gui_only | 01_defaultベース |
| 7 | 07_code_only | 01_defaultベース |
| 8 | 08_ai_chat_collapsed | 01_defaultベース |

---

## 5. 既存ファイルの扱い

### 5.1 アーカイブ対象

| ファイル | 対応 |
|---------|------|
| `default.excalidraw` (v3.0) | `archive/default_v3.0_archive.excalidraw`にリネーム |

### 5.2 アーカイブ理由

- TD-028の対象コード指定メカニズムが反映されていない
- 必要なUI要素の約40%が欠落
- 構造的な再設計が必要

---

## 6. レビュー基準

各ワイヤーフレーム作成後、以下の5パスレビューを実施：

| Pass | 観点 | チェック内容 |
|:----:|------|-------------|
| 1 | TD準拠 | 対応TDの仕様が正確に反映されているか |
| 2 | UI要素網羅 | 必須UI要素が全て含まれているか |
| 3 | 整合性 | 他ワイヤーフレームとの一貫性 |
| 4 | 注釈完備 | TD参照、操作説明が記載されているか |
| 5 | 低忠実度 | TD-015原則（手書き風、グレースケール）準拠 |

**合格基準**: 各パス90点以上

---

## 7. 関連ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| `02_screen_composition_analysis.md` v10.0 | TD-017〜TD-033詳細設計 |
| `docs/context/technical_decisions.md` | TD定義（ソース） |
| `docs/guides/ui_design/UI_Design_Constitution.md` | UI設計憲法 |
| `00_wireframe_index.md` | ワイヤーフレーム進捗管理 |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|:----------:|------|
| 2025-12-29 | v1.0 | 初版作成（Session 13） |
| 2025-12-29 | v1.1 | 01_default完成、進捗追加、UI要素詳細化 |
| 2025-12-29 | v1.2 | 02_selection_mode 93.6点✅完成（操作フロー注釈追加） |
