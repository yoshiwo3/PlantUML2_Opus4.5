# ワークシート（完全版 v3.0 - 知見公式反映完了）

**作業期間**: 2025-12-24 19:55 〜 2025-12-27（全4セッション）
**担当**: Claude + User協調作成
**データソース**: Claude Ops MCP
**総操作数**: 101件
**本ドキュメント特徴**: 技術仕様、意思決定理由、diff詳細、知見公式反映を完全記録

---

## 進捗サマリー

| 項目 | 状況 |
|------|------|
| **ワイヤーフレーム** | 2/19画面完了（10.5%）|
| **画面遷移図** | v1.2更新済み（8回編集）|
| **知見貢献** | EX-005, EX-006, EX-007追加（3件）|
| **ドキュメント更新** | 19件（4日間で8ファイル）|
| **active_context更新** | 17件 |
| **セッション数** | 4セッション（4日間）|
| **技術設計書** | 1件（search_functionality_design.md: 262行）|
| **知見公式反映** | Session 4で完了（5操作）|

---

## 操作統計（Claude Ops完全版）

### 日付別操作数

| 日付 | ファイル変更 | Bash | 合計 | セッション |
|------|:-----------:|:----:|-----:|:----------:|
| 2025-12-24 | 1 | 2 | 3 | Session 1 |
| 2025-12-25 | 7 | 2 | 9 | Session 1.5 |
| 2025-12-26 | 24 | 6 | 30 | Session 2 |
| 2025-12-27 | 33 | 21 | 54 | Session 3 |
| 2025-12-27 | 5 | 0 | 5 | Session 4 |
| **合計** | **70** | **31** | **101** | **4** |

### カテゴリ別操作数

| カテゴリ | 件数 | 詳細 |
|---------|-----:|------|
| Evidence/wireframes | 26 | excalidraw, index, README |
| active_context.md | 17 | 進捗管理更新 |
| 99_screen_transition.puml | 8 | 画面遷移図v1.0→v1.1→v1.2 |
| UI_Design Guide | 19 | Constitution, Knowledge Base, Session Start, Authoring Guide, Patterns（**+5件 Session 4**）|
| Bash | 31 | mkdir, mv, npm, java, grep等 |

---

## 技術仕様詳細

### 1. ワイヤーフレーム技術仕様

#### TD-015準拠設定

| 項目 | 値 | 説明 |
|------|-----|------|
| roughness | 1 | 手書き風（0-2、大きいほど粗い） |
| strokeStyle | solid | 実線 |
| 背景色 | #ffffff | 白（グレースケール）|
| 枠線色 | #1e1e1e | 黒（グレースケール）|
| テキスト | #1e1e1e | 黒 |
| サブテキスト | #6b7280 | グレー |

#### Excalidrawファイル構造

```json
{
  "type": "excalidraw",
  "version": 2,
  "source": "excalidraw",
  "elements": [
    {
      "type": "rectangle",
      "id": "unique-id",
      "x": 0, "y": 0,
      "width": 800, "height": 600,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "#ffffff",
      "roughness": 1,
      "strokeStyle": "solid"
    }
  ],
  "appState": {
    "viewBackgroundColor": "#ffffff",
    "gridSize": null
  }
}
```

#### z-index仕様（重要）

```
問題: Excalidrawでは要素の配列順序がz-indexを決定
      配列の後ろの要素ほど前面に表示される

発見操作: #53（09:45:56）
解決策: 状態別ファイル分離
        → 検索ドロップダウン要素を別ファイルに
```

### 2. 検索機能設計（search_functionality_design.md）

#### 技術スタック

| 項目 | MVP | v3+ |
|------|-----|-----|
| 検索対象 | プロジェクト名、図表名 | + 内容全文 |
| 検索方式 | クライアントサイドフィルタ | DB全文検索 |
| データソース | Storage API | Supabase DB |
| デバウンス | 200ms | 200ms |
| UI | ドロップダウン | + フィルタパネル |

#### useSearchフック仕様

```typescript
interface SearchResults {
  projects: Project[];
  diagrams: Diagram[];
}

function useSearch(
  projects: Project[],
  diagrams: Diagram[]
): {
  query: string;
  setQuery: (q: string) => void;
  results: SearchResults;
  isSearching: boolean;  // debounce中はtrue
}
```

#### TD-006（Storage Only MVP）との整合性

| 検索方式 | MVP | 理由 |
|----------|:---:|------|
| ファイル名検索 | ✅ | Storage metadata取得可能 |
| 内容検索 | ⚠️ | 全ファイル読込必要（高コスト）|
| 全文検索 | ❌ | DB必須 |
| セマンティック検索 | ❌ | Embedding + DB必須 |

### 3. 画面遷移図仕様

#### バージョン履歴

| Ver | 日付 | 変更内容 | 操作# |
|:---:|------|---------|:-----:|
| 1.0 | - | 初版（19画面）| - |
| 1.1 | 12/25 | OAuth-only対応（signup/reset削除、17画面）| #4 |
| 1.2 | 12/27 | 学習コンテンツ画面追加（18画面）| #66-69 |

#### v1.2 追加内容（diff詳細）

```diff
' ========== 学習コンテンツ ==========
dashboard --> learning_content : 学習

' ========== ログアウト ==========
+learning_content --> [*] : ログアウト

+note right of learning_content
+  学習コンテンツ:
+  - PlantUML構文ガイド
+  - テンプレートサンプル
+  - カテゴリ別検索
+  - キーワード検索
+end note
```

#### 画面数推移

| 画面群 | v1.0 | v1.1 | v1.2 |
|--------|:----:|:----:|:----:|
| 認証 | 3 | 1 | 1 |
| メイン | 3 | 3 | 4 |
| モーダル | 5 | 5 | 5 |
| 管理 | 5 | 5 | 5 |
| 学習 | - | - | 1 |
| **合計** | **16** | **14** | **16** |

※ 実際の画面リストでは19画面（状態別カウント含む）

---

## 意思決定詳細

### 決定#1: フォルダ命名規則

| 項目 | 内容 |
|------|------|
| **決定時刻** | 09:55（操作#55-57）|
| **却下案** | `main/`, `modal/`, `admin/`（カテゴリ別）|
| **採用案** | `01_login/`, `02_dashboard/`, ...（番号プレフィックス）|

**却下理由**:
- カテゴリ別だとファイラーでの並び順が不定
- 画面遷移図との対応が不明確
- 新規画面追加時の配置が曖昧

**採用理由**:
- ファイラーでの並び順が画面遷移図と一致
- 新規画面追加時の番号割当が明確
- README等で画面説明を添付可能

**操作履歴**:
```
#55 09:51:26 mkdir main/ modal/ admin/  ← 却下案を試行
#56 09:55:01 rm -rf main/ modal/ admin/ ← 却下案を削除
#57 09:56:47 mkdir 01_login/ 02_dashboard/ ... ← 採用案を実施
```

### 決定#2: 状態管理

| 項目 | 内容 |
|------|------|
| **決定時刻** | 10:00（操作#64-65）|
| **却下案** | 1ファイルに複数状態 |
| **採用案** | 状態別ファイル分離 |

**却下理由**:
- z-index問題が解決困難
- 状態切替のUI実装が複雑
- ファイルサイズが肥大化

**採用理由**:
- z-index問題を根本解決
- 状態別に独立編集可能
- Obsidianでの閲覧性向上

**z-index問題の詳細**:
```
現象: 検索ドロップダウンがプロジェクトカードの背後に表示
原因: Excalidrawの要素配列順序がz-indexを決定
      配列の後ろの要素ほど前面に表示

試行1: 要素を配列末尾に移動 → 他要素との干渉
試行2: グループ化 → z-index問題は解決せず
解決: 状態別ファイル分離
      - default.excalidraw: 通常状態（検索閉じ）
      - search_active.excalidraw: 検索ドロップダウン表示
```

### 決定#3: index.md形式

| 項目 | 内容 |
|------|------|
| **決定時刻** | 10:32（操作#75-78）|
| **却下案** | `[[path.excalidraw]]` リンク形式 |
| **採用案** | `![[path.excalidraw]]` 埋め込み形式 |

**試行履歴**:
```
#75 10:15:52 テーブル形式           → 基本形
#76 10:18:54 [[path.excalidraw]]    → プレビュー非表示
#77 10:28:49 リンク形式修正         → 戻るボタン問題発見！
#78 10:32:03 ![[path.excalidraw]]   → 成功（EX-005）
```

**戻るボタン問題**:
```
現象: リンククリック後、戻るボタンで元のスクロール位置に戻らない
原因: Obsidianの仕様（新しいファイルを開くとスクロール位置リセット）
影響: 複数ワイヤーフレームのレビュー時に閲覧効率低下
解決: 埋め込み形式 ![[...]] を使用
      → ファイル遷移なしでスクロールして全画面確認可能
```

---

## 知見詳細

### EX-005: Embedded Index Pattern

| 項目 | 内容 |
|------|------|
| **発見日時** | 2025-12-27 10:32 |
| **発見経緯** | index.md形式の試行錯誤（4回のWrite操作: #75-78）|
| **問題** | リンククリック後に戻るボタンで位置がリセットされる |
| **解決** | `![[path.excalidraw]]` 埋め込み形式で一覧表示 |

### EX-006: z-index問題（配列順序依存）

| 項目 | 内容 |
|------|------|
| **発見日時** | 2025-12-27 09:45 |
| **発見経緯** | ダッシュボード検索ドロップダウン作成時（操作#53）|
| **問題** | 検索ドロップダウンがプロジェクトカードの背後に表示される |
| **原因** | Excalidrawでは要素の配列順序がz-indexを決定 |
| **解決** | 状態別ファイル分離（EX-007）を採用 |
| **公式反映** | Session 4（操作#97）でUI_Design_Knowledge_Base.mdに追加 |

### EX-007: 状態別ファイル分離パターン

| 項目 | 内容 |
|------|------|
| **発見日時** | 2025-12-27 10:00 |
| **発見経緯** | z-index問題（EX-006）の解決策として（操作#64-65）|
| **問題** | 1ファイルに複数状態を入れるとz-index問題・編集困難が発生 |
| **解決** | 画面状態ごとにファイル分離（default.excalidraw + state.excalidraw）|
| **公式反映** | Session 4（操作#97）でUI_Design_Knowledge_Base.mdに追加 |

#### 反映先ドキュメント（操作#79-84）

| ファイル | 追加内容 | 操作# |
|---------|---------|:-----:|
| UI_Design_Knowledge_Base.md | EX-005本文（40行）+ 更新履歴v1.2 | #79-80 |
| 00_Session_Start.md | Step 4.5（15行）+ 更新履歴v1.5 | #81-82 |
| 02_Authoring_Guide.md | §4.4（18行）+ 更新履歴 | #83-84 |

#### 推奨ファイル構成

```
wireframes/
├── 00_wireframe_index.md      ← 閲覧用（埋め込み一覧）
├── 01_login/
│   └── default.excalidraw     ← 編集用（基本状態）
├── 02_dashboard/
│   ├── default.excalidraw
│   └── search_active.excalidraw  ← 編集用（派生状態）
└── ...
```

#### 命名規則

| 要素 | 規則 | 例 |
|------|------|-----|
| インデックス | `00_` プレフィックス | `00_wireframe_index.md` |
| 画面フォルダ | `XX_screen_name/` | `02_dashboard/` |
| 基本状態 | `default.excalidraw` | 通常表示 |
| 派生状態 | `<state>.excalidraw` | `search_active.excalidraw` |

---

## ファイル別操作詳細

### Evidence/wireframes（26件）

| ファイル | 操作数 | 最終更新 | 主要内容 |
|---------|-------:|---------|---------|
| `01_login.excalidraw` | 3 | 2025-12-26 08:07 | OAuth認証ボタン、TD-015準拠 |
| `02_dashboard.excalidraw`（旧） | 6 | 2025-12-27 09:45 | 検索・カード一覧・z-index問題対応 |
| `02_dashboard/default.excalidraw` | 1 | 2025-12-27 10:00 | 状態分離版（通常状態）|
| `02_dashboard/search_active.excalidraw` | 1 | 2025-12-27 10:02 | 状態分離版（検索表示）|
| `00_wireframe_index.md` | 5 | 2025-12-27 10:32 | EX-005埋め込み形式 |
| `search_functionality_design.md` | 1 | 2025-12-27 09:09 | 262行技術設計書 |
| `01_login/README.md` | 1 | 2025-12-27 09:58 | 画面説明 |
| `02_dashboard/README.md` | 1 | 2025-12-27 09:58 | 画面説明 |
| `instructions.md` | 1 | 2025-12-27 15:10 | 作業指示書 |
| `00_raw_notes.md` | 2 | 2025-12-27 15:17 | 作業メモ |
| `work_sheet.md` | 2 | 2025-12-27 15:18 | ワークシート |

### active_context.md（17件）

| 日付 | 時刻範囲 | 操作数 | 内容 |
|------|---------|-------:|------|
| 2025-12-26 | 08:10:04〜08:16:45 | 12 | OAuth-only対応、ダッシュボード完成 |
| 2025-12-27 | 10:04:03〜10:05:24 | 5 | フォルダ再構成、画面遷移図v1.2、進捗更新 |

### 99_screen_transition.puml（8件）

| 日付 | 時刻範囲 | 操作数 | 内容 |
|------|---------|-------:|------|
| 2025-12-25 | 08:08:21 | 1 | v1.0→v1.1（OAuth-only設計対応）|
| 2025-12-26 | 07:40:28〜07:40:32 | 3 | v1.2更新開始 |
| 2025-12-27 | 10:02:58〜10:03:27 | 4 | 学習コンテンツ画面追加完了 |

### UI_Design Guide（19件）

| ファイル | 操作数 | 更新日 | 主要変更 |
|---------|-------:|--------|---------|
| `UI_Design_Constitution.md` | 4 | 12/25, 12/27 | §6.3.5コマンド追加、v3.4 |
| `UI_Design_Knowledge_Base.md` | **6** | 12/25, 12/27 | EX-005追加→**EX-006/EX-007追加、v1.3** |
| `UI_Design_Patterns.md` | 2 | 12/25 | 初期設定 |
| `02_Authoring_Guide.md` | **5** | 12/25, 12/27 | §4.4追加→**§4.5/§4.6追加** |
| `00_Session_Start.md` | 2 | 12/27 | Step 4.5追加、v1.5 |

---

## ワイヤーフレーム進捗（19画面）

### 認証画面群（1画面）

| # | 画面名 | 状態 | ファイル | 操作数 |
|:-:|--------|:----:|---------|:------:|
| 01 | ログイン | ✅ | `01_login/default.excalidraw` | 3 |

### メイン画面群（4画面）

| # | 画面名 | 状態 | ファイル | 操作数 |
|:-:|--------|:----:|---------|:------:|
| 02 | ダッシュボード（通常）| ✅ | `02_dashboard/default.excalidraw` | 7 |
| 02 | ダッシュボード（検索）| ✅ | `02_dashboard/search_active.excalidraw` | 1 |
| 03 | プロジェクト詳細 | 🔴 | - | - |
| 04 | エディタ | 🔴 | - | - |
| 15 | 学習コンテンツ | 🔴 | - | - |

### モーダル群（5画面）

| # | 画面名 | 状態 |
|:-:|--------|:----:|
| 05 | プロジェクト作成 | 🔴 |
| 06 | プロジェクト編集 | 🔴 |
| 07 | 図表作成 | 🔴 |
| 08 | エクスポート | 🔴 |
| 09 | 削除確認 | 🔴 |

### 管理画面群（5画面）

| # | 画面名 | 状態 |
|:-:|--------|:----:|
| 10 | 管理ダッシュボード | 🔴 |
| 11 | ユーザー管理 | 🔴 |
| 12 | LLMモデル管理 | 🔴 |
| 13 | 使用量監視 | 🔴 |
| 14 | 学習コンテンツ管理 | 🔴 |

---

## セッション統計

| セッション | 日付 | 操作数 | 主要成果 |
|:----------:|------|:------:|---------|
| 1 | 2025-12-24 | 3 | プロジェクト初期化、ログイン画面作成 |
| 1.5 | 2025-12-25 | 9 | 画面遷移図v1.1・ガイドドキュメント更新 |
| 2 | 2025-12-26 | 30 | ダッシュボード作成、active_context更新、PNG生成 |
| 3 | 2025-12-27 | 54 | 検索設計、EX-005発見、フォルダ再構成、Evidence作成 |
| **4** | 2025-12-27 | **5** | **EX-006/EX-007公式反映、§4.5/§4.6追加、v1.3/v3.0** |
| **合計** | - | **101** | **3知見追加、19件ドキュメント更新** |

---

## 画面遷移図更新詳細

| 項目 | 内容 |
|------|------|
| **更新バージョン** | v1.0 → v1.1 → v1.2 |
| **編集回数** | 8回（3日間）|
| **追加内容** | 学習コンテンツ画面（learning_content）|
| **対応UC** | UC 3-10, 3-11 |
| **PNG生成回数** | 6回 |

### v1.2 diff詳細

```diff
-' バージョン: 1.1 (OAuth-only設計対応)
+' バージョン: 1.2 (学習コンテンツ画面追加)

 ' ========== ログアウト ==========
 dashboard --> [*] : ログアウト
 editor --> [*] : ログアウト
+learning_content --> [*] : ログアウト
 admin_dashboard --> [*] : ログアウト

+note right of learning_content
+  学習コンテンツ:
+  - PlantUML構文ガイド
+  - テンプレートサンプル
+  - カテゴリ別検索
+  - キーワード検索
+end note
```

---

## 次のアクション

| # | タスク | 優先度 | 備考 |
|:-:|--------|:------:|------|
| 1 | #03 プロジェクト詳細画面作成 | MVP | メイン画面群 |
| 2 | #04 エディタ画面作成 | MVP | メイン画面群 |
| 3 | #15 学習コンテンツ画面作成 | MVP | 画面遷移図v1.2追加分 |
| 4 | モーダル群（5画面）作成 | MVP | 05-09 |
| 5 | 各画面の評価実施 | - | 90点以上目標 |

---

## 完了条件チェック

- [x] Evidence 3点セット作成
- [x] 操作マトリックス表作成
- [x] 全操作の詳細記録（**101件完備**）
- [x] diff詳細記録（主要操作）
- [x] 技術仕様記録
- [x] 意思決定理由記録
- [x] **知見公式反映完了（EX-005/EX-006/EX-007）**
- [x] **ガイドライン更新完了（§4.5/§4.6追加）**
- [ ] 全19画面のワイヤーフレーム作成（3/19状態別カウント）
- [ ] 各画面90点以上の評価
- [ ] 画面遷移図の整合性確認

---

## 関連ファイル

| ファイル | 内容 |
|---------|------|
| `operation_matrix.md` | 操作マトリックス表（抜け漏れチェック用）v3.0 |
| `00_raw_notes.md` | 作業メモ（**101件**全操作記録 + diff詳細）v3.0 |
| `instructions.md` | 作業指示書 |
| `search_design/search_functionality_design.md` | 検索機能設計書（262行）|

---

## Session 4 操作詳細（知見公式反映）

**日時**: 2025-12-27 16:06〜16:07
**操作数**: 5件
**目的**: Evidence-only知見の公式ドキュメント反映

### 操作一覧

| # | 時刻(JST) | 操作 | ファイル | 変更内容 |
|:-:|-----------|------|---------|---------|
| 97 | 16:06:04 | Edit | `UI_Design_Knowledge_Base.md` | EX-006（z-index問題）、EX-007（状態分離パターン）追加 |
| 98 | 16:06:45 | Edit | `02_Authoring_Guide.md` | §4.5（フォルダ命名規則）、§4.6（TD-015設定値一覧）追加 |
| 99 | 16:06:56 | Edit | `02_Authoring_Guide.md` | 更新履歴追加 |
| 100 | 16:07:13 | Edit | `UI_Design_Knowledge_Base.md` | 更新履歴v1.3追加 |
| 101 | 16:07:20 | Edit | `UI_Design_Knowledge_Base.md` | ヘッダーバージョン更新（v1.2→v1.3）|

### 反映成果

| 反映先 | 追加内容 | 効果 |
|--------|---------|------|
| `UI_Design_Knowledge_Base.md` | EX-006, EX-007 | z-index問題の知識継承 |
| `02_Authoring_Guide.md` | §4.5, §4.6 | 命名規則・設定値の標準化 |

### 反映前後の状態

| 項目 | 反映前 | 反映後 |
|------|--------|--------|
| Knowledge Base | EX-001〜EX-005（5件）| EX-001〜EX-007（7件）|
| Authoring Guide | §1〜§4.4 | §1〜§4.6 |
| 公式未反映知見 | 5件 | 0件 ✅ |

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|:----------:|------|---------|
| v1.0 | 2025-12-27 15:13 | 初版作成 |
| v2.0 | 2025-12-27 15:18 | 技術仕様詳細追加、96件完全版 |
| **v3.0** | **2025-12-27 16:30** | **Session 4追加（101件）、知見公式反映完了** |
