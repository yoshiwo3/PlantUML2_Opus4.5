# 作業指示書: 3.10 学習コンテンツフロー作成

**作成日**: 2025-12-11
**作業者**: Claude Code (Opus 4.5)

---

## 1. 目標

業務フロー図 3.10「学習コンテンツフロー」を作成し、エンドユーザー向け学習コンテンツ機能の業務プロセスを可視化する。

## 2. コンテキスト

### 対象ユースケース
- UC 3-10: 学習コンテンツを検索する
- UC 3-11: 学習コンテンツを確認する

### 関連ユースケース
- UC 4-2: 目的別AIチャットを利用する（<<extends>>関連）
- UC 3-3: 図表を編集する（エディタからの起動トリガー）

### 除外
- UC 5-11, 5-12: 管理者向けコンテンツ登録・管理（3.11に追加済み）

## 3. 確定済み要件（17項目）

| # | 項目 | 決定内容 |
|:-:|------|---------|
| 1 | 利用シーン | エディタ内ヘルプ + 独立した学習画面（両方） |
| 2 | 検索方式 | RAG検索（pgvector + OpenRouter） |
| 3 | コンテンツ種類 | PlantUML構文 + 設計手法・ベストプラクティス |
| 4 | エディタ内起動 | ボタン + ショートカット + テキスト選択（複合） |
| 5 | 回答表示 | AI生成回答 + 参照元リンク |
| 6 | 学習画面機能 | カテゴリブラウズ + RAG検索 + チュートリアル + お気に入り |
| 7 | UI配置 | トグル式サイドパネル（開閉可能） |
| 8 | チュートリアル形式 | インタラクティブ形式（説明→コード編集→プレビュー確認） |
| 9 | お気に入り対象 | コンテンツ記事 + コードスニペット |
| 10 | 学習進捗 | 進捗率 + バッジ（達成バッジ付与） |
| 11 | カテゴリ構成 | 図表タイプ別 × 目的別（2階層） |
| 12 | 技術構成 | TD-007準拠（OpenAI Embedding + OpenRouter LLM + Supabase pgvector） |
| 13 | エラー時 | AI回答「コンテンツ外」明示 + 関連カテゴリへの誘導 |
| 14 | 管理者機能 | 完全分離（3.10=エンドユーザー、UC 5-11/5-12は3.11に追加） |
| 15 | スニペット利用 | コピーボタン + ワンクリック挿入ボタン |
| 16 | エディタ連携 | テキスト選択→検索クエリ+コンテキストとして活用 |
| 17 | データ保存 | ハイブリッド（進捗・お気に入りはDB、スニペットはStorage） |

## 4. 実施内容

### 成果物
| # | 成果物 | 保存先 |
|:-:|--------|--------|
| 1 | 3.10.1 エディタ内ヘルプフロー (.puml) | 本ディレクトリ |
| 2 | 3.10.2 学習画面フロー (.puml) | 本ディレクトリ |
| 3 | 正式版SVG | docs/proposals/diagrams/business_flow/ |
| 4 | ドキュメント追記 | docs/proposals/PlantUML_Studio_業務フロー図_20251201.md |

### フロー構成

**3.10.1 エディタ内ヘルプフロー**
- エディタからの起動（ボタン/ショートカット/テキスト選択）
- RAG検索実行
- AI回答生成・表示
- スニペット挿入
- エラーハンドリング

**3.10.2 学習画面フロー**
- 学習画面アクセス
- カテゴリブラウズ
- RAG検索
- チュートリアル実行
- お気に入り登録
- 進捗記録・バッジ付与

### スイムレーン構成
- エンドユーザー
- Frontend Service
- Backend API
- Supabase
- OpenAI
- OpenRouter

## 5. 完了条件

- [ ] 3.10.1 エディタ内ヘルプフロー PlantUMLコード作成
- [ ] 3.10.2 学習画面フロー PlantUMLコード作成
- [ ] PNG生成・4パスレビュー完了
- [ ] SVG生成（-Publish）
- [ ] 業務フロー図ドキュメント追記
- [ ] active_context.md更新（業務フロー図 11/11完了）

## 6. 制約・注意事項

### PlantUML制約（P1-P8）
- **P1最重要**: if/fork/switch内でスイムレーン遷移禁止（70%で問題発生）
- 回避策: switch全体を1スイムレーン内に収め、noteで詳細説明

### 共通制約（C1-C6）
- 既存ドキュメントとの整合性維持
- Evidence 3点セット完備
- 作業完了時にactive_context.md更新

## 7. 参照ドキュメント

- `docs/guides/PlantUML_Development_Constitution.md` - PlantUML開発憲法
- `docs/proposals/PlantUML_Studio_ユースケース図_20251130.md` - UC 3-10, 3-11定義
- `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` - 既存業務フロー図
- `docs/context/technical_decisions.md` - TD-007（AI機能構成）
