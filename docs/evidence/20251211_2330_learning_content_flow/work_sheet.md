# Work Sheet: 3.10 学習コンテンツフロー

**作成日**: 2025-12-12
**作業期間**: 2025-12-11 23:30 〜 2025-12-12 00:30
**ステータス**: 完了

---

## 作業概要

### 目的

業務フロー図 3.10「学習コンテンツフロー」（UC 3-10, 3-11）の作成

### 対象ユースケース

| UC | 名称 | 優先度 |
|:--:|------|:------:|
| UC 3-10 | 学習コンテンツを検索する | Phase 2 |
| UC 3-11 | 学習コンテンツを確認する | Phase 2 |

---

## 作業結果

### 成果物一覧

| # | 成果物 | ファイルパス |
|:-:|--------|-------------|
| 1 | 3.10.1 エディタ内ヘルプフロー（.puml） | `docs/evidence/20251211_2330_learning_content_flow/3_10_1_editor_help_flow.puml` |
| 2 | 3.10.1 PNG | `docs/evidence/20251211_2330_learning_content_flow/3_10_1_editor_help_flow.png` |
| 3 | 3.10.1 レビューログ | `docs/evidence/20251211_2330_learning_content_flow/3_10_1_editor_help_flow.review.json` |
| 4 | 3.10.1 SVG（正式版） | `docs/proposals/diagrams/business_flow/3_10_1_editor_help_flow.svg` |
| 5 | 3.10.2 学習画面フロー（.puml） | `docs/evidence/20251211_2330_learning_content_flow/3_10_2_learning_screen_flow.puml` |
| 6 | 3.10.2 PNG | `docs/evidence/20251211_2330_learning_content_flow/3_10_2_learning_screen_flow.png` |
| 7 | 3.10.2 レビューログ | `docs/evidence/20251211_2330_learning_content_flow/3_10_2_learning_screen_flow.review.json` |
| 8 | 3.10.2 SVG（正式版） | `docs/proposals/diagrams/business_flow/3_10_2_learning_screen_flow.svg` |

### ドキュメント更新

| ファイル | 更新内容 |
|---------|---------|
| `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` | 3.10セクション追加（2558行〜3085行） |
| `docs/context/active_context.md` | 業務フロー図進捗100%、UCカバレッジ更新 |

---

## 4パスレビュー結果

### 3.10.1 エディタ内ヘルプフロー

| Pass | チェック項目 | 結果 | 備考 |
|:----:|-------------|:----:|------|
| 1 | 構造（スイムレーン、start/stop） | ✅ | 6スイムレーン、正常終了 |
| 2 | 接続（孤立ノードなし） | ✅ | 全ノード接続確認 |
| 3 | 内容（テキスト正確性） | ✅ | 要件17項目と整合 |
| 4 | スタイル（色分け、note配置） | ✅ | 適切 |

### 3.10.2 学習画面フロー

| Pass | チェック項目 | 結果 | 備考 |
|:----:|-------------|:----:|------|
| 1 | 構造（スイムレーン、start/stop） | ✅ | 6スイムレーン、正常終了 |
| 2 | 接続（孤立ノードなし） | ✅ | 全ノード接続確認 |
| 3 | 内容（テキスト正確性） | ✅ | 要件17項目と整合 |
| 4 | スタイル（色分け、note配置） | ✅ | 適切 |

---

## 確定済み要件（17項目）

プランモードで確定した要件：

| # | 項目 | 決定内容 |
|:-:|------|---------|
| 1 | 利用シーン | エディタ内ヘルプ + 独立した学習画面（両方） |
| 2 | 検索方式 | RAG検索（pgvector + OpenRouter） |
| 3 | コンテンツ種類 | PlantUML構文 + 設計手法・ベストプラクティス |
| 4 | エディタ内起動 | ボタン + ショートカット + テキスト選択（複合） |
| 5 | 回答表示 | AI生成回答 + 参照元リンク |
| 6 | 学習画面機能 | カテゴリブラウズ + RAG検索 + チュートリアル + お気に入り |
| 7 | UI配置 | トグル式サイドパネル（開閉可能） |
| 8 | チュートリアル形式 | インタラクティブ形式（説明→コード編集→プレビュー確認） |
| 9 | お気に入り対象 | コンテンツ記事 + コードスニペット |
| 10 | 学習進捗 | 進捗率 + バッジ（達成バッジ付与） |
| 11 | カテゴリ構成 | 図表タイプ別 × 目的別（2階層） |
| 12 | 技術構成 | TD-007準拠（OpenAI Embedding + OpenRouter LLM + Supabase pgvector） |
| 13 | エラー時 | AI回答「コンテンツ外」明示 + 関連カテゴリへの誘導 |
| 14 | 管理者機能 | 完全分離（3.10=エンドユーザー、UC 5-11/5-12は3.11に追加予定） |
| 15 | スニペット利用 | コピーボタン + ワンクリック挿入ボタン |
| 16 | エディタ連携 | テキスト選択→検索クエリ+コンテキストとして活用 |
| 17 | データ保存 | ハイブリッド（進捗・お気に入りはDB、スニペットはStorage） |

---

## 技術構成（TD-007準拠）

| 機能 | プロバイダー | 用途 |
|------|-------------|------|
| Embedding | OpenAI（直接接続） | クエリ・コンテンツのベクトル化（text-embedding-3-small, 1536次元） |
| LLM | OpenRouter | AI回答生成（RAGベース） |
| ベクトルDB | Supabase pgvector | ベクトル類似度検索 + 全文検索（Hybrid Search） |

---

## データモデル

| テーブル名 | 用途 | 主要カラム |
|-----------|------|-----------|
| `learning_categories` | カテゴリ管理 | id, parent_id, name, diagram_type, purpose, order |
| `learning_contents` | コンテンツ本体 | id, category_id, title, body, difficulty, duration, embedding |
| `tutorials` | チュートリアル | id, content_id, steps (JSON), validation_rules |
| `user_progress` | 進捗管理 | user_id, content_id, completed, completed_at |
| `user_favorites` | お気に入り | user_id, target_type, target_id |
| `user_badges` | バッジ管理 | user_id, badge_type, earned_at |

---

## 進捗への影響

### 業務フロー図

| 項目 | 変更前 | 変更後 |
|------|:------:|:------:|
| 業務フロー図進捗 | 10/11（91%） | **11/11（100%）** |
| MVP必須 | 9/9完了 | 9/9完了（変更なし） |
| Phase 2 | 1/2完了 | **2/2完了** |

### UCカバレッジ

| 項目 | 変更前 | 変更後 |
|------|:------:|:------:|
| 全体 | 28/32（87.5%） | **30/32（93.75%）** |
| 図表操作パッケージ | 9/11 | **11/11** |
| 未カバー（Phase 2） | 4件 | **2件**（UC 5-11, 5-12のみ） |

---

## 次のアクション

1. **Phase 4: シーケンス図**（残り5件）
   - 編集プレビュー（UC 3-3, 3-4）
   - 保存（UC 3-5）
   - エクスポート（UC 3-6）
   - AI Question-Start（UC 4-1）
   - AIチャット（UC 4-2）

2. **残りの図表作成**
   - 画面遷移図
   - ワイヤーフレーム
   - コンポーネント図
   - 外部インターフェース一覧
   - 非機能要件一覧表
   - アクター権限マトリクス

---

## 備考

- 前セッション（2025-12-11 23:30）でプランニング・PNG生成・SVG生成まで完了
- 本セッションでドキュメント追記・active_context.md更新を実施
- UC 5-11, 5-12（学習コンテンツ管理）は管理者機能のため、3.11に含めることを検討中だが、現時点では未着手
