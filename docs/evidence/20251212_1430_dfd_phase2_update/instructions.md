# 作業指示書: DFD Phase 2更新

## 基本情報

| 項目 | 内容 |
|------|------|
| 作業日 | 2025-12-12 |
| 作業者 | Claude (Opus 4.5) |
| タスク | DFD v3.1 → v4.0（Phase 2機能追加） |

## 目的

業務フロー図3.10/3.11で定義したPhase 2機能をDFDに反映し、ドキュメント間の整合性を確保する。

## 対象UC（全7UC）

| UC番号 | 機能名 | カテゴリ |
|:------:|--------|---------|
| UC 3-10 | 学習コンテンツ検索 | エンドユーザー向け |
| UC 3-11 | 学習コンテンツ確認 | エンドユーザー向け |
| UC 5-6 | LLMワークフロー定義 | 管理機能 |
| UC 5-9 | Embeddingモデル設定 | 管理機能 |
| UC 5-10 | Embedding使用量監視 | 管理機能 |
| UC 5-11 | 学習コンテンツ登録 | 管理機能 |
| UC 5-12 | 学習コンテンツ管理 | 管理機能 |

## 追加要素

### 新規プロセス（P8.0〜P11.0）

| プロセスID | プロセス名 | 対応UC |
|:----------:|-----------|--------|
| P8.0 | 学習コンテンツ | UC 3-10, 3-11 |
| P9.0 | LLMワークフロー管理 | UC 5-6 |
| P10.0 | Embedding管理 | UC 5-9, 5-10 |
| P11.0 | 学習コンテンツ管理 | UC 5-11, 5-12 |

### 新規データストア（D3〜D5）

| データストアID | 名称 |
|:--------------:|------|
| D3 | 学習コンテンツDB |
| D4 | LLM設定・ログDB |
| D5 | Embedding設定DB |

### 新規データフロー（DF-25〜DF-50）

- DF-25〜DF-34: 学習コンテンツ関連
- DF-35〜DF-44: Phase 2管理機能関連
- DF-45〜DF-50: 学習コンテンツ管理関連

## 参照ドキュメント

| ファイル | 参照目的 |
|---------|---------|
| docs/proposals/PlantUML_Studio_データフロー図_20251208.md | 更新対象（v3.1） |
| docs/proposals/PlantUML_Studio_業務フロー図_20251201.md | 3.10/3.11の詳細フロー |
| docs/context/technical_decisions.md | TD-007/008/009 |
| docs/guides/PlantUML_Development_Constitution.md | PlantUML開発憲法 |

## 作業手順（憲法準拠）

### テキスト更新（Phase 2-4, 6-7）
1. 対象範囲・除外機能・マイクロサービス対応表の更新
2. データディクショナリ追加（D3/D4/D5）
3. データフロー定義（DF-25〜DF-50）
4. Level 2サブプロセス定義
5. 整合性確認・バランシング検証

### PlantUML作成（Phase 5）※憲法§1準拠
1. Context7でDFD構文確認
2. 憲法§2/§3確認（禁止事項・既知制限）
3. コード作成（.puml）
4. PNG生成（-Review）
5. 視覚的レビュー（4パス方式）
6. ソース+PNG対比確認
7. レビューログ更新
8. SVG生成（-Publish -DiagramType dfd）

## 完了条件

1. DFD v4.0が完成している
2. 全7UCがDFDでカバーされている
3. バランシング検証（Level 0 ↔ Level 1 ↔ Level 2）が完了している
4. Level 1のSVGが生成されている（憲法準拠レビュー完了）
5. work_sheet.mdが作成されている
