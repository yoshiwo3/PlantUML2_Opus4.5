# 業務フロー図作成 ワークシート

## 作業サマリー

| 項目 | 内容 |
|------|------|
| **作業名** | PlantUML Studio 業務フロー図の正式版作成 |
| **作成日** | 2025-12-01 |
| **ステータス** | 完了 |
| **成果物** | `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` |

---

## 完了条件チェックリスト

| # | 条件 | 状態 |
|---|------|:----:|
| 1 | 3つの業務フローがPlantUML構文で正しく記述されている | ✅ |
| 2 | 説明文とフロー図の整合性が取れている | ✅ |
| 3 | 既存正式版との用語・仕様が統一されている | ✅ |
| 4 | `docs/proposals/`に正式版として保存されている | ✅ |
| 5 | CLAUDE.mdの進捗が更新されている | ✅ |

---

## 作成した図表

### 3.1 PlantUML 図表作成フロー

| 項目 | 内容 |
|------|------|
| **概要** | PlantUMLコード入力からプレビュー表示までの基本フロー |
| **主要機能** | 入力待機処理（500ms）、node-plantuml検証、AI自動修正（最大5回） |
| **アクター** | エンドユーザー、Frontend Service、Backend Service、AI Service |

**特徴:**
- while/endwhileループでエラー修正を表現
- breakによる早期脱出
- floating noteで回復オプションを提示

### 3.2 PlantUML AI支援フロー

| 項目 | 内容 |
|------|------|
| **概要** | AIチャットによるPlantUML図表生成支援フロー |
| **主要機能** | AIプロンプト解析、コード生成、3.1と同じエラー修正ループ |
| **アクター** | エンドユーザー、Frontend Service、AI Service、Backend Service |

**特徴:**
- 3.1と同一のエラー修正ループを組み込み
- Monaco Editorでの編集統合
- 手動編集との連携

### 3.3 Excalidraw ワイヤーフレーム作成フロー

| 項目 | 内容 |
|------|------|
| **概要** | Excalidrawによるワイヤーフレーム作成フロー |
| **主要機能** | AI生成/手動作成選択、イテレーティブ修正（GUI + AIチャット） |
| **アクター** | エンドユーザー、Frontend Service、AI Service |

**特徴:**
- AI生成と手動作成の2パス
- イテレーティブ修正ループ（GUI編集 + AIチャット）
- ファイル添付機能対応

---

## AIチャット機能要件

### 対応添付ファイル形式

| 種類 | 形式 | 用途 |
|------|------|------|
| **画像** | PNG, SVG, JPG | ワイヤーフレーム、参考UI画像 |
| **テキスト** | .txt, .md | 仕様書、要件定義、メモ |
| **データ** | .json | Excalidraw JSON、設定ファイル |
| **PlantUML** | .puml | 参考図表のソースコード |

---

## 技術仕様の遵守

| 項目 | 採用仕様 | 確認 |
|------|---------|:----:|
| PlantUMLレンダリング | node-plantuml + Java 17 + Graphviz（内部） | ✅ |
| テキストエディタ | Monaco Editor | ✅ |
| 検証処理 | API Routes (`/api/validate`) + ValidationService | ✅ |
| ドローイングツール | Excalidraw GUI | ✅ |

---

## 整合性確認

### 既存正式版との整合性

| 確認項目 | 対象 | 状態 |
|---------|------|:----:|
| アクター名の統一 | コンテキスト図、ユースケース図 | ✅ |
| サービス名の統一 | シーケンス図（ログイン） | ✅ |
| 技術用語の統一 | 全正式版 | ✅ |

### 用語統一リスト

| 用語 | 統一表現 |
|------|---------|
| 入力待機 | 入力待機処理（500msデバウンス） |
| 検証エンジン | node-plantuml + Java 17 + Graphviz |
| エディタ | Monaco Editor |
| 出力形式 | SVG/PNG/PDF |

---

## CLAUDE.md更新内容

| 変更箇所 | 変更内容 |
|---------|---------|
| 図表一覧 | 業務フロー図: ✅ 完了 |
| 進捗 | 3/14 (21%) → 4/14 (29%) |
| 整合性確認対象 | 業務フロー図を追加 |
| 作成済み正式版 | `PlantUML_Studio_業務フロー図_20251201.md`を追加 |

---

## 学んだこと・改善点

### 技術的知見

1. **PlantUML whileループ内でのスイムレーン**
   - 可能だが、順序に注意が必要
   - 各アクターの動作を明示的に記述

2. **イテレーティブワークフローの表現**
   - while/endwhileとbreakの組み合わせが効果的
   - ユーザーフィードバックループの可視化

### プロセス改善

1. **ユーザー要件の確認**
   - 「コード編集」の有無など、操作パターンは早期に確認
   - 具体的な操作シナリオを聞き出す

2. **段階的な修正**
   - 大きな変更は段階的に実施
   - 各段階でユーザー確認を取る

---

## 次のステップ

1. **Phase 2完了に向けて**
   - データフロー図（DFD）の作成
   - 業務フロー・DFD対比表の作成

2. **PRD作成に向けて**
   - 残り10図表の作成（依存関係順）
   - 全図表の整合性最終確認

---

## 関連ドキュメント

| ドキュメント | パス |
|-------------|------|
| 成果物 | `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` |
| SERENA Memory | `.serena/memories/session_20251201_business_flow_diagram.md` |
| 下書き参照 | `docs/design/PlantUML_Studio_設計図表_20251130.md` |
