# UI設計図表開発憲法 品質同等化戦略

**作成日**: 2025-12-22
**目的**: UI設計図表開発憲法 v2.0 を PlantUML開発憲法 v5.4 と同等品質にアップグレードするための戦略文書

---

## 概要

PlantUML開発憲法 v5.4（約1900行）と UI設計図表開発憲法 v2.0（約560行）を比較分析し、品質ギャップを特定。3段階のアップグレード計画を策定。

---

## Gap分析結果

| # | カテゴリ | PlantUML憲法 v5.4 | UI憲法 v2.0 | Gap深刻度 |
|:-:|---------|-----------------|------------|:---------:|
| 1 | **評価順序（確証バイアス低減）** | Phase 1-B（視覚）→ 1-A（コード）| Phase 1-A（ワイヤー）→ 1-B（遷移）| Critical |
| 2 | **Context7反復照会パターン** | 3ステップパターン明記 | 言及あるが不十分 | Medium |
| 3 | **問題予防チェックリスト** | クラス図確認テーブル、業務フロー操作リスト | なし | Critical |
| 4 | **専門ガイド** | LL-001専用ガイド（alt/else状態追跡表） | なし | Medium |
| 5 | **設計パターン実装チェック** | DP-001〜DP-006実例付き | なし | Medium |
| 6 | **問題パターン発見統計** | 発生率データ（70%等） | なし | Low |
| 7 | **対比確認詳細** | Phase A/B分離、Grepパターン、具体例 | 基本的な5パスのみ | Medium |
| 8 | **失敗パターン自動登録プロセス** | 詳細な登録フロー、必須記録項目 | 言及のみ | Medium |
| 9 | **統合チェックリスト** | 5フェーズ33項目（印刷可能） | 4フェーズ19項目 | Medium |
| 10 | **変更履歴** | 40件以上の詳細履歴 | 2件 | Low |

---

## 戦略: 3段階アップグレード

### Phase 1: Critical Gap修正（v2.0 → v2.5）

| 優先度 | 追加/修正項目 | 理由 |
|:------:|-------------|------|
| 1 | **評価順序の再検討** | UI設計では「ワイヤーフレーム→遷移図」の順序が論理的に正しい（画面が確定しないと遷移が定義できない）。ただし、各フェーズ内で「視覚確認→コード確認」の順序を明記 |
| 2 | **問題予防チェックリスト追加** | UC図/業務フロー図との整合性確認テーブル、画面一覧照合チェックリスト |
| 3 | **Context7反復照会パターン追加** | PlantUML state diagramの構文確認タイミングを明記 |

### Phase 2: Medium Gap修正（v2.5 → v2.8）

| 優先度 | 追加/修正項目 | 理由 |
|:------:|-------------|------|
| 4 | **TD-015専用ガイド追加** | 低精度ワイヤーフレームのアンチパターン集、「やりすぎ」の判断基準 |
| 5 | **対比確認詳細化** | 画面一覧↔ワイヤーフレーム↔遷移図ノードの3点対比確認手順 |
| 6 | **失敗パターン自動登録プロセス詳細化** | 登録フロー図、必須記録項目テンプレート |
| 7 | **統合チェックリスト拡充** | 5フェーズ30項目以上に拡張 |

### Phase 3: 品質同等化完了（v2.8 → v3.0）

| 優先度 | 追加/修正項目 | 理由 |
|:------:|-------------|------|
| 8 | **Excalidraw/State Diagram知見ベース新設** | `UI_Design_Knowledge_Base.md`として分離 |
| 9 | **UI設計パターンチェックリスト追加** | アクセシビリティ、レスポンシブ、ナビゲーション一貫性等 |
| 10 | **問題パターン発見統計セクション追加** | 発生率データの蓄積構造 |

---

## 具体的な追加コンテンツ

### 1. §1.2.5 Context7反復照会パターン（新設）

```markdown
### 1.2.5 Context7反復照会パターン

| ステップ | タイミング | 照会内容 |
|---------|----------|---------|
| 初回 | コード作成前 | state diagram基本構文、`<<choice>>`、`<<fork>>`等 |
| 作成中 | 不明点発生時 | ノート配置、複合状態のネスト、色設定 |
| レビュー時 | 問題発生時 | 禁止構文、既知のバグ |

**照会コマンド**:
```
mcp__context7__resolve-library-id → libraryName: "plantuml"
mcp__context7__get-library-docs   → topic: "state diagram"
```
```

### 2. §1.3.5 問題予防チェックリスト（新設）

```markdown
### 1.3.5 問題予防チェックリスト

#### UC図/業務フロー図整合性確認テーブル

コード作成前に記入：

| UC/業務フロー | 対応画面 | ワイヤーフレーム | 遷移図ノード | 一致 |
|--------------|---------|----------------|-------------|:----:|
| UC 1-1 ログイン | ログイン画面 | 01_login.excalidraw | login | ✅ |
| UC 2-1 プロジェクト作成 | ダッシュボード | 03_dashboard.excalidraw | dashboard | ✅ |
| F-USR-01 認証 | パスワードリセット | ❌（未作成） | - | ❌ |

→ ❌がある場合、コード作成前に解決すること

#### 画面一覧照合チェックリスト

- [ ] UC図から抽出した全画面が一覧にある
- [ ] 業務フロー図から抽出した全画面が一覧にある
- [ ] 各画面に対応するワイヤーフレームファイルが決まっている
- [ ] 重複画面がないことを確認した（例: 「ホーム」と「ダッシュボード」の区別）
```

### 3. §3.3 TD-015専用ガイド（新設）

```markdown
### 3.3 TD-015専用ガイド: 「やりすぎ」の判断基準

| 状態 | 詳細レベル | 判定 | 対処 |
|------|----------|:----:|------|
| **適正** | 四角形＋ラベルのみ | ✅ | - |
| **適正** | 矢印＋簡易アイコン | ✅ | - |
| **過剰** | グラデーション、影 | ❌ | 削除 |
| **過剰** | 細かいパディング調整 | ❌ | ラフに |
| **過剰** | フォントサイズの細かな調整 | ❌ | 統一 |
| **過剰** | ピクセル単位の位置合わせ | ❌ | 目視で適当に |

#### Excalidrawアンチパターン

| アンチパターン | 正しい方法 |
|--------------|-----------|
| 図形の角を完璧に揃える | Roughness 1-2で「ズレ感」を許容 |
| フォントをシステムフォントに | Hand-drawn fontを使用 |
| 背景を白に固定 | なし or 薄いグレー |
| 線を直線ツールで描く | 手書きラインで描く |
```

### 4. §6.3 失敗パターン自動登録プロセス（新設）

```markdown
### 6.3 失敗パターン自動登録プロセス

UI設計作業中に新しい失敗パターンを発見した場合、**必ず本憲法に追記する**。

#### 登録プロセス

```
失敗パターン発見
    │
    ├─→ 1. Evidence (00_raw_notes.md) に詳細記録
    │
    ├─→ 2. 本憲法への追記（必須）
    │     ├─ §2 禁止事項: 「やってはいけないこと」の場合
    │     ├─ §3 技術的制限: 「ツールの仕様・バグ」の場合
    │     └─ §3.3 TD-015ガイド: 「やりすぎ」パターンの場合
    │
    └─→ 3. SERENA Memory保存
          └─ `ui_design_failure_YYYYMMDD_<概要>.md`
```

#### 必須記録項目

| 項目 | 内容 |
|------|------|
| **発生状況** | どの成果物（ワイヤーフレーム/遷移図）で発生したか |
| **症状** | どう問題が発現したか（レビュー不合格、整合性エラー等） |
| **原因** | 何が問題だったか |
| **回避策** | どうすれば回避できるか |
```

### 5. 付録D: 統合チェックリスト拡充版

```markdown
### 付録D: 統合チェックリスト（拡充版）

#### Phase 0: 画面一覧確定（6項目）

- [ ] UC図から全画面を抽出した
- [ ] 業務フロー図から全画面を抽出した
- [ ] 画面一覧テンプレートを作成した
- [ ] 重複・漏れがないことを確認した
- [ ] **【問題予防】UC/業務フロー整合性確認テーブルを記入した**
- [ ] **【問題予防】画面一覧照合チェックリストを完了した**

#### Phase 1-A: ワイヤーフレーム（8項目）

- [ ] 全画面のワイヤーフレームを作成した
- [ ] TD-015原則（低精度、手書き風、グレースケール）を遵守した
- [ ] **【TD-015ガイド】「やりすぎ」チェックを実施した**
- [ ] **【視覚確認先行】ファイルを閉じてPNGで確認した**
- [ ] PNG/SVGをエクスポートした
- [ ] 評価・採点を実施した（90点以上）
- [ ] **【Context7】疑問点があればstate diagramを照会した**
- [ ] **【整合性】UC/業務フロー対応表と一致を確認した**

#### Phase 1-B: 画面遷移図（8項目）

- [ ] **【Context7】state diagram構文を確認した**
- [ ] PlantUMLコードを作成した
- [ ] PNG生成が成功した（`-Review`）
- [ ] **【視覚確認先行】コードを閉じてPNGのみで確認した**
- [ ] 5パスレビューを完了した
- [ ] 評価・採点を実施した（90点以上）
- [ ] **【3点対比】画面一覧↔ワイヤーフレーム↔遷移図ノードを確認した**
- [ ] **【整合性】UC/業務フロー対応表と一致を確認した**

#### Phase 2: ドキュメント統合（6項目）

- [ ] SVG正式版を保存した（`-Publish`）
- [ ] 統合版Markdown（§9, §10）に追記した
- [ ] SVGリンクが正常に機能することを確認した
- [ ] 評価・採点を実施した（90点以上）
- [ ] **【既存パターン】他のproposalsドキュメントと形式統一を確認した**
- [ ] **【目次更新】目次・参照リンクが正しいことを確認した**

#### 完了処理（6項目）

- [ ] `work_sheet.md`に評価結果を記録した
- [ ] `active_context.md`を更新した
- [ ] 知見反映チェックリスト（§7.1）を確認した
- [ ] **【失敗パターン】発見した問題を本憲法に追記した**
- [ ] SERENA Memoryに保存した
- [ ] Git commitを実行した

**合計: 34項目**
```

---

## 実装計画

| 段階 | 作業内容 | 推定時間 | 成果物 |
|:----:|---------|:-------:|--------|
| Phase 1 | v2.0 → v2.5 アップグレード | 30分 | UI憲法 v2.5 |
| Phase 2 | v2.5 → v2.8 アップグレード | 45分 | UI憲法 v2.8 |
| Phase 3 | v2.8 → v3.0 アップグレード | 60分 | UI憲法 v3.0 + 知見ベース |

**合計推定時間**: 約2時間15分

---

## 品質同等化の判定基準

UI憲法 v3.0が以下を満たす場合、PlantUML憲法と同等品質と判定：

| 基準 | PlantUML v5.4 | UI v3.0目標 |
|------|:------------:|:-----------:|
| 総行数 | ~1900行 | ~1200行（UI特化で簡潔化可） |
| 評価カテゴリ数 | 6カテゴリ×3フェーズ | 同等 |
| チェックリスト項目数 | 33項目 | 30項目以上 |
| 知見ベース | LL-001〜027 | TD-015専用ガイド + 知見ベース |
| 禁止事項 | 10項目 | 10項目 |
| 技術的制限 | 詳細（コード例付き） | 同等 |
| 問題予防チェック | あり | あり |
| 失敗パターン登録プロセス | 詳細 | 同等 |

---

## 関連ドキュメント

| ドキュメント | パス |
|-------------|------|
| UI設計図表開発憲法 v2.0 | `docs/guides/ui_design/UI_Design_Constitution.md` |
| PlantUML開発憲法 v5.4 | `docs/guides/PlantUML_Development_Constitution.md` |
| TD-015意思決定記録 | `.serena/memories/wireframe_research_td015_decision_2025-11-26_29.md` |

---

## 次のアクション

1. [ ] Phase 1 実施: v2.0 → v2.5（Critical Gap修正）
2. [ ] Phase 2 実施: v2.5 → v2.8（Medium Gap修正）
3. [ ] Phase 3 実施: v2.8 → v3.0（品質同等化完了）
4. [ ] UI_Design_Knowledge_Base.md 新設
5. [ ] active_context.md 更新
6. [ ] SERENA Memory 保存
