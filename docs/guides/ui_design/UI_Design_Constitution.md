# UI設計図表開発憲法

**バージョン**: 2.8
**最終更新**: 2025-12-22

ClaudeCodeが高品質なUI設計図表（ワイヤーフレーム・画面遷移図）を作成するための行動規範。

---

## 目次

| セクション | 内容 | 参照タイミング |
|-----------|------|---------------|
| [§0 用語定義](#0-用語定義) | 本憲法で使用する用語の定義 | 初回・不明時 |
| [§1 必須プロセス](#1-必須プロセス) | **3フェーズ評価体系**、ループ改善フロー | 作業開始時 |
| ├ [§1.3.5 Context7反復照会](#135-context7反復照会パターンv25追加) | **PlantUML構文確認タイミング** | コード作成前 |
| └ [§1.3.7 問題予防チェックリスト](#137-問題予防チェックリストv25追加) | **整合性確認テーブル・3点対比** | コード作成前 |
| [§2 禁止事項](#2-禁止事項must-not) | やってはいけないこと | 作業前確認 |
| [§3 技術的制限](#3-技術的制限と回避策) | ツールの制約と回避策 | コード作成前 |
| └ [§3.4 TD-015専用ガイド](#34-td-015専用ガイド-やりすぎの判断基準v28追加) | **「やりすぎ」判断基準・アンチパターン** | 作成時 |
| [§4 レビュー手順](#4-レビュー手順) | 評価・確認プロセス、**採点基準** | レビュー時 |
| └ [§4.5 対比確認詳細](#45-対比確認詳細v28追加) | **Phase A/B分離・確証バイアス防止** | レビュー時 |
| [§5 コマンドリファレンス](#5-コマンドリファレンス) | スクリプト実行方法 | 実行時 |
| [§6 ディレクトリ構成](#6-ディレクトリ構成) | ファイル配置ルール | 作業開始時 |
| └ [§6.4 失敗パターン自動登録](#64-失敗パターン自動登録プロセスv28追加) | **知識継承プロセス** | 問題発見時 |
| [§7 知見反映プロセス](#7-知見反映プロセス) | **作業完了時の知見記録** | 作業完了時 |
| [付録](#付録) | テンプレート、**統合チェックリスト（42項目）** | 必要時 |

---

## 0. 用語定義

### 成果物用語

| 用語 | 定義 |
|------|------|
| **ワイヤーフレーム** | 各画面のレイアウト・UI要素を示す低精度図表（Excalidraw） |
| **画面遷移図** | 画面間のナビゲーション・遷移を示す図表（PlantUML state） |
| **2成果物方式** | ワイヤーフレームと画面遷移図を別々に作成する方式 |

### TD-015原則（必読）

| 原則 | 説明 |
|:----:|------|
| **低精度** | Low-Fidelity（低忠実度）が正解。ピクセルパーフェクトは不要 |
| **手書き風** | 要件変更の柔軟性を示す。シャープなデザインは設計フェーズ以降 |
| **グレースケール** | 色の議論を避ける。色は設計フェーズで決定 |

> **参照**: `.serena/memories/wireframe_research_td015_decision_2025-11-26_29.md`

### ファイル用語

| 用語 | 定義 | 例 |
|------|------|-----|
| **Excalidrawファイル** | `.excalidraw`拡張子のJSON形式ファイル | `login.excalidraw` |
| **PlantUMLソース** | `.puml`拡張子のテキストファイル | `screen_transition.puml` |
| **正式版** | レビュー済みの`docs/proposals/`内ファイル | SVG, PNG, Markdown |

---

## 1. 必須プロセス

> **⚠️ AIへの指示**: UI設計作業開始前に、必ずこのセクションの全体フローを把握してから作業を開始せよ。

### 1.1 全体フロー（3フェーズ評価体系）

> **⚠️ v2.5改訂**: 評価・採点を3フェーズに分離。各フェーズで**90点以上**が合格ライン。
>
> **視覚確認先行原則**: 各フェーズ内で評価を行う際、**まず視覚確認（PNG）を実施し、その後でソース/ファイルを確認する**。これにより確証バイアス（ソースを見た後の先入観）を排除する。

```
┌─────────────────────────────────────────────────────────────────┐
│  Phase 0: 画面一覧の確定                                         │
│           └─ UC図・業務フロー図から画面を抽出                   │
│                    ↓                                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ ① Phase 1-A: ワイヤーフレーム作成・評価（§1.4参照）      │    │
│  │    1. TD-015原則に従って作成（低精度、手書き風、グレー） │    │
│  │    2. 各画面を個別ファイルで作成                         │    │
│  │    3. 評価・採点（TD-015準拠、網羅性）                   │    │
│  │    - 90点未満 → 修正 → 再評価                           │    │
│  └─────────────────────────────────────────────────────────┘    │
│           ↓ 90点以上                                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ ② Phase 1-B: 画面遷移図作成・評価（§1.5参照）           │    │
│  │    1. Context7で構文確認                                 │    │
│  │    2. PlantUMLコード作成                                 │    │
│  │    3. PNG生成・5パスレビュー                             │    │
│  │    4. 評価・採点（遷移ロジック、整合性）                 │    │
│  │    - 90点未満 → コード修正 → 再評価                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│           ↓ 90点以上                                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ ③ Phase 2: ドキュメント統合・Publish（§1.6参照）        │    │
│  │    1. SVG生成・正式版保存（-Publish）                    │    │
│  │    2. 統合版Markdownに追記                               │    │
│  │    3. ドキュメント品質を評価・採点                       │    │
│  │    - 90点未満 → ドキュメント修正 → 再評価               │    │
│  └─────────────────────────────────────────────────────────┘    │
│           ↓ 90点以上                                            │
│  完了 → active_context.md更新 → 知見反映（§7）→ SERENA Memory   │
└─────────────────────────────────────────────────────────────────┘
```

#### 3フェーズ評価体系サマリ

| フェーズ | 評価対象 | 評価観点 | 合格ライン | 参照 |
|:-------:|---------|---------|:----------:|:----:|
| **① Phase 1-A** | ワイヤーフレーム | TD-015準拠、網羅性、UI要素 | **90点** | §1.4 |
| **② Phase 1-B** | 画面遷移図 | 遷移ロジック、整合性、構文 | **90点** | §1.5 |
| **③ Phase 2** | 統合版Markdown | ドキュメント品質、参照整合性 | **90点** | §1.6 |

### 1.2 成果物サマリ

| 成果物 | ツール | 形式 | 目的 |
|--------|--------|------|------|
| **ワイヤーフレーム** | Excalidraw | .excalidraw + PNG/SVG | 各画面のレイアウト定義 |
| **画面遷移図** | PlantUML | .puml + SVG | 画面間の遷移ロジック定義 |

### 1.3 PRDでの配置

```markdown
# PRD構成

§9 画面遷移図
  └─ PlantUML state diagram（全体の流れを俯瞰）

§10 ワイヤーフレーム
  └─ Excalidraw（各画面の詳細）
  └─ 画面遷移図の各ノードに対応
```

### 1.3.5 Context7反復照会パターン（v2.5追加）

> **背景**: PlantUML開発憲法の「Context7反復照会パターン」をUI設計にも適用。

画面遷移図（PlantUML state diagram）作成時、以下のタイミングでContext7を照会する：

| ステップ | タイミング | 照会内容 |
|---------|----------|---------|
| **初回** | コード作成前 | state diagram基本構文、`<<choice>>`、`<<fork>>`等 |
| **作成中** | 不明点発生時 | ノート配置、複合状態のネスト、色設定 |
| **レビュー時** | 問題発生時 | 禁止構文、既知のバグ |

**照会コマンド**:

```
# PlantUML state diagram構文確認
mcp__context7__resolve-library-id → libraryName: "plantuml"
mcp__context7__get-library-docs   → topic: "state diagram"
```

> **注意**: Excalidrawは自由形式のため、Context7での構文確認は不要。代わりにTD-015原則（§0）と付録Cのスタイル設定を参照すること。

### 1.3.7 問題予防チェックリスト（v2.5追加）

> **背景**: PlantUML開発憲法の「問題予防チェックリスト」をUI設計にも適用。コード作成前に整合性を確認し、手戻りを防止する。

#### UC図/業務フロー図整合性確認テーブル

**コード作成前に記入すること**：

```markdown
## 事前確認: 整合性テーブル

| UC/業務フロー | 対応画面 | ワイヤーフレーム | 遷移図ノード | 一致 |
|--------------|---------|----------------|-------------|:----:|
| UC 1-1 ログイン | ログイン画面 | 01_login.excalidraw | login | ✅ |
| UC 2-1 プロジェクト作成 | ダッシュボード | 03_dashboard.excalidraw | dashboard | ✅ |
| F-USR-01 認証 | パスワードリセット | ❌（未作成） | - | ❌ |
```

→ **❌がある場合、コード作成前に解決すること**

#### 画面一覧照合チェックリスト

コード作成前に以下を全て確認：

- [ ] UC図から抽出した全画面が一覧にある
- [ ] 業務フロー図から抽出した全画面が一覧にある
- [ ] 各画面に対応するワイヤーフレームファイル名が決まっている
- [ ] 重複画面がないことを確認した（例: 「ホーム」と「ダッシュボード」の区別）
- [ ] モーダル・ダイアログも画面として抽出した

#### 3点対比確認（Phase 1-B完了時）

画面遷移図のレビュー時、以下の3点が一致することを確認：

```
画面一覧 ←→ ワイヤーフレーム ←→ 遷移図ノード
   │              │                │
   │    1:1対応    │    1:1対応     │
   └──────────────┴────────────────┘
```

| 確認項目 | 確認方法 |
|---------|---------|
| 画面一覧の全画面にワイヤーフレームがあるか | ファイル存在確認 |
| ワイヤーフレームの全画面が遷移図にノードとして存在するか | PNG視覚確認 |
| 遷移図のノードに対応するワイヤーフレームがあるか | 逆方向確認 |

### 1.4 Phase 1-A: ワイヤーフレーム評価詳細

#### 評価基準（90点以上で合格）

| カテゴリ | 配点 | 評価内容 |
|---------|:----:|---------|
| TD-015準拠 | 30 | 低精度、手書き風、グレースケール |
| 網羅性 | 25 | 画面一覧の全画面が作成されているか |
| UI要素 | 20 | 主要なUI要素（ボタン、入力欄、ナビ）が含まれているか |
| UC整合性 | 15 | UC図・業務フロー図と矛盾がないか |
| 可読性 | 10 | レイアウトの明確さ、ラベルの読みやすさ |
| **合計** | **100** | **90点以上で合格** |

#### 減点チェックリスト

| 違反 | 減点 |
|------|:----:|
| ピクセルパーフェクトなデザイン | -15 |
| カラフルな配色 | -10 |
| 画面一覧にない画面を作成 | -10/件 |
| UC図にないUI要素を追加 | -5/件 |
| ラベルが読めない | -5/件 |

### 1.5 Phase 1-B: 画面遷移図評価詳細

#### 評価基準（90点以上で合格）

| カテゴリ | 配点 | 評価内容 |
|---------|:----:|---------|
| 構文・構造 | 20 | PlantUML構文エラーなし、PNG生成成功 |
| ノード網羅性 | 20 | ワイヤーフレーム全画面がノードとして存在 |
| 遷移ロジック | 25 | 遷移にトリガー（ラベル）があるか、孤立ノードなし |
| 整合性 | 20 | UC図・業務フロー図との矛盾がないか |
| 可読性・スタイル | 15 | レイアウト、色分け、命名規則の統一 |
| **合計** | **100** | **90点以上で合格** |

#### 減点チェックリスト

| 違反 | 減点 |
|------|:----:|
| PNG生成失敗 | -20 |
| 孤立ノード（入出力なし） | -10/件 |
| 遷移トリガー省略 | -5/件 |
| ワイヤーフレームにない画面をノード化 | -10/件 |
| 開始点`[*]`がない | -10 |
| 終了点`[*]`がない | -5 |

### 1.6 Phase 2: ドキュメント統合評価詳細

#### 評価基準（90点以上で合格）

| カテゴリ | 配点 | 評価内容 |
|---------|:----:|---------|
| セクション構成 | 20 | §9, §10に正しく配置されているか |
| SVG参照 | 20 | SVGファイルへのリンクが正常に機能するか |
| 画面一覧表 | 20 | 全画面のリストが正確か |
| 遷移一覧表 | 15 | 全遷移のリストが正確か |
| 既存パターン一貫性 | 15 | 他の正式版ドキュメントと形式が統一されているか |
| 可読性 | 10 | 見出し、表、説明文の明確さ |
| **合計** | **100** | **90点以上で合格** |

---

## 2. 禁止事項（MUST NOT）

以下の行為は**絶対に禁止**する。

### ワイヤーフレーム作成時

| # | 禁止事項 | 理由 |
|:-:|---------|------|
| 1 | **ピクセルパーフェクトを目指す** | TD-015違反。要件定義フェーズでは低精度が正解 |
| 2 | **カラフルなデザインにする** | TD-015違反。グレースケールで色の議論を避ける |
| 3 | **細かいUI調整に時間をかける** | 設計フェーズの作業。要件定義では大まかな構成が重要 |
| 4 | **画面一覧を確定せずに作成開始する** | 抜け漏れ・手戻りが発生する |

### 画面遷移図作成時

| # | 禁止事項 | 理由 |
|:-:|---------|------|
| 5 | **Context7確認なしでPlantUMLコードを書く** | 構文エラーの見落とし |
| 6 | **存在しない画面をノードにする** | ワイヤーフレームと不整合 |
| 7 | **遷移トリガーを省略する** | ユーザー操作が不明確になる |
| 8 | **SVGのXMLテキストで視覚確認したと判断する** | 画像として認識されない |

### 共通

| # | 禁止事項 | 理由 |
|:-:|---------|------|
| 9 | **UC図・業務フロー図との整合性を確認しない** | 機能漏れ・矛盾が発生する |
| 10 | **レビューなしでPublishする** | 品質保証の証跡がない |

---

## 3. 技術的制限と回避策

### 3.1 Excalidrawの制限

| # | 制限 | 回避策 |
|:-:|------|--------|
| 1 | Context7で「描き方」を取得できない | TD-015原則 + 本憲法に従う |
| 2 | 構文検証ができない（GUIツール） | 視覚的レビューで確認 |

> **注意**: Excalidrawは自由度が高いため、TD-015原則を意識的に守る必要がある。

### 3.2 PlantUML state diagramの制限

Context7確認結果: **重大な構文制限なし**（シーケンス図より単純）

| # | 機能 | 構文 | 備考 |
|:-:|------|------|------|
| 1 | 開始点 | `[*] --> State` | 必須 |
| 2 | 終了点 | `State --> [*]` | 必須 |
| 3 | 遷移 | `State1 --> State2 : ラベル` | ラベル推奨 |
| 4 | 複合状態 | `state Name { ... }` | ネスト可能 |
| 5 | 分岐 | `<<choice>>` | 条件分岐 |
| 6 | 並行 | `<<fork>>`, `<<join>>` | 並行処理 |
| 7 | ノート | `note right of State : 内容` | 補足説明 |
| 8 | 手書き風 | `!option handwritten true` | TD-015対応 |

### 3.3 既知の制限（発見次第追記）

| # | 発見日 | 制限内容 | 回避策 |
|:-:|--------|---------|--------|
| - | - | （現時点で未発見） | - |

### 3.4 TD-015専用ガイド: 「やりすぎ」の判断基準（v2.8追加）

> **背景**: TD-015原則（低精度、手書き風、グレースケール）の具体的な適用基準を明確化。「やりすぎ」を防止する。

#### 詳細レベル判定表

| 状態 | 詳細レベル | 判定 | 対処 |
|------|----------|:----:|------|
| **適正** | 四角形＋ラベルのみ | ✅ | - |
| **適正** | 矢印＋簡易アイコン（🔍、📁等） | ✅ | - |
| **適正** | プレースホルダーテキスト（Lorem ipsum） | ✅ | - |
| **過剰** | グラデーション、ドロップシャドウ | ❌ | 削除 |
| **過剰** | 細かいパディング・マージン調整 | ❌ | ラフに |
| **過剰** | フォントサイズの細かな調整 | ❌ | 統一（16px等） |
| **過剰** | ピクセル単位の位置合わせ | ❌ | 目視で適当に |
| **過剰** | 実際の画像・写真の挿入 | ❌ | プレースホルダーに |
| **過剰** | 複雑なアイコンの作成 | ❌ | 簡易記号で代用 |

#### Excalidrawアンチパターン

| # | アンチパターン | 正しい方法 | 理由 |
|:-:|--------------|-----------|------|
| 1 | 図形の角を完璧に揃える | Roughness 1-2で「ズレ感」を許容 | 手書き風を維持 |
| 2 | フォントをシステムフォントに | Hand-drawn fontを使用 | 手書き風を維持 |
| 3 | 背景を白に固定 | なし or 薄いグレー（#F5F5F5等） | グレースケール |
| 4 | 線を直線ツールで完璧に描く | フリーハンドラインを使用 | 低精度を表現 |
| 5 | ボタンに実際の色を付ける | グレー（#E0E0E0等）で統一 | 色の議論を避ける |
| 6 | 完璧なグリッドレイアウト | おおよそのグリッドで十分 | 柔軟性を示す |

#### 「やりすぎ」自己診断チェックリスト

ワイヤーフレーム作成後、以下を確認：

- [ ] 作成に30分以上かけた画面がないか（1画面15分目安）
- [ ] 「このボタンの角丸を調整しよう」と思っていないか
- [ ] 色を3色以上使っていないか（黒、白、グレーのみ）
- [ ] 「もう少し見栄えを良くしたい」と思っていないか
- [ ] 実装時に変更されそうな詳細を描いていないか

→ **1つでも該当したら、作業を止めて簡素化する**

---

## 4. レビュー手順

> **重要**: 評価基準は §1.4〜§1.6 を参照。各フェーズ **90点以上で合格**。

### 4.1 ワイヤーフレームの5パスレビュー

| Pass | チェック項目 | 確認方法 |
|:----:|-------------|---------|
| 1 | **TD-015準拠** | 視覚確認（低精度、手書き風、グレー） |
| 2 | **網羅性** | 画面一覧チェックリスト照合 |
| 3 | **UI要素** | UC図・業務フロー図と照合（必要な要素があるか） |
| 4 | **過剰詳細** | ピクセルパーフェクトでないことを確認 |
| 5 | **整合性** | 他画面との一貫性（スタイル、命名） |

### 4.2 画面遷移図の5パスレビュー

| Pass | チェック項目 | 確認方法 |
|:----:|-------------|---------|
| 1 | **構文** | PNG生成成功（`-Review`オプション） |
| 2 | **ノード網羅性** | ワイヤーフレーム全画面がノードとして存在 |
| 3 | **遷移ロジック** | 全遷移にトリガー（ラベル）があるか |
| 4 | **孤立ノード** | 全ノードに入出力があることを確認 |
| 5 | **UC整合性** | UC図・業務フロー図との矛盾がないか |

### 4.3 ループ改善フロー

```
評価・採点
    │
    ├─ 90点以上 → 次フェーズへ進む
    │
    └─ 90点未満 → 修正 → 再評価
                    ↓
              ┌─────────────────────────────┐
              │ 改善ループ                   │
              │ 1. 減点箇所を特定            │
              │ 2. 原因を分析                │
              │ 3. 修正を実施                │
              │ 4. 再評価（全項目）          │
              │ 5. 90点以上になるまで繰り返す│
              └─────────────────────────────┘
```

### 4.4 レビュー結果の記録

| 項目 | 記録内容 | 記録先 |
|------|---------|--------|
| 評価スコア | 各カテゴリの点数、合計点 | `work_sheet.md` |
| 減点理由 | 具体的な問題点 | `work_sheet.md` |
| 修正履歴 | 改善ループの回数、各回の修正内容 | `00_raw_notes.md` |
| レビューログ | 画面遷移図のレビュー結果 | `.review.json` |

### 4.5 対比確認詳細（v2.8追加）

> **背景**: PlantUML開発憲法の「対比確認」をUI設計にも適用。確証バイアスを排除するため、Phase A（視覚確認）→ Phase B（ソース対比）の順序で実施。

#### なぜ対比確認が必要か

| 確認方法 | 検出できること | 検出できないこと |
|---------|--------------|----------------|
| ソースのみ | ファイル存在、コード構文 | 視覚的な問題（レイアウト崩れ、孤立ノード） |
| PNGのみ | 見た目の問題 | どのファイル/行が原因か |
| **対比確認** | 両方 | - |

#### 2フェーズ対比確認手順

```
Phase A: 視覚確認（ソースを見る前に実施）
    │
    │  1. ワイヤーフレームPNG/遷移図PNGのみを開く
    │  2. 視覚的に問題を発見・記録
    │  3. 問題箇所をスクリーンショット or メモ
    │
    ↓
Phase B: ソース対比（視覚確認完了後）
    │
    │  4. ソースファイルを開く
    │  5. Phase Aで発見した問題の原因を特定
    │  6. 修正を実施
    │
    ↓
再評価（修正後、Phase Aから再実施）
```

> **⚠️ 重要**: Phase AとPhase Bを同時に実施しない（確証バイアス防止）。

#### 対比確認記録テンプレート

```markdown
## 対比確認記録

### Phase A: 視覚確認結果

| # | 発見箇所 | 問題内容 | 深刻度 |
|:-:|---------|---------|:------:|
| 1 | ログイン画面 | ボタンが切れている | 高 |
| 2 | 遷移図 | dashboard→editor の矢印がない | 高 |
| 3 | 新規登録画面 | ラベルが読みにくい | 中 |

### Phase B: ソース対比結果

| # | 原因ファイル | 原因行/箇所 | 修正内容 |
|:-:|-------------|-------------|---------|
| 1 | 01_login.excalidraw | ボタン要素 | サイズ拡大 |
| 2 | screen_transition.puml | 55行目 | 遷移追加 |
| 3 | 02_signup.excalidraw | テキスト要素 | フォントサイズ変更 |
```

#### ワイヤーフレーム対比確認のポイント

| 確認項目 | 視覚確認（Phase A） | ソース対比（Phase B） |
|---------|-------------------|---------------------|
| 画面一覧との一致 | 全画面のPNGが存在するか | ファイル名が正しいか |
| UI要素の存在 | 必要なボタン・入力欄があるか | 要素が正しく配置されているか |
| TD-015準拠 | 手書き風・グレースケールか | Roughness/色設定が正しいか |

#### 遷移図対比確認のポイント

| 確認項目 | 視覚確認（Phase A） | ソース対比（Phase B） |
|---------|-------------------|---------------------|
| ノード存在 | 全画面がノードとして表示されているか | state定義が正しいか |
| 遷移の接続 | 全遷移が矢印で繋がっているか | 遷移定義が正しいか |
| 孤立ノード | 入出力のないノードがないか | 該当ノードの遷移定義を確認 |
| ラベル | 遷移トリガーが読めるか | ラベル文字列を確認 |

---

## 5. コマンドリファレンス

### 5.1 PlantUML画面遷移図

```powershell
# レビュー用PNG生成
powershell.exe scripts/validate_plantuml.ps1 -InputPath ".\screen_transition.puml" -Review

# 正式版SVG保存
powershell.exe scripts/validate_plantuml.ps1 -InputPath ".\screen_transition.puml" -Publish -DiagramType "state"
```

### 5.2 Excalidrawワイヤーフレーム

Obsidian Excalidraw Pluginを使用：
1. Obsidianで`.excalidraw`ファイルを開く
2. 編集完了後、右クリック → Export → PNG/SVG

または、Excalidraw公式サイト（https://excalidraw.com/）でエクスポート。

### 5.3 Context7参照

```
# PlantUML state diagram構文確認
mcp__context7__resolve-library-id → libraryName: "plantuml"
mcp__context7__get-library-docs   → topic: "state diagram"
```

---

## 6. ディレクトリ構成

### 6.1 作業ディレクトリ

```
docs/evidence/yyyyMMdd_HHmm_ui_design/
├── instructions.md              # 作業指示
├── 00_raw_notes.md              # 作業メモ
├── work_sheet.md                # 作業結果
├── wireframes/                  # ワイヤーフレーム
│   ├── 01_login.excalidraw
│   ├── 02_dashboard.excalidraw
│   └── ...
├── screen_transition.puml       # 画面遷移図ソース
└── screen_transition.review.json # レビューログ
```

### 6.2 正式版保存先

```
docs/proposals/
├── diagrams/
│   ├── 09_screen_transition/
│   │   └── PlantUML_Studio_ScreenTransition.svg
│   └── 10_wireframe/
│       ├── 01_login.svg
│       ├── 02_dashboard.svg
│       └── ...
├── 09_画面遷移図_yyyyMMdd.md    # 統合版Markdown
└── 10_ワイヤーフレーム_yyyyMMdd.md
```

### 6.3 命名規則

| 項目 | 規則 | 例 |
|------|------|-----|
| ワイヤーフレーム | `NN_画面名.excalidraw` | `01_login.excalidraw` |
| 画面遷移図 | `screen_transition.puml` | - |
| 正式版SVG | `PlantUML_Studio_ScreenTransition.svg` | - |

### 6.4 失敗パターン自動登録プロセス（v2.8追加）

> **背景**: PlantUML開発憲法の「失敗パターン自動登録」をUI設計にも適用。発見した問題を憲法に追記し、再発を防止する。

#### 登録プロセスフロー

```
失敗パターン発見
    │
    ├─→ 1. Evidence (00_raw_notes.md) に詳細記録
    │
    ├─→ 2. 本憲法への追記（必須）
    │     ├─ §2 禁止事項: 「やってはいけないこと」の場合
    │     ├─ §3.3 既知の制限: 「ツールの仕様・バグ」の場合
    │     ├─ §3.4 TD-015ガイド: 「やりすぎ」パターンの場合
    │     └─ §1.4/§1.5 減点チェックリスト: 評価基準の追加
    │
    ├─→ 3. SERENA Memory保存
    │     └─ `ui_design_failure_YYYYMMDD_<概要>.md`
    │
    └─→ 4. 作業完了前に必ず実施（知見反映チェックリスト §7.1）
```

#### 必須記録項目

| 項目 | 内容 | 例 |
|------|------|-----|
| **発生状況** | どの成果物で発生したか | ワイヤーフレーム / 画面遷移図 |
| **症状** | どう問題が発現したか | PNG生成失敗、レビュー不合格 |
| **原因** | 何が問題だったか | TD-015違反、孤立ノード |
| **回避策** | どうすれば回避できるか | グレースケールに統一、遷移を追加 |
| **発見日** | いつ発見したか | 2025-12-22 |

#### 登録テンプレート

```markdown
## 失敗パターン登録

### 基本情報

| 項目 | 内容 |
|------|------|
| 発見日 | 2025-12-22 |
| 発生成果物 | ワイヤーフレーム |
| 対象画面 | ログイン画面 |

### 詳細

| 項目 | 内容 |
|------|------|
| 症状 | レビューで-15点減点 |
| 原因 | ボタンにグラデーションを使用（TD-015違反） |
| 回避策 | グレー単色（#E0E0E0）を使用 |

### 憲法更新

- [x] §3.4 TD-015ガイドに追記済み
- [ ] §1.4 減点チェックリストに追記済み
- [x] SERENA Memoryに保存済み
```

#### 登録タイミング

| タイミング | 登録内容 |
|-----------|---------|
| レビュー中に発見 | 減点理由を憲法に追記 |
| 改善ループ中に発見 | 回避策を憲法に追記 |
| PNG生成失敗時 | 技術的制限を憲法に追記 |
| 作業完了時 | 知見反映チェックリストで確認 |

> **重要**: 失敗パターンを発見したら、**作業完了前に必ず本憲法を更新すること**。次回以降の作業者（自分含む）が同じ失敗を繰り返さないための知識継承。

---

## 7. 知見反映プロセス

> **重要**: 作業完了時に必ず実施すること。獲得した知見を永続化し、次回以降の品質向上に活用する。

### 7.1 知見反映チェックリスト

作業完了時、以下を確認して該当するものを実施：

| 条件 | アクション | 更新先 |
|------|-----------|--------|
| PlantUML構文で問題を発見した | 制限事項を追記 | 本憲法 §3.3 |
| TD-015違反パターンを発見した | 減点チェックリストに追加 | 本憲法 §1.4 |
| 新しいワイヤーフレームパターンを発見した | パターンを記録 | 付録D（将来追加） |
| 遷移図で新しいエラーパターンを発見した | 減点チェックリストに追加 | 本憲法 §1.5 |
| 改善ループを複数回実施した | 原因と対策を記録 | `work_sheet.md` |

### 7.2 知見記録テンプレート

`work_sheet.md`の「知見反映記録」セクションに記録：

```markdown
## 知見反映記録

| 更新ドキュメント | 追加項目 | 内容 |
|-----------------|---------|------|
| UI_Design_Constitution.md §3.3 | PlantUML制限 | 〇〇の構文は△△で回避 |
| 本憲法 §1.4 | 減点項目 | 〇〇は-10点 |
| - | - | なし（新規知見なし） |
```

### 7.3 SERENA Memory保存

作業完了時、セッション知識をSERENA Memoryに保存：

```
mcp__serena__write_memory
  memory_file_name: "session_yyyyMMdd_ui_design_<画面名>_complete.md"
  content: (セッションサマリ)
```

---

## 付録

### 付録A: 画面一覧テンプレート

作成前に画面一覧を確定すること。

```markdown
## 画面一覧（UC図・業務フロー図から抽出）

| # | 画面名 | カテゴリ | 対応UC | ワイヤーフレーム | 状況 |
|:-:|--------|:-------:|--------|:----------------:|:----:|
| 1 | ログイン画面 | 認証 | 1-1 | 01_login.excalidraw | 🔴 |
| 2 | 新規登録画面 | 認証 | 1-1 | 02_signup.excalidraw | 🔴 |
| 3 | ダッシュボード | メイン | 2-1 | 03_dashboard.excalidraw | 🔴 |
| 4 | エディタ画面 | メイン | 3-1〜3-6 | 04_editor.excalidraw | 🔴 |
| 5 | プロジェクト一覧 | メイン | 2-2〜2-4 | 05_projects.excalidraw | 🔴 |
| ... | ... | ... | ... | ... | ... |
```

### 付録B: PlantUML画面遷移図テンプレート

```plantuml
@startuml PlantUML_Studio_ScreenTransition

!option handwritten true

title 画面遷移図

skinparam state {
  BackgroundColor<<auth>> #FFFDE7
  BackgroundColor<<main>> #E3F2FD
  BackgroundColor<<modal>> #E8F5E9
  BorderColor #666666
}

' === 開始点 ===
[*] --> login

' === 認証画面 ===
state "ログイン画面" as login <<auth>>
state "新規登録画面" as signup <<auth>>
state "パスワードリセット" as reset <<auth>>

' === メイン画面 ===
state "ダッシュボード" as dashboard <<main>>
state "エディタ画面" as editor <<main>>
state "プロジェクト一覧" as projects <<main>>

' === モーダル ===
state "新規作成モーダル" as newModal <<modal>>

' === 認証フロー ===
login --> signup : 新規登録
login --> reset : パスワード忘れ
signup --> login : 登録完了
reset --> login : リセット完了
login --> dashboard : ログイン成功

' === メイン画面遷移 ===
dashboard --> projects : プロジェクト管理
dashboard --> editor : 図表を開く
dashboard --> newModal : 新規作成

projects --> editor : 図表を開く
projects --> dashboard : 戻る

editor --> dashboard : 閉じる

newModal --> editor : 作成開始
newModal --> dashboard : キャンセル

' === ログアウト ===
dashboard --> login : ログアウト
editor --> login : ログアウト

@enduml
```

### 付録C: Excalidrawスタイル設定

TD-015原則に従うための設定：

| 設定項目 | 推奨値 | 理由 |
|---------|--------|------|
| **Stroke style** | Hand-drawn | 手書き風 |
| **Roughness** | 1-2 | 低精度を表現 |
| **Background** | なし or 薄いグレー | グレースケール |
| **Stroke color** | 黒 or 濃いグレー | グレースケール |
| **Fill color** | 薄いグレー（#E0E0E0等） | グレースケール |
| **Font** | Hand-drawn | 手書き風 |

### 付録D: 統合チェックリスト（v2.8拡充版）

> **使用方法**: 各Phaseを順番に実行し、すべてのチェックが完了してから次のPhaseに進む。印刷して横に置いて使用可能。

作業完了前に全項目を確認：

#### Phase 0: 画面一覧確定（6項目）

- [ ] UC図から全画面を抽出した
- [ ] 業務フロー図から全画面を抽出した
- [ ] 画面一覧テンプレートを作成した
- [ ] 重複・漏れがないことを確認した
- [ ] **【問題予防】UC/業務フロー整合性確認テーブルを記入した**（§1.3.7）
- [ ] **【問題予防】画面一覧照合チェックリストを完了した**（§1.3.7）

#### Phase 1-A: ワイヤーフレーム（10項目）

- [ ] 全画面のワイヤーフレームを作成した
- [ ] TD-015原則（低精度、手書き風、グレースケール）を遵守した
- [ ] **【TD-015ガイド】「やりすぎ」自己診断を実施した**（§3.4）
- [ ] **【TD-015ガイド】アンチパターンに該当しないことを確認した**（§3.4）
- [ ] **【視覚確認先行】ファイルを閉じてPNGで確認した**
- [ ] PNG/SVGをエクスポートした
- [ ] 評価・採点を実施した（90点以上）
- [ ] **【整合性】UC/業務フロー対応表と一致を確認した**
- [ ] 90点未満の場合、改善ループを実施した
- [ ] 最終スコアを`work_sheet.md`に記録した

#### Phase 1-B: 画面遷移図（12項目）

- [ ] **【Context7】state diagram構文を確認した**（§1.3.5）
- [ ] PlantUMLコードを作成した
- [ ] PNG生成が成功した（`-Review`）
- [ ] **【視覚確認先行】コードを閉じてPNGのみで確認した**
- [ ] 5パスレビューを完了した
- [ ] **【対比確認Phase A】視覚確認結果をテーブルに記録した**（§4.5）
- [ ] **【対比確認Phase B】ソースと対比し原因を特定した**（§4.5）
- [ ] **【3点対比】画面一覧↔ワイヤーフレーム↔遷移図ノードを確認した**（§1.3.7）
- [ ] **【整合性】UC/業務フロー対応表と一致を確認した**
- [ ] 評価・採点を実施した（90点以上）
- [ ] 90点未満の場合、改善ループを実施した
- [ ] 最終スコアを`work_sheet.md`に記録した

#### Phase 2: ドキュメント統合（6項目）

- [ ] SVG正式版を保存した（`-Publish`）
- [ ] 統合版Markdown（§9, §10）に追記した
- [ ] SVGリンクが正常に機能することを確認した
- [ ] **【既存パターン】他のproposalsドキュメントと形式統一を確認した**
- [ ] 評価・採点を実施した（90点以上）
- [ ] 90点未満の場合、改善ループを実施した

#### 完了処理（8項目）

- [ ] `work_sheet.md`に評価結果を記録した
- [ ] `active_context.md`を更新した
- [ ] 知見反映チェックリスト（§7.1）を確認した
- [ ] **【失敗パターン】発見した問題を本憲法に追記した**（§6.4）
- [ ] **【失敗パターン】登録テンプレートを作成した**（該当時のみ）（§6.4）
- [ ] SERENA Memoryに保存した
- [ ] Git commitを実行した
- [ ] **【品質確認】全フェーズで90点以上を達成したことを確認した**

**合計: 42項目**（v2.0: 19項目 → v2.5: 36項目 → v2.8: 42項目、+6項目）

---

## 更新履歴

| 日付 | Ver | 内容 |
|------|:---:|------|
| 2025-12-22 | 2.8 | **Phase 2 品質同等化**: ① §3.4 TD-015専用ガイド追加（詳細レベル判定表、Excalidrawアンチパターン、「やりすぎ」自己診断）、② §4.5 対比確認詳細追加（Phase A/B分離、確証バイアス防止、記録テンプレート）、③ §6.4 失敗パターン自動登録プロセス追加（登録フロー、必須記録項目、テンプレート）、④ 付録D統合チェックリスト拡充（36→42項目）、⑤ 目次にv2.8新規セクションを追加 |
| 2025-12-22 | 2.5 | **Phase 1 品質同等化**: ① §1.3.5 Context7反復照会パターン追加、② §1.3.7 問題予防チェックリスト追加（UC/業務フロー整合性テーブル、画面一覧照合、3点対比確認）、③ 付録D統合チェックリスト拡充（19→36項目）、④ 視覚確認先行原則を各フェーズに追加 |
| 2025-12-22 | 2.0 | 3フェーズ評価体系、ループ改善フロー、知見反映プロセス追加 |
| 2025-12-22 | 1.0 | 初版作成（2成果物方式、TD-015原則統合） |
