# UI設計図表 知見ベース

**バージョン**: 1.14
**最終更新**: 2025-12-28
**関連憲法**: UI設計図表開発憲法 v3.8

---

## 概要

本ドキュメントはUI設計図表（ワイヤーフレーム・画面遷移図）作成時に獲得した知見を蓄積・共有するためのナレッジベースである。

PlantUML開発憲法の `Activation_Bar_Knowledge_Base.md` に相当する位置づけ。

---

## 目次

| セクション | 内容 |
|-----------|------|
| [Excalidraw知見](#excalidraw知見) | ワイヤーフレーム作成時の知見（EX-001〜） |
| [Logical Validation知見](#logical-validation知見論理的妥当性検証) | **メタ原則**: 論理的妥当性検証（LV-001〜）|
| [State Diagram知見](#state-diagram知見) | 画面遷移図作成時の知見（SD-001〜） |
| [TD-015適用知見](#td-015適用知見) | TD-015原則の具体的適用事例（TD-001〜） |
| [整合性チェック知見](#整合性チェック知見) | 3点対比確認等の知見（IC-001〜） |

---

## Excalidraw知見

### EX-001: Roughnessと手書き感のバランス

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | ワイヤーフレーム作成時、Roughness設定で迷った |
| **知見** | Roughness 0は「きれいすぎ」、Roughness 3は「乱れすぎ」。Roughness 1-2が最適 |
| **推奨設定** | Roughness: 1（シンプルな図形）、Roughness: 2（複雑な図形） |

### EX-002: フォント選択の影響

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | ラベルテキストの可読性とTD-015準拠のバランス |
| **知見** | システムフォントは「完成品感」が出てしまう。Hand-drawn fontを使用すべき |
| **注意点** | Hand-drawn fontは小さいサイズで可読性が下がる。最小16pxを推奨 |

### EX-003: 背景色とコントラスト

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | グレースケール環境での視認性確保 |
| **知見** | 背景なし or #F5F5F5程度の薄いグレーが最適。#FFFFFF（純白）は避ける |
| **理由** | 純白背景は「完成品感」が出る。薄いグレーは「下書き感」を維持 |

### EX-004: PNG/SVGエクスポート時の注意点

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | エクスポート後のファイルサイズ・品質 |
| **知見** | SVGはベクター形式で拡大縮小に強い。PNGはレビュー用に適切 |
| **推奨** | レビュー時: PNG（2x解像度）、正式版: SVG |

### EX-005: Embedded Index Pattern（埋め込みインデックスパターン）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | 複数ワイヤーフレームのレビュー時に各ファイルを個別に開く必要があり、リンククリック後に戻るボタンで位置がリセットされる問題が発生 |
| **知見** | 閲覧用のindex.mdと編集用の個別ファイルを分離し、index.mdに `![[path.excalidraw]]` で埋め込み表示することで、画面遷移なしで一覧確認が可能 |
| **推奨** | 以下のファイル構成を採用する |

#### 構成

```
wireframes/
├── 00_wireframe_index.md      ← 閲覧用（埋め込み一覧）
├── 01_login/
│   └── default.excalidraw     ← 編集用（基本状態）
├── 02_dashboard/
│   ├── default.excalidraw
│   └── search_active.excalidraw  ← 編集用（派生状態）
└── ...
```

#### 命名規則

| 要素 | 規則 | 例 |
|------|------|-----|
| インデックス | `00_` プレフィックス | `00_wireframe_index.md` |
| 画面フォルダ | `XX_screen_name/` | `02_dashboard/` |
| 基本状態 | `default.excalidraw` | 通常表示 |
| 派生状態 | `<state>.excalidraw` | `search_active.excalidraw` |

#### メリット

- スクロールで全画面確認（画面遷移不要）
- 戻るボタン問題解消
- 編集性維持（個別ファイル直接編集可能）
- 状態管理の明確化（ファイル名で状態識別）

#### 適用実績

- `docs/evidence/20251224_1955_ui_design_login/wireframes/`

### EX-006: z-index問題（配列順序依存）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | ダッシュボード画面で検索ドロップダウンがプロジェクトカードの背後に表示された |
| **知見** | Excalidrawでは要素の配列順序がz-indexを決定する。配列の後ろの要素ほど前面に表示される |
| **推奨** | 前面表示したい要素は配列末尾に配置、または状態別ファイル分離（EX-007）を採用 |

#### 技術詳細

```json
{
  "elements": [
    { "id": "card-1", ... },      // 背面
    { "id": "card-2", ... },      // 中間
    { "id": "dropdown", ... }     // 最前面（配列末尾）
  ]
}
```

#### 問題パターン

| 状況 | 問題 | 解決策 |
|------|------|--------|
| ドロップダウン | 他要素の背後に隠れる | 配列末尾に移動 or 状態別ファイル分離 |
| モーダル背景 | 期待通りに重ならない | オーバーレイ要素を適切な位置に |
| ツールチップ | 親要素に隠れる | 配列末尾に配置 |

### EX-007: 状態別ファイル分離パターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | 1ファイルに複数状態（通常・検索表示等）を入れるとz-index問題・編集困難が発生 |
| **知見** | 画面状態ごとにファイルを分離することでz-index問題を解決し、編集性も向上する |
| **推奨** | `default.excalidraw`（基本状態）+ `<state>.excalidraw`（派生状態）形式を採用 |

#### 構成例

```
02_dashboard/
├── default.excalidraw        ← 通常状態（検索閉じ）
└── search_active.excalidraw  ← 派生状態（検索ドロップダウン表示）
```

#### 比較

| 方式 | z-index | 編集性 | ファイルサイズ | 推奨 |
|------|:-------:|:------:|:--------------:|:----:|
| 1ファイル複数状態 | 問題あり | 困難 | 大 | ❌ |
| 状態別ファイル分離 | 問題なし | 容易 | 適正 | ✅ |

#### 適用条件

- 同一画面に複数の表示状態がある場合（ドロップダウン、モーダル表示等）
- z-index制御が必要な重なり要素がある場合
- 状態ごとに独立して編集したい場合

### EX-008: Search UI Pattern Selection Principle（検索UIパターン選択原則）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | ワイヤーフレームで検索バー（常時表示）と検索モーダル（クリック時表示）を両方配置していた |
| **知見** | 検索UIには2つの標準パターン（A: Inline/Dropdown、B: Command Palette）があり、これらは**排他的**。混在させると「どこに入力すべきか」でユーザー混乱が発生する |
| **推奨** | 設計書で採用パターンを確認し、1つのパターンに統一する。本プロジェクトはPattern A（Inline/Dropdown）を採用 |

#### 2つの標準検索UIパターン

| パターン | 構成 | 採用例 | 特徴 |
|---------|------|--------|------|
| **A: Inline/Dropdown** | 検索バー + ドロップダウン結果 | GitHub, Notion, Slack | 常時表示、即座に結果 |
| **B: Command Palette** | トリガー + モーダル入力 | VS Code, Raycast | Ctrl+K起動、全画面検索 |

#### 混在禁止の理由

- ユーザーは「どちらに入力すべきか」迷う
- 同じ機能を2つのUIで提供する冗長性
- **LV-001（論理的妥当性検証）違反**: 「検索バーがあるのに検索モーダルが出る」は論理的矛盾

> **参照**: LV-001（論理的妥当性検証の原則）

### EX-009: AI作成ワイヤーフレームのObsidian微調整パターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28 |
| **状況** | AI作成のモーダルワイヤーフレームをObsidian Excalidrawで開くとレイアウト調整が必要だった |
| **知見** | AI作成時の座標値は概算であり、ボタン内テキスト中央配置やフレームサイズは目視調整が必要 |
| **推奨** | AI作成後、必ずObsidianで開いて視覚確認し、必要に応じて微調整する |

#### 典型的な調整項目

| 項目 | AI作成時 | Obsidian調整後 | 理由 |
|------|---------|---------------|------|
| モーダルフレーム高さ | 320px | 337.88px | ボタンがフレーム内に収まるよう調整 |
| ボタン内テキスト位置 | 概算値 | 中央配置 | 目視で中央に調整 |
| メタデータ | 最小限 | 完全版 | プラグインが自動追加 |

#### Obsidian Excalidrawプラグインが追加するフィールド

```json
{
  "version": 2,
  "versionNonce": 123456789,
  "index": "a0",
  "isDeleted": false,
  "seed": 1,
  "groupIds": [],
  "frameId": null,
  "boundElements": [],
  "updated": 1766878681819,
  "link": null,
  "locked": false
}
```

> **注意**: これらのフィールドはプラグインが管理するため、AI作成時に含める必要はない。

### EX-010: CRUDフォームパターンの寸法標準化

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28 |
| **状況** | #06, #07, #09モーダル作成時に共通パターンが明確化 |
| **知見** | CRUDフォームモーダルは幅480px固定、高さは入力要素数に応じて可変（+50-60px/追加要素） |
| **推奨** | 新規モーダル作成時は本パターンを基準として設計する |

#### 寸法標準

| モーダル | 入力要素数 | 幅 | 高さ | 備考 |
|---------|:----------:|:---:|:----:|------|
| #06 新規PJ作成 | 2（名前+説明） | 480px | 320px | 基本形 |
| #07 PJ編集 | 2（名前+説明） | 480px | 337px | 既存値プリセット |
| #09 新規図表作成 | 3（名前+タイプ+リンク） | 480px | 380px | ラジオボタン含む |

#### 高さ算出目安

```
基本高さ: 280px（タイトル + ボタン + 余白）
+ テキスト入力: +40px/要素
+ マルチライン入力: +60px/要素
+ ラジオボタングループ: +50px
+ エラー表示エリア: +30px
+ リンク: +20px
```

### EX-011: ラジオボタン選択UIパターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28 |
| **状況** | #09で図表タイプ（PlantUML/Excalidraw）の排他的選択が必要 |
| **知見** | 2-4択の排他的選択にはラジオボタンが最適。ドロップダウンは選択肢が隠れるため不適 |
| **推奨** | 排他的選択肢が2-4個の場合はラジオボタン、5個以上はドロップダウンを使用 |

#### 構成

```
[ 図表タイプ ]                  ← ラベル（グレー背景）
  ○ PlantUML                   ← 選択肢1（デフォルト選択）
  ○ Excalidraw                 ← 選択肢2
```

#### 適用基準

| 選択肢数 | 推奨UI | 理由 |
|:--------:|--------|------|
| 2-4個 | ラジオボタン | 全選択肢が常に見える |
| 5個以上 | ドロップダウン | 画面スペース節約 |
| ON/OFF | チェックボックス | 単一のON/OFF切替 |

### EX-012: モーダル間リンクパターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28 |
| **状況** | #09モーダル内に「テンプレートから作成」リンクでUC 3-2への導線が必要 |
| **知見** | モーダル内で関連UCへの導線を提供する場合、下線テキストリンク形式が最適 |
| **推奨** | モーダル内リンクは控えめに配置し、主アクション（作成/保存）との混同を避ける |

#### 構成

```
┌─────────────────────────────────┐
│ 新規図表作成           [×]     │
├─────────────────────────────────┤
│ 図表名 *                        │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                 │
│ ☞ テンプレートから作成 ←下線リンク │
│                                 │
│         [ キャンセル ] [ 作成 ] │
└─────────────────────────────────┘
```

#### 設計原則

| 原則 | 説明 |
|------|------|
| **位置** | 入力エリアとボタンの間（目立ちすぎない位置） |
| **スタイル** | 下線テキスト（ボタンと差別化） |
| **アイコン** | 任意（☞ または → で誘導） |
| **動作** | クリックで別モーダル/画面へ遷移 |

### EX-013: テンプレートカードグリッドパターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（Session 11） |
| **状況** | #10テンプレート選択モーダル作成時、多数テンプレートの表示方法を設計 |
| **知見** | 3×2グリッド（6枚表示）が比較と一覧性のバランス最適。スクロールで追加テンプレートにアクセス |
| **推奨** | カード構成を標準化: プレビュー(130×75) + 名称(13px) + 説明(11px)、カードサイズ150×130 |

#### 構成

```
┌────────────────────────────────────────────────────┐
│ テンプレートカードグリッド（3×2）                    │
├─────────────┬─────────────┬─────────────┬──────────┤
│ [Preview]   │ [Preview]   │ [Preview]   │ ↕        │
│ 基本シーケンス │ 認証フロー   │ API呼び出し  │ スクロール │
│ 2者間の...   │ ログイン... │ REST API... │ バー      │
├─────────────┼─────────────┼─────────────┤          │
│ [Preview]   │ [Preview]   │ [Preview]   │          │
│ 非同期処理   │ エラー...   │ データベース │          │
│ Async/...  │ try-catch  │ CRUD操作例  │          │
└─────────────┴─────────────┴─────────────┴──────────┘
```

#### カード内要素

| 要素 | サイズ | 色 | 備考 |
|------|--------|-----|------|
| カード外枠 | 150×130 | stroke: #cccccc | 選択時: strokeWidth: 3, #1e1e1e |
| プレビュー | 130×75 | bg: #f0f0f0 | [Preview]テキスト表示 |
| 名称 | 13px | #1e1e1e | 2〜6文字推奨 |
| 説明 | 11px | #888888 | 具体例を示す |

### EX-014: スクロールバー明示化の重要性

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（Session 11） |
| **状況** | #10モーダル作成時、ユーザーから「スクロールバーで縦スクロールしますよね？」と指摘 |
| **知見** | Low-Fidelityワイヤーフレームでもスクロールバーは明示的に描画必須。コンテンツの切れ目だけでは不十分 |
| **推奨** | track(10×高さ, #f0f0f0) + thumb(8×80, #bbbbbb)を配置 |

#### 設計原則

| 原則 | 説明 |
|------|------|
| **視認性** | スクロールバーはUIの一部として明示描画 |
| **位置** | コンテンツエリア右端に配置 |
| **サイズ** | track幅10px、thumb幅8px（適度なグリップ感） |

#### スクロールバー要素

```json
{
  "scrollbar-track": { "x": 722, "y": 175, "width": 10, "height": 280, "bg": "#f0f0f0" },
  "scrollbar-thumb": { "x": 723, "y": 180, "width": 8, "height": 80, "bg": "#bbbbbb" }
}
```

### EX-015: （テンプレート - 新規知見追加用）

| 項目 | 内容 |
|------|------|
| **発見日** | YYYY-MM-DD |
| **状況** | （発見状況を記載） |
| **知見** | （獲得した知見を記載） |
| **推奨** | （推奨される対応を記載） |

---

## Logical Validation知見（論理的妥当性検証）

> **位置づけ**: LV-XXXは**メタ原則**であり、EX/SD/TD/ICの上位に位置する。すべてのUI設計作業において、技術的・パターン的判断の**前に**論理的妥当性を検証すべきという原則。

### LV-001: UI論理的妥当性検証の原則

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | 検索バー＋検索モーダルの同時配置をユーザーが「理論的におかしい」と指摘 |
| **知見** | UI要素追加前に「論理的に必要か」を検証すべき。パターン知識の適用は、論理的妥当性検証の**後**に行う |
| **推奨** | 4原則に基づく検証フローを実施してからUI要素を追加する |

#### 背景: なぜ論理的検証が必要か

```
従来の思考プロセス:
  パターン知識 → 適用 → UI完成
  （「検索はモーダルがいい」→ 配置 → 完成）

問題のある思考プロセス:
  パターンA適用 + パターンB適用 → 矛盾UI
  （検索バー配置 + 検索モーダル配置 → 機能重複）

正しい思考プロセス:
  論理的妥当性検証 → パターン選択 → 適用 → UI完成
  （「この要素は必要か？」→ 必要なら「どのパターンか」→ 配置）
```

#### 4原則（Logical Validation Principles）

| # | 原則名 | 定義 | 違反時の症状 |
|:-:|--------|------|-------------|
| P1 | **機能一意性原則** | 各UI要素は一意の機能を提供すべき | 機能重複、冗長UI |
| P2 | **論理整合性原則** | UI要素間に論理的矛盾がないこと | ユーザー混乱、操作迷い |
| P3 | **認知負荷最小化原則** | 不要な選択肢を排除すること | 判断疲れ、離脱 |
| P4 | **状態-行動一貫性原則** | 現在状態から導かれる行動が論理的であること | 「なぜこれが出る？」という違和感 |

#### 検証フロー（UI要素追加前に実施）

```
┌─────────────────────────────────────────────────────────┐
│ Phase 1: 機能分析                                       │
│ Q1. このUI要素は何の機能を提供するか？                  │
│ Q2. その機能はユーザーのどのニーズに応えるか？          │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 2: 一意性検証                                     │
│ Q3. 同じニーズに応える既存UI要素はあるか？              │
│     → YES: 原則P1違反の可能性 → Phase 3で必要性を論証   │
│     → NO: Phase 4へ                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 3: 必要性論証                                     │
│ Q4. 既存要素では満たせない理由は何か？                  │
│     → 明確な理由あり: 追加を正当化可能 → Phase 4へ      │
│     → 理由なし: 追加は不要（削除または統合）            │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 4: 整合性検証                                     │
│ Q5. 追加によりユーザーの認知モデルに矛盾が生じないか？  │
│ Q6. 操作フローは論理的に一貫しているか？                │
└─────────────────────────────────────────────────────────┘
```

#### 適用例: 検索バー＋検索モーダル問題

| Phase | 質問 | 検索バー | 検索モーダル | 判定 |
|:-----:|------|---------|-------------|:----:|
| 1 | 機能は？ | テキスト検索 | テキスト検索 | - |
| 1 | ニーズは？ | 「探したい」 | 「探したい」 | - |
| 2 | 既存要素あり？ | - | **検索バーが既に存在** | ⚠️ |
| 3 | 追加理由は？ | - | **明確な理由なし** | ❌ |
| 4 | 矛盾は？ | - | **「どちらで検索？」という混乱** | ❌ |

**結論**: Phase 2-4で原則違反を検出 → 検索モーダルは論理的に不要

#### パターン知識との関係

```
パターン知識（EX-008等）:
  - 「Aパターンではこうする」という手続き的知識
  - 適用場面を誤ると無意味

論理的妥当性検証（LV-001）:
  - 「そもそもこのUIは必要か」という根本的問い
  - パターン適用の前提条件を検証する

関係性:
  LV-001（論理的妥当性検証）→ パターン選択（EX-008等）→ 実装
  （前提検証）               （手段選択）           （実行）
```

> **核心**: 論理的妥当性検証は、パターン知識よりも**先に**実施すべきメタ原則である。

### LV-002: UI一貫性原則（Cross-Screen Consistency）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-27 |
| **状況** | ログイン画面（400×420）とホーム画面（1920×1080）で4.8倍のサイズ差があり、z-index問題やレイアウト不整合が発生 |
| **知見** | 画面間のUI一貫性は4つの観点（視覚/構造/操作/用語）で検証すべき。ただし、画面の位置づけが異なる場合（ログイン vs. ダッシュボード）はサイズ差を許容できる |
| **推奨** | 新規画面作成時にLV-002の4原則に基づいて既存画面との一貫性を検証する |

#### 背景: なぜUI一貫性が必要か

```
単一画面の論理性（LV-001）:
  - その画面内でUI要素間に矛盾がないか
  - 同じ機能を複数UIで提供していないか

画面間の一貫性（LV-002）:
  - 複数画面を跨いでUI設計が統一されているか
  - ユーザーが一貫した体験を得られるか

関係性:
  LV-001（単一画面の論理性）+ LV-002（画面間の一貫性）= 全体のUI品質
```

#### 4原則（Consistency Principles）

| # | 原則名 | 定義 | 適用範囲 | 例外 |
|:-:|--------|------|----------|------|
| C1 | **視覚的一貫性** | 色・タイポグラフィ・間隔を統一 | 全画面共通 | なし |
| C2 | **構造的一貫性** | ヘッダー/サイドバー等のレイアウトパターン統一 | 同一カテゴリ | 位置づけが異なる画面（※1） |
| C3 | **操作的一貫性** | ボタン位置・ジェスチャー・キーボードショートカット統一 | 全画面共通 | なし |
| C4 | **用語的一貫性** | ラベル・ボタンテキスト・エラーメッセージ統一 | 全画面共通 | なし |

> **※1 C2例外条件**: ログイン画面（認証特化）とダッシュボード（主要作業画面）のように、画面の**位置づけ**（目的・役割）が根本的に異なる場合、サイズ差やレイアウトの大幅な違いは許容される。

#### 検証フロー（新規画面作成前に実施）

```
┌─────────────────────────────────────────────────────────────────┐
│ Phase 1: 既存画面との関係分析                                    │
│ Q1. この画面は既存画面と同じカテゴリ（認証/メイン/モーダル）か？  │
│ Q2. 同カテゴリの既存画面のスタイル設定は何か？                   │
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│ Phase 2: 視覚的一貫性検証（C1）                                  │
│ Q3. strokeColor / backgroundColor は既存画面と一致するか？      │
│ Q4. roughness / fontFamily は既存画面と一致するか？             │
│     → 不一致: 修正が必要                                        │
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│ Phase 3: 構造的一貫性検証（C2）                                  │
│ Q5. ヘッダー/サイドバー/フッターの有無は同カテゴリ画面と一致？  │
│ Q6. 画面サイズは同カテゴリ画面と一致？                          │
│     → 不一致の場合: 位置づけが異なるか確認（例外条件）          │
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│ Phase 4: 操作的・用語的一貫性検証（C3/C4）                       │
│ Q7. ボタンの配置パターン（右寄せ/中央/左寄せ）は統一されているか │
│ Q8. 同じ機能のラベルは同じ文言か（「保存」vs「Save」等）        │
│     → 不一致: 修正が必要                                        │
└─────────────────────────────────────────────────────────────────┘
```

#### 適用例: ログイン画面 vs. ホーム画面

| 観点 | ログイン画面 | ホーム画面 | 判定 |
|------|-------------|-----------|:----:|
| **位置づけ** | 認証特化（一時滞在） | 主要作業画面（長時間滞在） | 異なる |
| **C1 視覚的** | strokeColor #666666, roughness 1 | strokeColor #666666, roughness 1 | ✅ 一致 |
| **C2 構造的** | 400×420, ヘッダーなし | 1920×1080, 50pxヘッダー | ⚠️ 例外適用 |
| **C3 操作的** | ボタン中央配置 | ボタン右寄せ傾向 | 🟡 要確認 |
| **C4 用語的** | 「ログイン」「サインイン」 | - | ✅（用語使い分け） |

**結論**: C2の差異は「位置づけが異なる」例外条件に該当するため許容。C1/C4は一致。C3は今後の画面作成で確認が必要。

#### LV-001との関係

```
LV-001（論理的妥当性検証）:
  - 対象: 単一画面内
  - 問い: 「このUI要素は論理的に必要か」
  - 例: 検索バー＋検索モーダルの矛盾

LV-002（UI一貫性原則）:
  - 対象: 複数画面間
  - 問い: 「既存画面と一貫しているか」
  - 例: ログイン画面とホーム画面のスタイル差異

適用順序:
  1. LV-001: 単一画面の論理性検証（UI要素追加前）
  2. LV-002: 画面間一貫性検証（新規画面作成前）
```

> **核心**: LV-001は「画面内の論理性」、LV-002は「画面間の一貫性」。両者は補完関係にある。

### LV-003: （テンプレート - 新規知見追加用）

| 項目 | 内容 |
|------|------|
| **発見日** | YYYY-MM-DD |
| **状況** | （発見状況を記載） |
| **知見** | （獲得した知見を記載） |
| **推奨** | （推奨される対応を記載） |

---

## State Diagram知見

### SD-001: 開始点・終了点の必須化

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 画面遷移図で開始点がないと警告される |
| **知見** | PlantUML state diagramでは `[*] --> State` と `State --> [*]` が必須ではないが、UI設計では必須とすべき |
| **理由** | ユーザーがどこから開始し、どこで終了するかを明示するため |

### SD-002: 複合状態（ネスト）の活用

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 画面数が多い場合のグルーピング |
| **知見** | `state Name { ... }` で関連画面をグループ化可能。例: 認証画面群、設定画面群 |
| **注意点** | ネストは2階層まで。3階層以上は可読性が低下 |

### SD-003: 遷移ラベルの命名規則

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 遷移トリガー（ラベル）の書き方 |
| **知見** | 動詞形で統一。「クリック」ではなく「ログイン」「保存」など操作の結果を記載 |
| **例** | `login --> dashboard : ログイン成功` ではなく `login --> dashboard : ログイン` |

### SD-004: 色分けとskinparam

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 画面カテゴリの視覚的区別 |
| **知見** | `skinparam state { BackgroundColor<<tag>> #COLOR }` で状態に色を付けられる |
| **推奨色** | 認証: #FFFDE7（黄）、メイン: #E3F2FD（青）、モーダル: #E8F5E9（緑） |

### SD-005: 手書き風オプション（非推奨）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | PlantUML画面遷移図での視認性検証 |
| **知見** | `!option handwritten true` は**PlantUMLでは使用しない**。視認性を著しく低下させる |
| **理由** | 複雑な遷移図では矢印・ラベルが読みにくくなり、本来の目的（構造把握）を阻害 |
| **適用範囲** | 手書き風はExcalidrawワイヤーフレームのみ。PlantUMLはデフォルトフォント推奨 |

### SD-006: 矢印交差問題（実体験: 2025-12-22）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 19ノード（4グループ）の画面遷移図を作成し、PNG生成後に視覚確認 |
| **問題** | グループ間遷移（認証→メイン、メイン→モーダル、メイン→管理）の矢印が複雑に交差し、視認性が低下 |
| **原因** | PlantUMLの自動レイアウトでは、多数のグループ間遷移を最適配置できない |
| **知見** | 19ノード以上の複雑な遷移図では、グループ間遷移の矢印が交差する可能性が高い |
| **推奨** | 1. 遷移図を分割（認証フロー、メインフロー等）を検討<br/>2. 矢印のスタイル（破線等）で区別する |
| **エビデンス** | `docs/proposals/diagrams/09_screen_transition/PlantUML_Studio_Screen_Transition.png` |

### SD-007: モーダル群のノード密集問題（実体験: 2025-12-22）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | モーダル群として8つのモーダル画面をグループ化 |
| **問題** | 8ノードが横並びになり、ラベルが読みにくくなった |
| **原因** | PlantUMLは複合状態内のノードを自動配置するが、多数ノードでは密集する |
| **知見** | 1つのグループ内のノード数は5〜6以下が推奨。超える場合はサブグループ化を検討 |
| **推奨** | モーダルを機能別にサブグループ化: <br/>- プロジェクト系（作成、編集、削除確認）<br/>- 図表系（作成、テンプレート、エクスポート、削除確認）<br/>- AI系（AIチャット） |
| **エビデンス** | `docs/proposals/diagrams/09_screen_transition/PlantUML_Studio_Screen_Transition.png` |

### SD-008: （テンプレート - 新規知見追加用）

| 項目 | 内容 |
|------|------|
| **発見日** | YYYY-MM-DD |
| **状況** | （発見状況を記載） |
| **知見** | （獲得した知見を記載） |
| **推奨** | （推奨される対応を記載） |

---

## TD-015適用知見

### TD-001: 「低精度」の具体的基準

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 「低精度」がどの程度かの判断 |
| **知見** | 1画面15分以内で作成できるレベルが「低精度」の目安 |
| **チェック** | 30分以上かけていたら「やりすぎ」の可能性 |

### TD-002: グラデーション・影の完全禁止

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | ボタンやカードに影を付けたくなる誘惑 |
| **知見** | グラデーション・ドロップシャドウは絶対禁止。フラットなグレー単色のみ |
| **理由** | 「デザイン」の議論を避け、「機能配置」の議論に集中するため |

### TD-003: アイコン使用の制限

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | アイコンをどこまで描くか |
| **知見** | 簡易記号（🔍、📁、⚙️等）は可。複雑なカスタムアイコンは禁止 |
| **理由** | アイコンデザインは設計フェーズで決定すべき |

### TD-004: （テンプレート - 新規知見追加用）

| 項目 | 内容 |
|------|------|
| **発見日** | YYYY-MM-DD |
| **状況** | （発見状況を記載） |
| **知見** | （獲得した知見を記載） |
| **推奨** | （推奨される対応を記載） |

---

## 整合性チェック知見

### IC-001: 3点対比確認の重要性

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | ワイヤーフレームと遷移図の不整合 |
| **知見** | 「画面一覧」「ワイヤーフレーム」「遷移図ノード」の3点が1:1対応していることを確認必須 |
| **手順** | 1. 画面一覧作成 → 2. 一覧の全画面にワイヤーフレーム作成 → 3. 全画面を遷移図にノード化 |

### IC-002: モーダル・ダイアログの扱い

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | モーダルは「画面」として扱うか |
| **知見** | モーダル・ダイアログも画面として抽出し、遷移図にノードとして含める |
| **理由** | ユーザーの視点では別画面に見える。遷移を明示するため |

### IC-003: 孤立ノードの発見方法

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | PNG視覚確認で孤立ノードを見落とした |
| **知見** | 「入力矢印なし」「出力矢印なし」の両方を別々にチェックする |
| **手順** | Pass 1: 各ノードに入力があるか確認 → Pass 2: 各ノードに出力があるか確認 |

### IC-004: UC図からの画面抽出プロセス（実体験: 2025-12-22）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 32UC（5パッケージ）から画面一覧を抽出し、遷移図を作成 |
| **実施内容** | 1. UC図読込 → 2. 業務フロー図読込 → 3. 画面抽出 → 4. カテゴリ分類 → 5. 遷移図作成 |
| **知見** | UCと画面は1:1対応ではない。複数UCが1画面に集約されるケース（エディタ画面: UC 3-1〜3-6, 4-1〜4-2）と、1UCが複数画面に分散されるケース（管理機能群）がある |
| **推奨** | UC図だけでなく業務フロー図も参照して画面を抽出すべき。業務フローから「ユーザーが見る画面」を特定する |
| **結果** | 32UC → 19画面（認証3、メイン3、モーダル8、管理5） |
| **エビデンス** | 作成した遷移図: `docs/proposals/diagrams/09_screen_transition/99_screen_transition.puml` |

### IC-005: ノード内情報量の制御（実体験: 2025-12-22）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-22 |
| **状況** | 各ノードにUC番号と機能概要を記載し、PNG生成後に確認 |
| **問題** | ノード内の情報が多すぎると、特に小さいノードでテキストが重なり視認性が低下 |
| **知見** | 1ノードあたりの情報は2-3行が限界。UC番号 + 1行説明が適切 |
| **推奨** | 詳細情報はノート（note）を使用して分離する |
| **エビデンス** | `docs/proposals/diagrams/09_screen_transition/PlantUML_Studio_Screen_Transition.png` |

### IC-006: （テンプレート - 新規知見追加用）

| 項目 | 内容 |
|------|------|
| **発見日** | YYYY-MM-DD |
| **状況** | （発見状況を記載） |
| **知見** | （獲得した知見を記載） |
| **推奨** | （推奨される対応を記載） |

---

## 知見追加プロセス

新しい知見を発見した場合、以下の手順で追加する：

1. **該当セクションを特定**
   - Excalidraw関連 → EX-XXX
   - State Diagram関連 → SD-XXX
   - TD-015関連 → TD-XXX
   - 整合性チェック関連 → IC-XXX

2. **テンプレートをコピー**
   - 各セクション末尾のテンプレート（EX-005, SD-006等）をコピー

3. **内容を記入**
   - 発見日、状況、知見、推奨の4項目を記入

4. **番号を更新**
   - 新しい知見に連番を付与
   - テンプレートの番号をインクリメント

5. **憲法への反映を検討**
   - 重要な知見は `UI_Design_Constitution.md` の該当セクションにも追記

---

## 関連ドキュメント

### ui_designディレクトリ内

| ドキュメント | 内容 |
|-------------|------|
| `UI_Design_Constitution.md` | UI設計図表開発憲法（本知見ベースの親ドキュメント） |
| `00_Session_Start.md` | セッション開始ガイド |
| `01_Reference_Guide.md` | 参照ガイド |
| `02_Authoring_Guide.md` | 作成ガイドライン |
| `03_Knowledge_Strategy.md` | 知見統合戦略 |
| `Design_Pattern_Checklist.md` | 設計パターンチェックリスト |
| `UI_Design_Patterns.md` | UI設計パターン集 |

### 外部参照

| ドキュメント | 内容 |
|-------------|------|
| `.serena/memories/wireframe_research_td015_decision_2025-11-26_29.md` | TD-015意思決定記録 |
| `docs/guides/PlantUML_Development_Constitution.md` | PlantUML開発憲法（参考） |
| `docs/guides/sequence_diagram/Activation_Bar_Knowledge_Base.md` | アクティブバー知見ベース（参考） |

---

## ケーススタディ

### CS-001: 初回画面遷移図作成（19ノード4グループ）

| 項目 | 内容 |
|------|------|
| **実施日** | 2025-12-22 |
| **対象** | PlantUML Studio 全画面遷移図 |
| **入力** | UC図（32UC）、業務フロー図（11フロー） |
| **出力** | `99_screen_transition.puml`（19ノード、4グループ） |

#### 作業プロセス

| ステップ | 内容 | 所要時間（推定） |
|:--------:|------|:--------------:|
| 1 | UC図読込・分析 | 5分 |
| 2 | 業務フロー図読込・画面抽出 | 10分 |
| 3 | 画面カテゴリ分類（auth/main/modal/admin） | 5分 |
| 4 | PlantUML構文確認（Context7 + 公式ドキュメント） | 10分 |
| 5 | pumlファイル作成 | 20分 |
| 6 | PNG生成 | 1分 |
| 7 | 5パスレビュー | 10分 |
| **合計** | | **約60分** |

#### 発見した問題

| # | 問題 | 知見ID | 対応状況 |
|:-:|------|:------:|:--------:|
| 1 | 矢印の交差が多い | SD-006 | 知見記録 |
| 2 | モーダル8ノード密集 | SD-007 | 知見記録 |
| 3 | ノード内情報過多 | IC-005 | 知見記録 |

#### 得られた知見サマリー

| カテゴリ | 追加知見数 | ID |
|---------|:--------:|-----|
| State Diagram | 2 | SD-006, SD-007 |
| 整合性チェック | 2 | IC-004, IC-005 |
| **合計** | **4** | |

#### 品質評価

| 観点 | 評価 | コメント |
|------|:----:|---------|
| TD-015準拠 | ✅ | handwritten true適用 |
| 網羅性 | ✅ | 32UC → 19画面マッピング完了 |
| UC対応 | ✅ | 全ノードにUC番号記載 |
| 視認性 | 🟡 | 矢印交差・密集問題あり |

#### 結論

初回作成で4つの実体験知見を獲得。次回作成時は以下を改善予定：
1. モーダル群をサブグループ化
2. グループ間遷移の矢印スタイル変更
3. ノード内情報量の削減

---

### CS-002: 00_wireframe_index.md 更新漏れ事例と再発防止

| 項目 | 内容 |
|------|------|
| **発生日** | 2025-12-28（Session 8） |
| **対象** | プロジェクト詳細画面ワイヤーフレーム作成 |
| **問題** | ワイヤーフレーム作成後、`00_wireframe_index.md`の更新を忘れた |

#### 問題の詳細

| ステップ | 実施 | 漏れた内容 |
|---------|:----:|-----------|
| ワイヤーフレーム作成 | ✅ | - |
| 5パスレビュー | ✅ | - |
| `00_wireframe_index.md`更新 | ❌ | 進捗サマリー、作成計画テーブル、完了済み画面セクション |

#### 原因分析

| 原因 | 詳細 |
|------|------|
| **チェックリスト不足** | `00_Session_Start.md`にのみ記載、他ガイドに未反映 |
| **一箇所集中管理の欠如** | 複数ドキュメントに分散した更新要件 |

#### 再発防止策（実施済み）

| # | 対策 | 対象ファイル | Ver |
|:-:|------|-------------|:---:|
| 1 | 付録D統合チェックリスト Phase 1-A に項目追加 | UI_Design_Constitution.md | v3.7 |
| 2 | 付録D統合チェックリスト 完了処理 に項目追加 | UI_Design_Constitution.md | v3.7 |
| 3 | §9 成果物保存に「ワイヤーフレーム一覧管理」サブセクション追加 | 02_Authoring_Guide.md | 2025-12-28 |
| 4 | Step 8 に更新漏れ防止注記追加 | 00_Session_Start.md | v1.6 |

#### 関連知見

| ID | 関連性 |
|:--:|--------|
| EX-005 | Embedded Index Pattern（00_wireframe_index.md の設計根拠）|
| IC-001 | 3点対比確認（一覧管理の重要性）|

#### 教訓

> **プロセス改善の原則**: 更新漏れが発生した場合、**単一のファイル修正だけでなく、関連するすべてのガイドラインに反映する**ことで、再発防止の網を張る。

---

### CS-003: Step 8記載だけでは不十分 - 即時更新ルールの必要性

| 項目 | 内容 |
|------|------|
| **発生日** | 2025-12-28（Session 9） |
| **対象** | 新規PJ作成モーダルワイヤーフレーム作成 |
| **問題** | CS-002で再発防止策を4ファイルに反映したにも関わらず、再度`00_wireframe_index.md`更新漏れが発生 |

#### 問題の分析

| 項目 | CS-002時点 | CS-003発見 |
|------|-----------|-----------|
| 更新タイミング | Step 8（成果物保存） | ファイル作成からレビュー完了まで時間差あり |
| 記述位置 | 「必須」と明記 | 「必須」だけでは認知されにくい |
| 根本原因 | - | **Step 8に記載しても、Step 5でファイル作成直後に実行されない** |

#### 解決策

| 対策 | 内容 |
|------|------|
| **即時更新ルール** | Step 5に「⚠️ `00_wireframe_index.md` 即時更新（必須）」を追加 |
| **警告追加** | 「Step 8まで待ってはならない。作成と同時に一覧登録が必須」と明記 |
| **更新ファイル** | `00_Session_Start.md` v1.7 |

#### 教訓

> **プロセス設計の原則**: 「完了時に実施」より「作成直後に実施」の方が漏れにくい。ファイル作成と一覧登録は**同時に**行うべき。Step 8への記載は二重チェックとして残すが、主たる実行タイミングはStep 5。

---

### CS-004: 引継ぎファイル完全性チェック

| 項目 | 内容 |
|------|------|
| **発生日** | 2025-12-28（Session 9） |
| **対象** | セッション引継ぎファイル作成 |
| **問題** | 「既存Evidenceを継続利用する」という記述が漏れた |
| **重大度** | 中 |

#### 問題の分析

| 項目 | 説明 |
|------|------|
| 漏れた情報 | `docs/evidence/20251224_1955_ui_design_login/`を継続利用すること |
| 当事者視点 | 当然のこと（暗黙知）として認識 |
| 新セッション視点 | 不明確（新規Evidenceを作成する可能性あり） |
| 根本原因 | **暗黙知が明示化されなかった** |

#### 解決策：Evidence管理パターンの明示

| パターン | 条件 | 記載例 |
|---------|------|--------|
| **A: 継続利用** | 同一タスクが継続中 | 「既存の`docs/evidence/yyyyMMdd_HHmm_xxx/`を継続利用」 |
| **B: 新規作成** | 新しいタスク開始 | 「`pwsh scripts/create_evidence.ps1 yyyyMMdd_HHmm_yyy`で新規作成」 |

#### 解決策：引継ぎファイル作成時チェックリスト

| # | 確認項目 | 質問形式 |
|:-:|---------|---------|
| 1 | **Evidence管理** | 継続利用か新規作成か？（パターンA/B） |
| 2 | **継続リソース** | 新セッションで再利用すべきファイル/ディレクトリは？ |
| 3 | **禁止事項** | 新セッションでやってはいけないことは？ |
| 4 | **前提条件** | 当然だと思っているが明示すべきことは？ |
| 5 | **コンテキスト依存** | このセッション固有の設定/状態は？ |

#### 教訓

> **引継ぎの原則**: 「当然のこと」こそ明示的に書く。暗黙知は新しいコンテキスト（新セッション、新担当者）では通用しない。

---

### CS-005: ユーザー確認スキップ違反（Step 6必須化）

| 項目 | 内容 |
|------|------|
| **発生日** | 2025-12-28（Session 10） |
| **対象** | #08 PJ削除確認モーダル ワイヤーフレーム作成 |
| **問題** | ワイヤーフレーム作成後、ユーザー確認（Step 6）を得ずに5パスレビュー・Evidence更新まで進行した |
| **重大度** | **高**（協調作成プロセスの根本違反） |

#### 問題の詳細

| ステップ | #07 PJ編集モーダル | #08 PJ削除確認モーダル |
|---------|:-----------------:|:---------------------:|
| Step 5: ワイヤーフレーム作成 | ✅ | ✅ |
| Step 6: **ユーザーに提示・確認待ち** | ✅ 確認済み | ❌ **スキップ** |
| Step 7: 5パスレビュー | ✅ | ✅（違反） |
| Step 8: Evidence更新 | ✅ | ✅（違反） |

#### 原因分析

| 原因レベル | 説明 |
|-----------|------|
| **直接原因** | ユーザーの「進んでください」を#07と#08両方の承認と解釈した |
| **構造的原因** | Todoリストに「ユーザーに提示・確認待ち」が含まれていなかった |
| **根本原因** | `00_Session_Start.md` Step 4のTodoテンプレートを正確に適用しなかった |

#### 問題の本質

```
協調作成プロセスとは:
  ユーザー（判断者）← 提示 ← AI（作成者）
  ユーザー（判断者）→ 承認 → AI（次ステップへ）

違反したプロセス:
  AI（作成者）→ 作成 → AI（自己判断で次へ）

問題点:
  - ユーザーの品質ゲートを迂回した
  - AIが勝手に「OK」と判断した
  - 協調作業の信頼関係を損なう
```

#### 再発防止策（実施済み）

| # | 対策 | 対象ファイル | Ver |
|:-:|------|-------------|:---:|
| 1 | Step 4 Todoテンプレートに「⚠️ ユーザーに提示・確認待ち（Step 6必須）← 絶対にスキップ禁止」を追加 | 00_Session_Start.md | v1.8 |
| 2 | CS-005として本ケーススタディを追加 | UI_Design_Knowledge_Base.md | 1.10 |
| 3 | §4 禁止事項に「Step 6スキップ」を追加予定 | UI_Design_Constitution.md | v3.8 |

#### Todoリスト正しいテンプレート

> **注意**: このテンプレートはv1.9時点のもの。最新版（v1.10）は `00_Session_Start.md` Step 4またはCS-006を参照。

```
1. 関連ドキュメント確認（UC図、業務フロー図、機能一覧表）
2. TD-015原則確認
3. ワイヤーフレーム作成（Excalidraw）
4. 5パスレビュー（AI自己評価）← ワイヤーフレーム作成直後に実施（v1.10追加）
5. 00_wireframe_index.md即時更新
6. ⚠️ ユーザーに提示・確認待ち（Step 6必須）← 絶対にスキップ禁止
7. [ユーザー編集後] AI厳格評価・採点（Step 7）
8. [90点未満時] 知見ベース参照・修正（イテレーションループ）（v1.10追加）
9. 画面遷移図更新（必要時）
10. active_context.md更新
11. work_sheet.md・00_raw_notes.md更新
12. SERENA Memory保存
13. Git commit
```

#### 教訓

> **協調作成の原則**: AIは作成者であり、判断者ではない。ユーザー確認なしに「品質OK」と判断することは、協調プロセスの根本違反。「進んでください」は**現在の1タスクに対する承認**であり、**後続タスクの自動承認ではない**。

#### 関連知見

| ID | 関連性 |
|:--:|--------|
| ML-002 | タイミング設計の原則（Step 6はStep 7の前提条件）|
| ML-003 | 多層防御パターン（ユーザーによる品質ゲート）|
| CS-003 | Step 5即時更新ルール（同じくStep位置での違反パターン）|
| CS-006 | Todoテンプレートと憲法の不整合（同じくプロセス定義の問題）|
| CS-007 | イテレーションループ欠落（本問題の発展形、2箇所必須）|

---

### CS-006: Todoテンプレートと憲法の不整合（プロセス順序の同期）

| 項目 | 内容 |
|------|------|
| **発生日** | 2025-12-28（Session 11） |
| **対象** | `00_Session_Start.md` Step 4 Todoテンプレート |
| **問題** | Todoテンプレートの順序が憲法§1.4.1のフローと一致していなかった |
| **重大度** | **中**（プロセス定義の不整合） |

#### 問題の詳細

| 項目 | 憲法§1.4.1（正しい順序） | 旧Todoテンプレート（不整合） |
|------|------------------------|----------------------------|
| 5パスレビュー | ワイヤーフレーム作成**直後** | ユーザー承認**後** |
| 知見ベース参照 | イテレーションループで活用 | 記載なし |

**憲法§1.4.1 Step 1: AI初期作成**:
```
1. 関連ドキュメント確認（UC図、業務フロー図、機能一覧表）
2. TD-015原則に従ってワイヤーフレーム作成（.excalidraw）
3. 5パスレビュー（AI自己評価）  ← ここ！
4. PNGエクスポート（プレビュー用）
5. ユーザーにPNGを提示（「確認してください」）
```

#### 原因分析

| 原因レベル | 説明 |
|-----------|------|
| **直接原因** | Todoテンプレートが憲法のフロー図と同期されていなかった |
| **構造的原因** | 憲法とSession Start Guide間の整合性検証プロセスがなかった |
| **根本原因** | 複数ドキュメントに同じ情報を持つ場合の同期ルールが未定義 |

#### 問題の影響

1. **品質低下リスク**: AI自己評価をスキップし、低品質な成果物をユーザーに提示
2. **効率低下リスク**: イテレーションループで過去の知見を活用せず、同じ失敗を繰り返す
3. **プロセス混乱**: 複数ドキュメントで異なる順序が記載され、どれに従うべきか不明

#### 再発防止策（実施済み）

| # | 対策 | 対象ファイル | Ver |
|:-:|------|-------------|:---:|
| 1 | Step 4 Todoテンプレートに「5パスレビュー（AI自己評価）」を追加（ワイヤーフレーム作成直後） | 00_Session_Start.md | v1.10 |
| 2 | 「知見ベース参照」をイテレーションループに追加 | 00_Session_Start.md | v1.10 |
| 3 | Step 5チェックリストに「5パスレビュー（AI自己評価）」を追加 | 00_Session_Start.md | v1.10 |
| 4 | §0.4 Todoテンプレートを同期 | 01_Reference_Guide.md | v1.1 |
| 5 | CS-006として本ケーススタディを追加 | UI_Design_Knowledge_Base.md | v1.11 |

#### Todoリスト正しいテンプレート（v1.10）

```
1. 関連ドキュメント確認（UC図、業務フロー図、機能一覧表）
2. TD-015原則確認
3. ワイヤーフレーム作成（Excalidraw）
4. 5パスレビュー（AI自己評価）← ワイヤーフレーム作成直後に実施
5. 00_wireframe_index.md即時更新
6. ⚠️ ユーザーに提示・確認待ち（Step 6必須）← 絶対にスキップ禁止
7. [ユーザー編集後] AI厳格評価・採点（Step 7）
8. [90点未満時] 知見ベース参照・修正（イテレーションループ）
9. 画面遷移図更新（必要時）
10. active_context.md更新
11. work_sheet.md・00_raw_notes.md更新
12. SERENA Memory保存
13. Git commit
```

#### 教訓

> **ドキュメント同期の原則**: 同じ情報を複数ドキュメントに記載する場合、**マスターソース（憲法）を定義**し、他のドキュメントは参照リンクを使用するか、変更時に同期を確認すること。

> **知見活用の原則**: イテレーションループで90点未満となった場合、**まず既存の知見ベース（CS-001〜005等）を参照**し、過去の失敗パターンに該当しないか確認すること。これにより効率的な修正が可能になる。

#### 関連知見

| ID | 関連性 |
|:--:|--------|
| CS-003 | Step 5即時更新ルール（同じくStep位置での修正）|
| CS-005 | ユーザー確認スキップ違反（同じくプロセス順序の問題）|
| ML-002 | タイミング設計の原則（正しいタイミングでのアクション）|
| CS-007 | イテレーションループ欠落（本問題の発展形）|

---

### CS-007: イテレーションループ欠落（2箇所必須）

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（Session 11） |
| **発見者** | ユーザー |
| **重大度** | **高**（品質保証の根本欠陥） |
| **対策状況** | v1.11で根本対策実施 |

#### 問題の詳細

**発見された欠陥**: v1.10のTodoテンプレートで、イテレーションループが「ユーザー編集後（Step 8）」にしか存在しなかった。

**欠落していた箇所**: 5パスレビュー後（Step 4-5間）のイテレーションループ

```
【v1.10（欠陥あり）】
3. ワイヤーフレーム作成
4. 5パスレビュー（AI自己評価）
5. 00_wireframe_index.md即時更新  ← 90点未満でもここに進んでしまう
6. ユーザーに提示・確認待ち
7. [ユーザー編集後] AI厳格評価・採点
8. [90点未満時] イテレーションループ  ← ここにしかない！

【v1.11（修正後）】
3. ワイヤーフレーム作成
4. 5パスレビュー（AI自己評価）
5. [90点未満時] イテレーションループ1  ← 追加！
6. 00_wireframe_index.md即時更新
7. ユーザーに提示・確認待ち
8. [ユーザー編集後] AI厳格評価・採点
9. [90点未満時] イテレーションループ2
```

#### なぜこれが問題か

| 影響 | 説明 |
|------|------|
| **低品質成果物のユーザー提示** | 5パスレビューで問題を発見しても、修正せずにユーザーに提示してしまう |
| **協調作成の品質劣化** | AIが品質ゲートを通過せずに成果物を渡すことで、ユーザーの信頼を損なう |
| **イテレーション効率の低下** | 問題を早期に修正しないことで、後工程での手戻りが増加 |

#### 実施した対策

| # | 対策 | ファイル | 内容 |
|:-:|------|---------|------|
| 1 | Todoテンプレート修正 | 00_Session_Start.md | Step 5にイテレーションループ1追加 |
| 2 | Step 5チェックリスト修正 | 00_Session_Start.md | イテレーションループ1をチェック項目に追加 |
| 3 | 参照ガイド同期 | 01_Reference_Guide.md | v1.2でテンプレート同期 |
| 4 | CS-007違反防止警告 | 00_Session_Start.md | 2箇所のイテレーションループを明記 |
| 5 | 本ケーススタディ追加 | UI_Design_Knowledge_Base.md | v1.12 |

#### 正しいTodoテンプレート（v1.11）

```
1. 関連ドキュメント確認（UC図、業務フロー図、機能一覧表）
2. TD-015原則確認
3. ワイヤーフレーム作成（Excalidraw）
4. 5パスレビュー（AI自己評価）← ワイヤーフレーム作成直後に実施
5. [90点未満時] 知見ベース参照・修正 → Step 3に戻る（イテレーションループ1）
6. 00_wireframe_index.md即時更新
7. ⚠️ ユーザーに提示・確認待ち ← 絶対にスキップ禁止
8. [ユーザー編集後] AI厳格評価・採点
9. [90点未満時] 知見ベース参照・修正 → Step 3に戻る（イテレーションループ2）
10. 画面遷移図更新（必要時）
11. active_context.md更新
12. work_sheet.md・00_raw_notes.md更新
13. SERENA Memory保存
14. Git commit
```

#### 教訓

> **品質ゲートの原則**: 5パスレビューは単なるチェックではなく、**品質ゲート**である。90点未満の成果物は**ゲートを通過してはならない**（ユーザーに提示してはならない）。

> **早期修正の原則**: 問題は**発見した時点で即座に修正**すること。後工程に持ち越すと、修正コストが増大し、品質保証の意味がなくなる。

#### 関連知見

| ID | 関連性 |
|:--:|--------|
| CS-005 | ユーザー確認スキップ違反（同じくStep順序の問題）|
| CS-006 | Todoテンプレートと憲法の不整合（直前のテンプレート修正）|
| ML-002 | タイミング設計の原則（正しいタイミングでのアクション）|
| ML-003 | 多層防御パターン（イテレーションループによる品質ゲート）|

---

### CS-008: ユーザー編集後の座標正規化パターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（Session 11） |
| **対象** | #10テンプレート選択モーダル |
| **状況** | ユーザーがObsidianで6枚目のテンプレートカードを追加編集 |
| **問題** | ユーザー追加要素が小数座標（564.6, 318.96）で作成された |

#### 問題の詳細

| 項目 | AI作成要素 | ユーザー追加要素 |
|------|-----------|----------------|
| x座標 | 565（整数） | 564.6（小数） |
| y座標 | 320（整数） | 318.96（小数） |
| グリッド整合性 | 高 | 低 |

#### 解決策

| ステップ | 内容 |
|---------|------|
| 1 | ユーザー修正内容を確認 |
| 2 | 座標を整数に丸める（565, 320） |
| 3 | 要素IDを意味のある命名規則に統一 |
| 4 | 00_wireframe_index.mdの構成要素を更新 |

#### 正規化の指針

| 項目 | 推奨 |
|------|------|
| **座標** | 5px刻みの整数座標（例: 565, 320） |
| **要素ID** | `<type>-<number>-<role>`形式（例: template-card-6, template-6-preview） |
| **他要素との整列** | 既存要素のパターンに合わせる |

#### 教訓

> **AI-ユーザー協調の原則**: ユーザーがObsidian/Excalidrawで直接編集した場合、AIはその修正内容を尊重しつつ、技術的な整合性（座標正規化、ID命名規則）を補完する役割を担う。

#### 関連知見

| ID | 関連性 |
|:--:|--------|
| EX-009 | AI作成ワイヤーフレームのObsidian微調整パターン |
| EX-013 | テンプレートカードグリッドパターン（同じモーダルで発見）|

---

## メタ知見（Meta-Level Insights）

プロセス設計の指針となる上位レベルの知見。

### ML-001: プロセス改善の反復性

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（CS-002→CS-003の経験から） |

```
問題発見 → 対策実施 → 再発見 → 追加対策 → ...
   ↑                              ↓
   └──────────────────────────────┘
```

**原則**:
- 1回の改善で完璧にはならない
- CS-002 → CS-003 は正常なプロセス改善サイクル
- 「対策したのに漏れた」は失敗ではなく、改善の機会

---

### ML-002: タイミング設計の原則

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（CS-003の分析から） |

| タイミング | 成功率 | 理由 |
|-----------|:------:|------|
| **ファイル作成直後** | 高 | 作業記憶が鮮明、コンテキストスイッチなし |
| 作業完了時（Step 8） | 中 | 複数タスク完了後、漏れやすい |
| セッション終了時 | 低 | 疲労、時間切れ、優先度低下 |

**設計原則**:

| 原則 | 説明 | 適用例 |
|------|------|--------|
| **即時性** | 作業直後に関連タスクを実行 | ファイル作成→即座に一覧更新 |
| **近接性** | 関連作業は時間的に近くに配置 | Step 5内で完結 |
| **原子性** | 分離可能な最小単位で完了 | 「作成+登録」を1セットに |

---

### ML-003: 多層防御パターン

| 項目 | 内容 |
|------|------|
| **発見日** | 2025-12-28（CS-002/CS-003の経験から） |

```
Layer 1: プロセス文書化（00_Session_Start.md）
    ↓
Layer 2: チェックリスト（憲法 付録D）
    ↓
Layer 3: 即時実行ルール（Step 5）← CS-003で追加
    ↓
Layer 4: 完了時確認（Step 8）
    ↓
Layer 5: ユーザーによる品質ゲート（レビュー）
```

**原則**:
- 単一の対策では不十分
- 複数の防御層を設ける
- 各層は独立して機能する

---

## 知見の階層構造

```
レベル3: メタ知見（プロセス設計指針）
├── ML-001: プロセス改善の反復性
├── ML-002: タイミング設計の原則
└── ML-003: 多層防御パターン

レベル2: ケーススタディ（具体的事例）
├── CS-001: 初回画面遷移図作成
├── CS-002: 更新漏れ事例と再発防止（Session 8）
├── CS-003: Step 5即時更新ルール（Session 9）
├── CS-004: 引継ぎファイル完全性チェック（Session 9）
├── CS-005: ユーザー確認スキップ違反（Session 10）
├── CS-006: Todoテンプレートと憲法の不整合（Session 11）
├── CS-007: イテレーションループ欠落（Session 11）
└── CS-008: ユーザー編集後の座標正規化（Session 11）

レベル1: 技術知見（実装詳細）
├── EX-001〜014: Excalidraw関連
├── SD-001〜007: 状態図関連
├── TD-001〜003: 技術決定
├── IC-001〜005: 整合性確認
└── LV-001〜002: 論理検証
```

---

## 更新履歴

| 日付 | Ver | 内容 |
|------|:---:|------|
| 2025-12-28 | **1.14** | **EX-013/014/CS-008追加**: テンプレートカードグリッドパターン、スクロールバー明示化、ユーザー編集後の座標正規化パターン（#10完成知見） |
| 2025-12-28 | 1.13 | EX-012追加: モーダル間リンクパターン（#09作成時知見） |
| 2025-12-28 | 1.12 | CS-007追加: イテレーションループ欠落（2箇所必須）、品質ゲートの原則・早期修正の原則を追加 |
| 2025-12-28 | 1.11 | CS-006追加: Todoテンプレートと憲法の不整合（5パスレビュー順序、知見ベース参照追加）|
| 2025-12-28 | 1.10 | CS-005追加: ユーザー確認スキップ違反（Step 6必須化）|
| 2025-12-28 | 1.9 | CS-004追加: 引継ぎファイル完全性チェック、ML-001〜003追加: メタ知見（プロセス改善の反復性、タイミング設計、多層防御）、知見の階層構造追加 |
| 2025-12-28 | 1.8 | EX-009追加: AI作成ワイヤーフレームのObsidian微調整パターン（モーダルフレーム高さ、ボタンテキスト位置） |
| 2025-12-28 | 1.7 | CS-003追加: Step 8記載だけでは不十分、即時更新ルール（Step 5）の必要性 |
| 2025-12-28 | 1.6 | CS-002追加: `00_wireframe_index.md`更新漏れ事例と再発防止策（プロセス改善知見）|
| 2025-12-27 | 1.5 | **LV-002追加（UI一貫性原則）**: C1〜C4の4原則、C2例外条件（位置づけが異なる画面）、LV-001/LV-002の関係性明記 |
| 2025-12-27 | 1.4 | **LV-001追加（UI論理的妥当性検証の原則）**: 新カテゴリ「Logical Validation知見」新設、EX-008追加（Search UI Pattern Selection Principle）、EX-008とLV-001の相互参照 |
| 2025-12-27 | 1.3 | EX-006追加（z-index問題）、EX-007追加（状態別ファイル分離パターン） |
| 2025-12-27 | 1.2 | EX-005追加（Embedded Index Pattern） |
| 2025-12-22 | 1.1 | 実体験知見追加（SD-006〜007, IC-004〜005）、CS-001追加 |
| 2025-12-22 | 1.0 | 初版作成（EX-001〜004, SD-001〜005, TD-001〜003, IC-001〜003） |
