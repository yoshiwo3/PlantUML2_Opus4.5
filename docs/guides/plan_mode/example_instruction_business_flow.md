# プランニング指示書: 業務フロー図作成

<!--
================================================================================
実例: 3.11 管理機能フロー（Phase 2）作成時に使用した指示書
このファイルをClaudeに読ませると、同等レベルのプランニングが開始されます。
================================================================================
-->

---

## Claudeへの指示

**このファイルを読んだら、以下の手順でプランニングを開始してください。**

1. `## タスク定義`セクションの内容を理解する
2. `## 参照ドキュメント`に記載されたファイルをすべて読む
3. `## 制約・ルール`を確認し、遵守事項を把握する
4. `## 確認が必要な設計決定`について、ユーザーに質問する
5. 回答を得たら、`## プラン出力フォーマット`に従ってプランを作成する
6. プランをユーザーに提示し、承認を得る

**重要**: 参照ドキュメントを読まずにプランを作成しないでください。

---

## タスク定義

### タスク名
業務フロー図 3.11「管理機能フロー（Phase 2）」を作成する

### 目的
Phase 2の管理機能（LLMワークフロー定義、Embedding管理）の業務フローを可視化し、PRD作成に必要な図表を完成させる。

### スコープ

#### 対象
- UC 5-6: LLMワークフローを定義する（LM-05）
- UC 5-9: Embeddingモデルを設定する（EM-01）
- UC 5-10: Embedding使用量を監視する（EM-02）

#### 除外（後回し）
| 項目 | 除外理由 |
|------|---------|
| UC 5-11: 学習コンテンツを登録する | RAGとの結びつきが強く、3.10学習コンテンツフローと一緒に作成すべき |
| UC 5-12: 学習コンテンツを管理する | 同上 |

### 期待する成果物
| # | 成果物 | 保存先 |
|:-:|--------|--------|
| 1 | 3.11_overview.puml | docs/evidence/YYYYMMDD_HHMM_admin_flow_phase2/ |
| 2 | 3.11.1_llm_workflow_definition.puml | 同上 |
| 3 | 3.11.2_embedding_model_setting.puml | 同上 |
| 4 | 3.11.3_embedding_usage_monitoring.puml | 同上 |
| 5 | 正式版SVG（4件） | docs/proposals/diagrams/business_flow/ |
| 6 | 業務フロー図への統合 | docs/proposals/PlantUML_Studio_業務フロー図_20251201.md |

---

## 参照ドキュメント

**Claudeへ: 以下のファイルをすべて読んでから、プランニングを開始してください。**

| # | ファイルパス | 参照目的 |
|:-:|-------------|---------|
| 1 | docs/proposals/PlantUML_Studio_業務フロー図_20251201.md | 3.9の構造・フォーマットを参照 |
| 2 | docs/proposals/PlantUML_Studio_ユースケース図_20251130.md | UC 5-6, 5-9, 5-10の定義確認 |
| 3 | docs/evidence/20251206_openrouter_research/llm_management_feature_design.md | LM-05, EM-01, EM-02の設計仕様 |
| 4 | docs/context/technical_decisions.md | TD-007（OpenRouter/OpenAI分離）確認 |
| 5 | docs/guides/PlantUML_Development_Constitution.md | PlantUML憲法v3.4の制約確認 |
| 6 | docs/context/active_context.md | 現在の進捗状況確認 |

---

## 制約・ルール

**Claudeへ: これらの制約を遵守してプランを作成してください。**

### 絶対遵守事項（PlantUML憲法より）
- if/fork/switch内でスイムレーン遷移するコードを書かない
- SVGのXMLテキストを見て視覚確認したと判断しない
- ソース+PNG対比確認をスキップしない
- Context7確認なしでPlantUMLコードを作成しない
- レビューログ未更新でPublishしない
- レビュー後に.pumlを修正してPublishしない

### 推奨事項
- 概要図+詳細図で階層化する（10ステップ以上のフローの場合）
- 複雑な内部処理はnoteで詳細説明する
- if外でスイムレーン遷移する

### 整合性要件
- 3.9管理機能フロー（MVP）と同程度の詳細度
- TD-007のOpenRouter/OpenAI分離を反映
- 既存の業務フロー図のフォーマット・命名規則に従う

---

## 確認が必要な設計決定

**Claudeへ: プランを確定する前に、以下についてユーザーに確認してください。**

### 質問1: LLMワークフローの構造
- **選択肢A（線形パイプライン）**: ステップが順番に実行される単純な構造
- **選択肢B（自由DAG構造）**: ステップを自由に接続でき、条件分岐も可能
- **選択肢C（テンプレートベース）**: 事前定義されたテンプレートから選択

### 質問2: Embeddingモデル切り替え時の再生成
- **選択肢A（必須再生成）**: モデル切り替え時は全コンテンツ再生成必須
- **選択肢B（選択可能）**: 「既存再生成」or「新規のみ」をユーザーが選択
- **選択肢C（自動判定）**: システムが差分を判定して必要分のみ再生成

### 質問3: DAGエディタのUI（質問1でDAGを選択した場合）
- UIはビジュアルノードエディタ（React Flow等）か、テキスト定義か？
- 入出力マッピングはどのように行うか？

### 質問4: 詳細度の確認
- 3.9管理機能フロー（MVP）と同程度の詳細度でよいか？
- スイムレーンは何本程度を想定するか？

---

## プラン出力フォーマット

**Claudeへ: プランを作成する際は、以下のセクションを含めてください。**

### 必須セクション

1. **基本情報**
   - 作成日
   - ステータス
   - 関連ドキュメント

2. **目的と対象**
   - 目的（なぜこのタスクを行うか）
   - 対象UCの一覧（詳細）
   - 後回しにする項目と理由

3. **参照ファイル確認結果**
   - 各ファイルから抽出した重要情報（設計仕様、データモデル等）
   - 確認済みチェック

4. **PlantUML憲法の要約**
   - 絶対禁止事項（8項目）
   - 推奨される回避策

5. **設計仕様まとめ**
   - 各UC（LM-05, EM-01, EM-02）の詳細仕様
   - データモデル（想定テーブル構造）
   - 主要フロー

6. **作成するPlantUMLフロー**
   - 概要図の構成
   - 各詳細図の構成
   - スイムレーン構成

7. **作業手順**
   - Evidenceディレクトリ作成
   - 作成順序（依存関係考慮）
   - PNG生成・レビュー手順
   - SVG生成・統合手順

8. **設計決定事項**
   - ユーザーとの対話で決定した内容
   - TD-XXX候補（技術決定として記録すべき内容）

9. **後続作業への影響**
   - クラス図への影響（新規エンティティ、サービス変更）
   - 他ドキュメントへの影響

10. **実装優先度**
    - 作業順序と理由（依存関係）

11. **次のアクション**
    - プラン承認後の最初のステップ

---

## 補足情報

### 背景・コンテキスト
- MVP業務フローは3.9で完了済み（9/9フロー）
- Phase 2の業務フロー作成に着手
- TD-007でOpenRouter（LLM）とOpenAI（Embedding）の分離が決定済み

### 関連する過去の作業
- docs/evidence/20251208_0007_admin_flow_mvp/（3.9作成時のEvidence）
- docs/evidence/20251206_openrouter_research/（OpenRouter調査）

### 注意点・リスク
- PlantUML憲法v3.4のif/switch内スイムレーン遷移禁止に注意
- 3.9作成時は10フロー中7フロー（70%）で修正が必要だった

---

## メタ情報

| 項目 | 値 |
|------|-----|
| 指示書作成日 | 2025-12-10 |
| 指示書作成者 | ユーザー |
| 対象プロジェクト | PlantUML Studio |
| 想定作業時間 | 2-3時間 |
