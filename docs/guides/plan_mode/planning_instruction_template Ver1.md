# プランモード指示書

<!--
================================================================================
使い方: このファイルをそのままClaudeに読ませてください。
「このファイルを読んで、プランニングを開始して」と指示するだけでOKです。
Claudeが必要な情報をヒアリングします。
================================================================================
-->

---

## Claudeへの指示

**このファイルを読んだら、以下の手順でプランニングを開始してください。**

### Phase 1: ヒアリング（必須）

1. **タスク定義のヒアリング**
   - `## ヒアリング項目`の質問をユーザーに投げかける
   - 回答を得るまでプランニングを開始しない

2. **追加確認（必要に応じて）**
   - ユーザーの回答から不明点があれば追加で質問する
   - 曖昧な点は確認してから進める

### Phase 2: 情報収集

3. **参照ドキュメントの読み込み**
   - ヒアリング結果から関連ドキュメントを特定
   - 必要なファイルをすべて読む（CLAUDE.md、active_context.md、関連proposals等）

4. **制約・ルールの確認**
   - プロジェクトの制約を確認
   - 適用される憲法・ガイドラインを把握

### Phase 3: プラン作成

5. **設計決定の確認**
   - 複数の選択肢がある場合はユーザーに確認
   - 技術的なトレードオフを説明

6. **プラン作成・提示**
   - `## プラン出力フォーマット`に従ってプランを作成
   - ユーザーに提示し承認を得る

**重要**: ヒアリングなしでプランを作成しないでください。

---

## ヒアリング項目

**Claudeへ: 以下の質問をユーザーに投げかけ、回答を得てください。**

### 必須質問

#### Q1: 何を作成しますか？
```
例:
- 「業務フロー図 3.10を作成したい」
- 「シーケンス図を追加したい」
- 「クラス図を更新したい」
```

#### Q2: 対象のスコープは？
```
例:
- 対象UC番号（UC 5-11, 5-12など）
- 対象機能名
- 対象画面・コンポーネント
```

#### Q3: 優先度・フェーズは？
```
例:
- MVP必須
- Phase 2
- 後回し可
```

### 任意質問（必要に応じて確認）

#### Q4: 参照すべき既存ドキュメントはありますか？
```
例:
- 「3.9と同じ形式で」
- 「docs/evidence/xxx を参考に」
- 「特になし（Claudeに任せる）」
```

#### Q5: 特別な制約・注意点はありますか？
```
例:
- 「TD-007の仕様に従う」
- 「既存の○○と整合性を保つ」
- 「特になし」
```

#### Q6: 成果物の保存先は？
```
例:
- 「デフォルト（proposalsとevidence）」
- 「指定パス: xxx」
```

---

## プラン出力フォーマット

**Claudeへ: プランを作成する際は、以下のセクションを含めてください。**

### 必須セクション

1. **基本情報**
   - 作成日
   - ステータス
   - 関連ドキュメント

2. **目的と対象**
   - 目的（なぜこのタスクを行うか）
   - 対象の一覧（詳細）
   - 後回しにする項目と理由

3. **参照ファイル確認結果**
   - 各ファイルから抽出した重要情報
   - 確認済みチェック

4. **制約・ルールの要約**
   - 絶対禁止事項
   - 推奨される回避策

5. **設計仕様まとめ**
   - 各対象の詳細仕様
   - データモデル（想定）
   - 主要フロー

6. **作成する成果物の詳細**
   - 各成果物の構成
   - 依存関係

7. **作業手順**
   - 準備作業
   - 作成順序（依存関係考慮）
   - 完了後の統合作業

8. **設計決定事項**
   - ユーザーとの対話で決定した内容
   - TD-XXX候補（技術決定として記録すべき内容）

9. **後続作業への影響**
   - 他ドキュメントへの影響
   - 更新が必要なファイル

10. **実装優先度**
    - 作業順序と理由

11. **次のアクション**
    - プラン承認後の最初のステップ

---

## デフォルト参照ドキュメント

**Claudeへ: ヒアリング後、以下は必ず確認してください。**

| # | ファイルパス | 参照目的 |
|:-:|-------------|---------|
| 1 | CLAUDE.md | プロジェクトガイド、現在の進捗 |
| 2 | docs/context/active_context.md | 現在の状況、次のタスク |
| 3 | docs/context/technical_decisions.md | 技術決定（TD-XXX）確認 |

**タスク種別ごとの追加参照:**

| タスク種別 | 追加で読むべきファイル |
|-----------|---------------------|
| 業務フロー図 | docs/proposals/03_業務フロー図_20251201.md |
| シーケンス図 | docs/proposals/08_シーケンス図_20251214.md |
| クラス図 | docs/proposals/06_クラス図_20251208.md |
| PlantUML全般 | docs/guides/PlantUML_Development_Constitution.md |

---

## デフォルト制約・ルール

**Claudeへ: 以下はプロジェクト共通の制約です。**

### PlantUML作成時の絶対禁止事項
- if/fork/switch内でスイムレーン遷移するコードを書かない
- SVGのXMLテキストを見て視覚確認したと判断しない
- ソース+PNG対比確認をスキップしない
- Context7確認なしでPlantUMLコードを作成しない

### 整合性要件
- 既存のproposals/内ドキュメントと整合性を保つ
- 命名規則・フォーマットを統一する
- アクター名・コンポーネント名を既存と一致させる

### 品質要件
- Evidence 3点セット（instructions.md, 00_raw_notes.md, work_sheet.md）を作成
- 作業完了時にactive_context.mdを更新
- SERENA Memoryに知識を永続化

---

## ヒアリング回答テンプレート

**ユーザーへ: 以下の形式で回答すると、Claudeがスムーズに理解できます。**

```markdown
### 回答

**Q1（何を作成）**:
[回答]

**Q2（スコープ）**:
[回答]

**Q3（優先度）**:
[回答]

**Q4（参照ドキュメント）**:
[回答 or Claudeに任せる]

**Q5（制約・注意点）**:
[回答 or 特になし]

**Q6（保存先）**:
[回答 or デフォルト]
```

---

## メタ情報

| 項目 | 値 |
|------|-----|
| テンプレートバージョン | 2.0 |
| 更新日 | 2025-12-11 |
| 変更内容 | ユーザー記入必須 → Claudeヒアリング方式に変更 |
