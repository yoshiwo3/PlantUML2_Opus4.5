# プランモード指示書 v3.5

## クイックリファレンス

```
┌─────────────────────────────────────────────────────────────────┐
│ Phase 0: 初期判定    → Q1-Q3の明示状況を確認                    │
│ Phase 1: ヒアリング  → 不足分を1問ずつ質問（状態をplan.mdに記録）│
│ Phase 2: 情報収集    → Read tool + Context7で参照ドキュメント読込│
│ Phase 3: プラン作成  → 規模判定→テンプレート選択→保存→承認     │
└─────────────────────────────────────────────────────────────────┘

【状態管理の原則】
- 各回答を得たら即座にplan.mdに記録（ステートレス対策）
- 中断時はplan.mdから状態を復元

【ターン終了の原則】
- 質問を出力したら、そのターンは終了（追加出力禁止）
- 1ターン = 1質問（複数質問の連続出力は禁止）
```

---

## 概要

### なぜプランニングが必要か

| 問題 | プランニングで解決 |
|------|-------------------|
| 作業途中で「何を作るか」が曖昧になる | 目的・成果物を事前に明文化 |
| 既存ドキュメントと整合性が取れない | 参照ファイルを事前に確認 |
| 作業完了の判断基準がない | 完了条件を事前に定義 |
| 手戻りが発生する | 設計決定を事前に確認 |

### プランニングの定義

**プランニング**とは、タスク実行前に以下を明確化する作業である：
- 何を作成するか（成果物）
- どのような手順で作成するか（作業手順）
- どのような制約があるか（ルール）
- 何を確認すべきか（設計決定）

### 成果物

- ファイル名: `plan.md`
- 保存先: `docs/evidence/<evidence_dir>/plan.md`
- **必ずファイルに保存**（口頭回答不可）
- **状態管理にも使用**（各回答を逐次記録）

### 全体フロー

```
[ユーザーメッセージ]
        │
        ▼
┌───────────────┐
│   Phase 0    │  初期判定（Q1-Q3明示状況を確認）
│  （必須）     │  ※既存plan.mdの有無も確認
└───────────────┘
        │
        ├─ すべて明示 ──────────────────────────┐
        │                                       │
        ▼                                       │
┌───────────────┐                               │
│   Phase 1    │  ヒアリング（不足分のみ）        │
│ （条件付き）  │  1ターン1質問方式               │
│              │  ※各回答をplan.mdに逐次記録     │
└───────────────┘                               │
        │                                       │
        │ 完了                                   │
        ▼                                       ▼
┌───────────────┐                        ┌───────────────┐
│   Phase 2    │  情報収集               │   Phase 2    │
│  （必須）     │  Read tool + Context7   │  （必須）     │
└───────────────┘                        └───────────────┘
        │                                       │
        ▼                                       │
┌───────────────┐                               │
│   Phase 3    │  プラン作成 ←──────────────────┘
│  （必須）     │  規模判定→テンプレート選択→保存
└───────────────┘
        │
        ▼
    [plan.md]
        │
        ▼
  ユーザー承認待ち
        │
        ▼
┌───────────────┐
│  プラン実行   │  承認後、タスクを実行
│  （Phase 4）  │  ※本指示書のスコープ外
└───────────────┘
```

### スコープ

**適用するタスク:**
- ドキュメント作成（図表、一覧表）
- PlantUML図表作成
- 設計作業（PRD作成、アーキテクチャ設計、DB設計、API設計）

**適用しないタスク:**
- 単純なファイル修正（typo修正、1行追加等）
- 情報検索・質問回答
- コードレビュー

---

## 核心原則（AI実行の前提）

### 原則1: ステートレス対策（状態管理）

Claudeはステートレスであり、ターン間で内部状態を保持できない。
そのため、**すべての収集情報をplan.mdに逐次記録**する。

#### 状態記録のタイミング

| イベント | 記録内容 | 記録先 |
|---------|---------|--------|
| Q1カテゴリ回答取得 | カテゴリ名 | plan.md §収集済み情報 |
| Q1詳細回答取得 | 詳細種別 | plan.md §収集済み情報 |
| Q1a回答取得 | 具体値 | plan.md §収集済み情報 |
| Q2回答取得 | スコープ指定方式 | plan.md §収集済み情報 |
| Q2a回答取得 | 具体的スコープ | plan.md §収集済み情報 |
| Q2b回答取得 | 関連/除外項目 | plan.md §収集済み情報 |
| Q3回答取得 | 優先度 | plan.md §収集済み情報 |
| Phase 2完了 | 参照ファイル一覧 | plan.md §参照ファイル |

#### 状態記録の形式

Phase 1の各回答取得後、`Write` toolで以下の形式でplan.mdに追記：

```markdown
# プラン（作成中）

## 現在のPhase
Phase 1 - ヒアリング中

## 収集済み情報

| 項目 | 値 | 取得状態 |
|------|-----|:--------:|
| Q1カテゴリ | 図表（PlantUML） | ✅ |
| Q1詳細 | 業務フロー図 | ✅ |
| Q1a | 3.10 | ✅ |
| Q2方式 | （未回答） | ⏳ |
| Q2a具体値 | （未回答） | - |
| Q2b関連/除外 | （未回答） | - |
| Q3優先度 | （未回答） | - |

## 次の質問
Q2: スコープ指定方式
```

#### 中断からの復帰

ユーザーが「プランニングを再開」と言った場合：

1. `Read` toolで `docs/evidence/*/plan.md` を検索
2. 最新のplan.mdを読み込み
3. 「収集済み情報」セクションから状態を復元
4. 「次の質問」から再開

### 原則2: 1ターン1質問（ターン終了の定義）

**ターン**とは、AIの1回の出力からユーザーの次の入力までの単位である。

#### ターン終了のルール

| 状況 | AIの動作 | 禁止事項 |
|------|---------|---------|
| 質問を出力した | **そのターンを終了**（追加出力なし） | 続けて別の質問を出力 |
| 回答を受け取った | 回答を記録→次の質問を出力→ターン終了 | 2つ以上の質問を連続出力 |
| エラーが発生した | エラー報告→対応確認→ターン終了 | エラー後に質問を続行 |

#### 正しい例

```
【ターン1】
AI: Q1カテゴリを選んでください。[AskUserQuestion]
（ターン終了 - ユーザー入力を待つ）

【ターン2】
User: 図表（PlantUML）
AI: （plan.mdに記録）Q1詳細を選んでください。[AskUserQuestion]
（ターン終了 - ユーザー入力を待つ）

【ターン3】
User: 業務フロー図
AI: （plan.mdに記録）どのフロー番号ですか？（3.1〜3.11、または新規）
（ターン終了 - ユーザー入力を待つ）
```

#### 禁止例

```
【禁止パターン】
AI: Q1カテゴリを選んでください。
    Q1詳細も選んでください。
    Q1aも教えてください。
（複数質問の連続出力は禁止）
```

### 原則3: テキスト質問の出力形式

`AskUserQuestion`ツールを使用しない「テキスト質問」は、以下の形式で出力する。

#### テキスト質問テンプレート

```
**[質問ID: Q1a]**

[質問文]

（入力例: [具体的な入力例をカンマ区切りで]）
```

#### 実例

```
**[質問ID: Q1a]**

どのフロー番号ですか？

（入力例: 3.1, 3.10, 新規）
```

```
**[質問ID: Q2a]**

具体的なUC番号を教えてください。

（入力例: UC 5-11, UC 5-12, UC 3-10 と UC 3-11）
```

```
**[質問ID: Q2b]**

以下の2点を確認させてください：

1. 他に関連するUC/機能/画面はありますか？
2. 除外すべき項目はありますか？

（なければ「なし」とお答えください）
```

---

## Claudeへの指示

**このファイルを読んだら、以下のPhaseを順に実行せよ。**

### Phase 0: 初期判定（必須）

#### Step 0-1: 既存plan.mdの確認

`Glob` toolで以下を検索：

```
パターン: docs/evidence/*/plan.md
```

| 検索結果 | 動作 |
|---------|------|
| plan.mdが存在 | 「既存のプランが見つかりました。再開しますか？新規作成しますか？」と確認 |
| plan.mdが存在しない | Step 0-2へ進む |

#### Step 0-2: Q1-Q3の明示状況を判定

ユーザーの最初のメッセージを解析し、Q1-Q3の明示状況を判定する。

#### 判定基準

| 質問 | 「明示されている」と判定する条件 |
|:----:|-------------------------------|
| Q1 | タスク種別（14種別のいずれか、または具体的な成果物名）が含まれる |
| Q2 | UC番号、機能名、画面名、または具体的な対象範囲が含まれる |
| Q3 | 「MVP」「Phase 2」「後回し」等の優先度表現が含まれる |

#### 判定例

| ユーザーメッセージ | Q1 | Q2 | Q3 | 判定 |
|------------------|:--:|:--:|:--:|------|
| 「プランニングを開始して」 | ❌ | ❌ | ❌ | → Phase 1（フルヒアリング） |
| 「業務フロー図を作成したい」 | ✅ | ❌ | ❌ | → Phase 1（Q2, Q3のみ） |
| 「業務フロー図 3.10、UC 5-11, 5-12、Phase 2」 | ✅ | ✅ | ✅ | → Phase 2（スキップ） |
| 「UC 5-11のフローをMVPで」 | ❌ | ✅ | ✅ | → Phase 1（Q1のみ） |

#### 複数タスクの判定

| ユーザーメッセージ | 判定 | 対応 |
|------------------|------|------|
| 「業務フロー図 3.10と3.11を作成」 | 同一種別×複数対象 | **1プランに統合**（成果物を複数記載） |
| 「業務フロー図3.10とシーケンス図を作成」 | 異種別×複数タスク | **優先度を確認**し、1つずつプラン作成 |

異種別の場合の確認：

```
複数のタスク種別が指定されています：
1. 業務フロー図 3.10
2. シーケンス図

どちらを先に進めますか？
```

#### 分岐ロジック

| Q1-Q3の状態 | 次のPhase |
|:-----------:|:---------:|
| すべて明示 | → Phase 2へ |
| 一部不足 | → Phase 1へ（不足分のみ） |
| すべて不足 | → Phase 1へ（フル） |

### Phase 1: ヒアリング（条件付き）

#### 実行条件

Phase 0でQ1-Q3のいずれかが不足している場合のみ実行。

#### ヒアリング方式: 1ターン1質問方式

**定義**: 1ターンで1つの質問のみを行い、回答を得てから次の質問に進む。

```
┌─────────────────────────────────────────────────────────┐
│ 【ターン1】                                              │
│   AI: Q1カテゴリ選択（AskUserQuestion）                  │
│   → ターン終了、ユーザー入力を待つ                        │
├─────────────────────────────────────────────────────────┤
│ 【ターン2】                                              │
│   User: [回答]                                          │
│   AI: plan.mdに記録 → Q1詳細選択（AskUserQuestion）      │
│   → ターン終了、ユーザー入力を待つ                        │
├─────────────────────────────────────────────────────────┤
│ 【ターン3】                                              │
│   User: [回答]                                          │
│   AI: plan.mdに記録 → Q1a深掘り（テキスト質問）          │
│   → ターン終了、ユーザー入力を待つ                        │
├─────────────────────────────────────────────────────────┤
│ ... 以下同様 ...                                         │
└─────────────────────────────────────────────────────────┘
```

**重要**:
- 各質問後、**必ずターンを終了**する（追加の質問・説明を出力しない）
- 回答を得たら、**plan.mdに記録してから**次の質問を行う

#### 質問方式の定義

| 質問ID | ツール | 形式 | 出力後の動作 |
|:------:|--------|------|-------------|
| Q1カテゴリ | `AskUserQuestion` | 選択式 | **ターン終了** |
| Q1詳細 | `AskUserQuestion` | 選択式 | **ターン終了** |
| Q1a | テキスト質問 | 自由記述 | **ターン終了** |
| Q2 | `AskUserQuestion` | 選択式 | **ターン終了** |
| Q2a | テキスト質問 | 自由記述 | **ターン終了** |
| Q2b | テキスト質問 | Yes/No＋追加情報 | **ターン終了** |
| Q3 | `AskUserQuestion` | 選択式 | **ターン終了** |
| Q3a | テキスト質問 | 自由記述（条件付き） | **ターン終了** |

#### Step 1: Q1（タスク種別）- 2段階選択

**Step 1a: Q1カテゴリ選択**

`AskUserQuestion`ツールで以下を提示：

```json
{
  "questions": [{
    "question": "何を作成しますか？カテゴリを選んでください。",
    "header": "カテゴリ",
    "options": [
      { "label": "図表（PlantUML）", "description": "業務フロー図、シーケンス図、クラス図など" },
      { "label": "一覧表", "description": "機能一覧、CRUD表、非機能要件など" },
      { "label": "UI設計", "description": "画面遷移図、ワイヤーフレーム" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**Step 1b: Q1詳細選択（カテゴリに応じて）**

回答を得たら、`Write` toolでplan.mdに記録してから次の質問を行う。

| カテゴリ | 詳細選択肢 |
|---------|-----------|
| 図表（PlantUML） | 業務フロー図 / シーケンス図 / クラス図 / DFD / ユースケース図 / コンテキスト図 / コンポーネント図 |
| 一覧表 | 機能一覧表 / CRUD表 / 外部IF一覧 / 非機能要件一覧 / アクター権限マトリクス |
| UI設計 | 画面遷移図 / ワイヤーフレーム |

`AskUserQuestion`ツール例（図表カテゴリ選択時）：

```json
{
  "questions": [{
    "question": "どの図表を作成しますか？",
    "header": "図表種別",
    "options": [
      { "label": "業務フロー図", "description": "業務プロセスの流れを可視化" },
      { "label": "シーケンス図", "description": "オブジェクト間のメッセージ交換を時系列で表現" },
      { "label": "クラス図", "description": "ドメインモデル、サービス層の構造" },
      { "label": "その他", "description": "DFD、ユースケース図、コンテキスト図、コンポーネント図" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**「その他」選択時の追加選択**（図表カテゴリの場合）:

```json
{
  "questions": [{
    "question": "具体的にどの図表ですか？",
    "header": "図表種別",
    "options": [
      { "label": "DFD", "description": "データフロー図" },
      { "label": "ユースケース図", "description": "機能要件の可視化" },
      { "label": "コンテキスト図", "description": "システム境界の定義" },
      { "label": "コンポーネント図", "description": "システムアーキテクチャ" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**Step 1c: Q1a深掘り質問（テキスト質問）**

回答を得たら、`Write` toolでplan.mdに記録してから、以下のテキスト質問を行う：

| 詳細選択 | Q1a（テキスト質問） |
|---------|----------------------|
| 業務フロー図 | **[質問ID: Q1a]**<br><br>どのフロー番号ですか？<br><br>（入力例: 3.1, 3.10, 新規） |
| シーケンス図 | **[質問ID: Q1a]**<br><br>どの機能のシーケンスですか？<br><br>（入力例: ログイン, 編集プレビュー, 保存, エクスポート, AI機能） |
| クラス図 | **[質問ID: Q1a]**<br><br>どの部分を作成/更新しますか？<br><br>（入力例: ドメインモデル, サービス層, 新規エンティティ追加） |
| DFD | **[質問ID: Q1a]**<br><br>どのレベルですか？<br><br>（入力例: Level 0, Level 1, Level 2, 特定プロセスの詳細化） |
| 機能一覧表 | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 特定機能の追加） |
| CRUD表 | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 特定エンティティの追加） |
| ユースケース図 | **[質問ID: Q1a]**<br><br>どのパッケージですか？<br><br>（入力例: 認証, プロジェクト管理, 図表操作, AI機能, 管理機能） |
| コンテキスト図 | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 外部システム追加） |
| コンポーネント図 | **[質問ID: Q1a]**<br><br>どの部分を作成しますか？<br><br>（入力例: 全体構成, 特定サブシステム, 新規コンポーネント追加） |
| 画面遷移図 | **[質問ID: Q1a]**<br><br>どの画面群ですか？<br><br>（入力例: メイン画面, 設定画面, 管理画面） |
| ワイヤーフレーム | **[質問ID: Q1a]**<br><br>どの画面のワイヤーフレームですか？<br><br>（入力例: エディタ, 新規作成, Excalidraw, バージョン履歴） |
| 外部IF一覧 | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 特定IFの追加） |
| 非機能要件一覧 | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 特定カテゴリの追加） |
| アクター権限マトリクス | **[質問ID: Q1a]**<br><br>新規作成ですか、それとも既存の更新ですか？<br><br>（入力例: 新規, 更新, 新規アクター追加） |

→ **ターン終了**（ユーザー入力を待つ）

#### Step 2: Q2（スコープ）

**Q2: スコープ指定方式（AskUserQuestion）**

回答を得たら、`Write` toolでplan.mdに記録してから次の質問を行う。

```json
{
  "questions": [{
    "question": "対象のスコープをどのように指定しますか？",
    "header": "スコープ指定",
    "options": [
      { "label": "UC番号で指定", "description": "例: UC 5-11, 5-12" },
      { "label": "機能名で指定", "description": "例: 学習コンテンツ管理" },
      { "label": "画面名で指定", "description": "例: ダッシュボード、設定画面" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**Q2a: 深掘り質問（テキスト質問）**

回答を得たら、`Write` toolでplan.mdに記録してから次の質問を行う。

| Q2の回答 | Q2a（テキスト質問） |
|---------|----------------------|
| UC番号で指定 | **[質問ID: Q2a]**<br><br>具体的なUC番号を教えてください。<br><br>（入力例: UC 5-11, UC 5-12, UC 3-10 と UC 3-11） |
| 機能名で指定 | **[質問ID: Q2a]**<br><br>具体的な機能名を教えてください。<br><br>（入力例: 学習コンテンツ管理, ユーザー認証） |
| 画面名で指定 | **[質問ID: Q2a]**<br><br>具体的な画面名を教えてください。<br><br>（入力例: ダッシュボード, 設定画面, エディタ画面） |
| その他 | **[質問ID: Q2a]**<br><br>具体的なスコープを教えてください。<br><br>（自由に記述してください） |

→ **ターン終了**（ユーザー入力を待つ）

**Q2b: 追加確認（テキスト質問）※必須**

回答を得たら、`Write` toolでplan.mdに記録してから次の質問を行う。

Q2aの回答後、以下の2点を**必ず**確認する：

```
**[質問ID: Q2b]**

以下の2点を確認させてください：

1. 他に関連するUC/機能/画面はありますか？
2. 除外すべき項目はありますか？

（なければ「なし」とお答えください）
```

→ **ターン終了**（ユーザー入力を待つ）

**回答が曖昧な場合の再確認（リトライ上限: 3回）:**

| リトライ回数 | AIの動作 |
|:------------:|---------|
| 1回目 | 「〇〇についてもう少し詳しく教えてください」 |
| 2回目 | 「〇〇と△△のどちらを優先しますか？」 |
| 3回目（上限） | 以下の形式で手動入力を許可 |

```
**[手動入力モード]**

選択肢からの回答が難しいようです。
自由に入力してください：

（例: 「UC 5-11の学習コンテンツ閲覧機能のみ、UC 5-12は除外」）
```

→ **ターン終了**（ユーザー入力を待つ）

#### Step 3: Q3（優先度）

**Q3: 優先度選択（AskUserQuestion）**

回答を得たら、`Write` toolでplan.mdに記録してから次の質問を行う。

```json
{
  "questions": [{
    "question": "優先度・フェーズはどれですか？",
    "header": "優先度",
    "options": [
      { "label": "MVP必須", "description": "最優先で実装" },
      { "label": "Phase 2", "description": "MVP後に実装" },
      { "label": "後回し可", "description": "余裕があれば実装" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**Q3a: 深掘り質問（テキスト質問）※条件付き**

以下の条件に該当する場合のみ実行：

| 条件 | Q3a（テキスト質問） |
|------|----------------------|
| Q2で複数UC/機能を指定 | **[質問ID: Q3a]**<br><br>すべて同じ優先度ですか？それとも優先順位をつけますか？<br><br>（入力例: すべて同じ, UC 5-11を先に） |
| 優先度が不明確 | **[質問ID: Q3a]**<br><br>期限や依存関係はありますか？<br><br>（入力例: なし, 〇〇の前に完了必要） |

→ 条件該当時のみ**ターン終了**（ユーザー入力を待つ）

#### Step 4: 任意質問（Q4-Q5）

**実行条件**: 以下のいずれかに該当する場合のみ実行

| 条件 | 理由 |
|------|------|
| Q1で標準14種別に該当しない | デフォルト参照では不十分 |
| ユーザーが「特殊な制約がある」と示唆 | 追加制約の把握が必要 |

| ID | 質問（テキスト） | 深掘り |
|:--:|-----------------|--------|
| Q4 | **[質問ID: Q4]**<br><br>参照すべき既存ドキュメントはありますか？<br><br>（入力例: なし, docs/proposals/〇〇.md） | 「他にも参考にしたいドキュメントはありますか？」 |
| Q5 | **[質問ID: Q5]**<br><br>特別な制約・注意点はありますか？<br><br>（入力例: なし, 既存の〇〇と整合性必要） | 「既存の〇〇との整合性は必要ですか？」 |

**Q6（保存先）は聞かない** - デフォルト値を使用

#### デフォルト値

- Q4: `## 参照ドキュメント`から自動選択
- Q5: `## 制約・ルール`を適用
- Q6: `docs/evidence/<yyyyMMdd_HHmm_task_name>/`

#### 回答の検証ルール

| 項目 | 検証内容 | 検証失敗時 | リトライ上限 |
|------|---------|-----------|:------------:|
| Q1カテゴリ | 3カテゴリのいずれか | 「カテゴリを選んでください」 | 3回 |
| Q1詳細 | カテゴリに応じた選択肢のいずれか | 「具体的な種別を選んでください」 | 3回 |
| Q1a | 具体的な値が得られたか | 「もう少し具体的に教えてください」 | 3回 |
| Q2aのUC番号 | ユースケース図に存在するか確認 | 「UC X-Xは見つかりません。正しいUC番号を確認してください」 | 3回 |
| Q3 | MVP/Phase 2/後回し可 | 「優先度を選んでください」 | 3回 |

**3回失敗時の動作**:

```
**[手動入力モード]**

3回の確認でも回答が得られませんでした。
自由に入力してください：

（入力した内容をそのまま使用します）
```

→ **ターン終了**（ユーザー入力を待つ）

入力された値はそのまま使用し、Phase 2へ進む。

#### Phase 1 → Phase 2 移行条件

以下の**すべて**を満たした場合に移行：

| # | 条件 | 確認方法 |
|:-:|------|---------|
| 1 | Q1カテゴリが確定 | plan.mdに「図表/一覧表/UI設計」のいずれかが記録されている |
| 2 | Q1詳細が確定 | plan.mdに14種別のいずれかが記録されている |
| 3 | Q1aの具体値が確定 | plan.mdに空文字・「不明」以外の値が記録されている |
| 4 | Q2aの具体値が確定 | plan.mdにUC番号、機能名、または画面名が記録されている |
| 5 | Q2bの確認が完了 | plan.mdに関連項目・除外項目の回答が記録されている（「なし」も有効） |
| 6 | Q3の優先度が確定 | plan.mdに「MVP/Phase 2/後回し可」のいずれかが記録されている |

### Phase 2: 情報収集（必須）

#### 実行内容（詳細）

**1. 共通参照ドキュメントを読む**

`Read` toolで以下のファイルを順に読み込む：

| # | ファイルパス | 読み込み失敗時 |
|:-:|-------------|---------------|
| 1 | `CLAUDE.md` | **エラー処理A**を実行 |
| 2 | `docs/context/active_context.md` | **エラー処理B**を実行 |
| 3 | `docs/context/technical_decisions.md` | **エラー処理B**を実行 |

**エラー処理A（CLAUDE.md）:**
```
CLAUDE.mdが見つかりません。

続行しますか？
1. はい（プロジェクト設定なしで続行）
2. いいえ（プランニングを中断）
```
→ **ターン終了**（ユーザー入力を待つ）

**エラー処理B（その他のファイル）:**
- plan.mdの「参照ファイル確認結果」に「❌ 未参照（ファイル未存在）」と記録
- 中断せずに続行

**2. タスク種別に応じた追加ドキュメントを読む**

`Read` toolで該当ファイルを読み込む（`## 参照ドキュメント`のマッピングに従う）

| 読み込み結果 | 動作 |
|-------------|------|
| 成功 | plan.mdの「参照ファイル確認結果」に「✅」と要点を記録 |
| ファイル未存在 | plan.mdに「❌ 未参照（ファイル未存在）」と記録し続行 |
| 読み込みエラー | **エラー処理C**を実行 |

**エラー処理C（読み込みエラー）:**
```
[ファイル名]の読み込みに失敗しました。
エラー: [エラー内容]

続行しますか？
1. はい（このファイルなしで続行）
2. いいえ（プランニングを中断）
```
→ **ターン終了**（ユーザー入力を待つ）

**3. PlantUML図表の場合は必ず追加で読む**

`Read` toolで以下を読み込む：
- `docs/guides/PlantUML_Development_Constitution.md`（PlantUML開発憲法）
- 理由: P1〜P8制約の詳細、既知の制限、必須プロセスが記載

**4. Context7で技術仕様を確認（該当時）**

以下の場合、`mcp__context7__resolve-library-id` → `mcp__context7__get-library-docs`で確認：

| 条件 | 確認内容 |
|------|---------|
| PlantUML図表作成 | PlantUMLの構文仕様（特に使用する図表タイプ） |
| シーケンス図 | シーケンス図の構文（participant, alt, loop等） |
| アクティビティ図/業務フロー図 | アクティビティ図の構文（swimlane, if, fork等） |

**5. 制約・ルールを確認**

`## 制約・ルール`セクションを参照し、適用される制約を把握

#### Phase 2 → Phase 3 移行条件

以下の**すべて**を満たした場合に移行：

| # | 条件 | 確認方法 |
|:-:|------|---------|
| 1 | CLAUDE.mdを読了 | Read tool成功、またはユーザーが続行を承認 |
| 2 | タスク種別の追加ドキュメントを読了 | Read tool成功、または「❌ 未参照」として記録済み |
| 3 | PlantUML図表の場合は開発憲法を読了 | Read tool成功（PlantUML以外はスキップ） |
| 4 | 該当時はContext7で仕様確認 | 確認完了、またはPlantUML以外でスキップ |
| 5 | 適用される制約を把握 | C1-C6、P1-P8（該当時）を確認済み |

### Phase 3: プラン作成（必須）

#### 3-1. タスク規模の判定

**客観的基準で判定する:**

| 規模 | 判定条件（すべて満たす） | テンプレート |
|:----:|------------------------|:------------:|
| **S** | 成果物1個 AND 依存ファイル0個 AND 設計決定0件 | 7セクション |
| **M** | 成果物2-3個 OR 依存ファイル1-2個 OR 設計決定1-2件 | 8セクション |
| **L** | 成果物4個以上 OR 依存ファイル3個以上 OR 設計決定3件以上 | 11セクション |

**判定フロー:**

```
成果物数をカウント
    │
    ├─ 1個 → 依存ファイル数をカウント
    │         │
    │         ├─ 0個 → 設計決定数をカウント
    │         │         │
    │         │         ├─ 0件 → S（小）
    │         │         └─ 1件以上 → M（中）
    │         │
    │         └─ 1個以上 → M（中）
    │
    ├─ 2-3個 → M（中）
    │
    └─ 4個以上 → L（大）
```

#### 3-2. 設計決定の確認

**複数の選択肢がある場合のみ**、`AskUserQuestion`ツールで確認。

**使用例（PlantUMLスキン選択時）:**

```json
{
  "questions": [{
    "question": "PlantUMLのスキンはどれを使用しますか？",
    "header": "スキン選択",
    "options": [
      { "label": "デフォルト (推奨)", "description": "PlantUML標準スキン、最も安定" },
      { "label": "aws-orange", "description": "AWSアイコン使用時に推奨" },
      { "label": "sketchy", "description": "手書き風、ラフなドラフト向け" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

**使用例（データモデル設計時）:**

```json
{
  "questions": [{
    "question": "新規エンティティの命名規則はどれに従いますか？",
    "header": "命名規則",
    "options": [
      { "label": "既存に合わせる (推奨)", "description": "PascalCase、既存エンティティと統一" },
      { "label": "ドメイン用語優先", "description": "業務用語をそのまま使用" }
    ],
    "multiSelect": false
  }]
}
```

→ **ターン終了**（ユーザー入力を待つ）

#### 3-3. Evidenceディレクトリ作成

`Bash` toolで以下を実行：

```bash
mkdir -p docs/evidence/<yyyyMMdd_HHmm_task_name>/
```

例: `mkdir -p docs/evidence/20251211_1430_business_flow_3_10/`

| 作成結果 | 動作 |
|---------|------|
| 成功 | 続行 |
| 失敗 | **エラー処理D**を実行 |

**エラー処理D（mkdir失敗）:**
```
ディレクトリ作成に失敗しました。
エラー: [エラー内容]

以下のコマンドを手動で実行してください：
mkdir -p docs/evidence/[ディレクトリ名]/

完了したら「完了」とお伝えください。
```
→ **ターン終了**（ユーザー入力を待つ）

#### 3-4. プラン作成

`## プラン出力フォーマット`に従い、判定した規模のテンプレートでプランを作成。

#### 3-5. プラン保存

`Write` toolで以下に保存：

```
保存先: docs/evidence/<evidence_dir>/plan.md
```

| 保存結果 | 動作 |
|---------|------|
| 成功 | 続行 |
| 1回目失敗 | リトライ（Write tool再実行） |
| 2回目失敗 | **エラー処理E**を実行 |

**エラー処理E（Write失敗）:**
```
プランの保存に失敗しました。

以下のプラン内容をコピーして、手動で保存してください：

---
[プラン内容全文]
---

保存先: docs/evidence/[ディレクトリ名]/plan.md

完了したら「完了」とお伝えください。
```
→ **ターン終了**（ユーザー入力を待つ）

#### 3-6. ユーザー承認

プランを提示し確認：

```
プランを作成しました。

**保存先**: docs/evidence/[ディレクトリ名]/plan.md

このプランで進めてよいですか？
- はい → プラン実行を開始します
- 修正 → 修正点を教えてください
- やり直し → 最初からヒアリングをやり直します
```

→ **ターン終了**（ユーザー入力を待つ）

#### 3-7. 修正対応（必要時）

ユーザーから修正要望があった場合：

| ステップ | 動作 |
|---------|------|
| 1 | 要望内容を確認 |
| 2 | プランを修正（`Edit` toolでplan.mdを更新） |
| 3 | 差分を説明して再提示 |
| 4 | 承認されるまで繰り返し（**上限: 5回**） |
| 5 | 5回超過時: 以下を出力 |

```
修正回数が5回を超えました。

どうしますか？
1. 現在のプランで進める
2. 最初からヒアリングをやり直す
3. プランニングを中断する
```

→ **ターン終了**（ユーザー入力を待つ）

#### 3-8. プラン承認後の接続

プランが承認されたら、以下を出力してプランニングを完了：

```
プランが承認されました。

**次のステップ**:
1. Evidenceディレクトリに`instructions.md`を作成
2. プランに従ってタスクを実行
3. 作業中は`00_raw_notes.md`に記録
4. 完了後に`work_sheet.md`を作成

タスク実行を開始しますか？
```

→ **ターン終了**（ユーザー入力を待つ）

**「はい」の場合**: プランに従ってタスク実行を開始（本指示書のスコープ外）

**「いいえ」の場合**: 「承知しました。準備ができたらお知らせください。」と応答

---

## 例外処理

### ユーザーによる中断

| ユーザー発言パターン | AI動作 |
|---------------------|--------|
| 「やめる」「キャンセル」「中断」「止めて」 | 「プランニングを中断します。再開する場合は『プランニングを再開』とお伝えください。」と応答し、**ターン終了** |
| 「後で」「また今度」「今は無理」 | 「承知しました。再開時は『プランニングを再開』とお伝えください。」と応答し、**ターン終了** |
| 「わからない」「決められない」（3回連続） | 「判断が難しいようですね。一旦中断して、情報が揃ってから再開しましょうか？」と確認し、**ターン終了** |

### 参照ドキュメントエラー

| エラー種別 | AI動作 |
|-----------|--------|
| CLAUDE.mdが存在しない | **エラー処理A**を実行 |
| その他のファイルが存在しない | plan.mdに「❌ 未参照（ファイル未存在）」と記録し、続行 |
| ファイル読み込みエラー | **エラー処理C**を実行 |

### 回答検証エラー

| エラー種別 | AI動作 | リトライ上限 |
|-----------|--------|:------------:|
| 選択肢以外の回答 | 選択肢を再提示し、「上記から選んでください」 | 3回 |
| UC番号が存在しない | 「UC X-Xは見つかりません。ユースケース図で確認してください」 | 3回 |
| 空の回答・無回答 | 「回答が確認できませんでした。もう一度お願いします」 | 3回 |
| **3回失敗時** | **[手動入力モード]**に移行（上記参照） | - |

### ツール実行エラー

| エラー種別 | AI動作 |
|-----------|--------|
| AskUserQuestion失敗 | テキスト質問にフォールバック（以下の形式） |
| Read tool失敗 | **エラー処理B**または**エラー処理C**を実行 |
| Write tool失敗 | リトライ1回。失敗継続時は**エラー処理E**を実行 |
| Bash tool失敗（mkdir） | **エラー処理D**を実行 |

**AskUserQuestionフォールバック形式:**

```
**[質問ID: Q1カテゴリ]**

ツールエラーが発生したため、テキストで質問します。

何を作成しますか？以下から番号で選んでください：
1. 図表（PlantUML） - 業務フロー図、シーケンス図、クラス図など
2. 一覧表 - 機能一覧、CRUD表、非機能要件など
3. UI設計 - 画面遷移図、ワイヤーフレーム

（入力例: 1, 2, 3）
```

→ **ターン終了**（ユーザー入力を待つ）

### プランニング再開

ユーザーが「プランニングを再開」と言った場合：

**Step 1**: `Glob` toolで `docs/evidence/*/plan.md` を検索

**Step 2**: 最新のplan.mdを`Read` toolで読み込み

**Step 3**: 以下を出力

```
前回のプランニング状態を確認しました。

**前回の状態**:
- Phase: [Phase X]
- 収集済み情報: [Q1〜QXまで完了]
- 次の質問: [QY]

どうしますか？
1. 続きから再開する
2. 最初からやり直す
```

→ **ターン終了**（ユーザー入力を待つ）

**「続きから再開」の場合**: plan.mdの「次の質問」から再開

**「最初からやり直す」の場合**: 既存のplan.mdを削除し、Phase 0から開始

---

## 参照ドキュメント

### 共通参照（必須）

| # | ファイルパス | 参照目的 | ツール |
|:-:|-------------|---------|:------:|
| 1 | CLAUDE.md | プロジェクトガイド、進捗 | `Read` |
| 2 | docs/context/active_context.md | 現在の状況 | `Read` |
| 3 | docs/context/technical_decisions.md | 技術決定（TD-XXX） | `Read` |

### タスク種別ごとの追加参照

| # | タスク種別 | 追加で読むファイル | ツール |
|:-:|-----------|-------------------|:------:|
| 1 | 業務フロー図 | `docs/proposals/PlantUML_Studio_業務フロー図_20251201.md` | `Read` |
| 2 | シーケンス図 | `docs/proposals/PlantUML_Studio_シーケンス図_ログイン_20251130.md` | `Read` |
| 3 | クラス図 | `docs/proposals/PlantUML_Studio_クラス図_20251208.md` | `Read` |
| 4 | DFD | `docs/proposals/PlantUML_Studio_データフロー図_20251208.md` | `Read` |
| 5 | 機能一覧表 | `docs/proposals/PlantUML_Studio_機能一覧表_20251208.md` | `Read` |
| 6 | CRUD表 | `docs/proposals/PlantUML_Studio_CRUD表_20251209.md` | `Read` |
| 7 | ユースケース図 | `docs/proposals/PlantUML_Studio_ユースケース図_20251130.md` | `Read` |
| 8 | コンテキスト図 | `docs/proposals/PlantUML_Studio_コンテキスト図_20251130.md` | `Read` |
| 9 | コンポーネント図 | `docs/design/PlantUML_Studio_設計図表_20251130.md` §1 | `Read` |
| 10 | 画面遷移図 | `docs/design/PlantUML_Studio_設計図表_20251130.md` §6 | `Read` |
| 11 | ワイヤーフレーム | `docs/design/PlantUML_Studio_設計図表_20251130.md` §5 | `Read` |
| 12 | 外部IF一覧 | `docs/design/PlantUML_Studio_設計図表_20251130.md` §11 | `Read` |
| 13 | 非機能要件一覧 | IPA非機能要求グレード | `WebSearch` |
| 14 | アクター権限マトリクス | `docs/design/PlantUML_Studio_設計図表_20251130.md` §9.2 | `Read` |

### PlantUML図表作成時の追加参照（必須）

| # | ファイルパス | 参照目的 | ツール |
|:-:|-------------|---------|:------:|
| 1 | `docs/guides/PlantUML_Development_Constitution.md` | **PlantUML開発憲法**: 禁止事項、既知制限、必須プロセス | `Read` |

**読むタイミング**: Phase 2で、タスク種別の追加参照を読んだ後

### Context7での仕様確認（PlantUML図表作成時）

| # | 確認内容 | Context7クエリ |
|:-:|---------|---------------|
| 1 | PlantUML基本構文 | `mcp__context7__resolve-library-id` → `plantuml` |
| 2 | 図表タイプ別構文 | `mcp__context7__get-library-docs` → topic: `[図表タイプ]` |

---

## 制約・ルール

### 共通制約（全タスク適用）

| # | 制約 | 説明 |
|:-:|------|------|
| C1 | `docs/proposals/`内ドキュメントと整合性を保つ | アクター名、コンポーネント名、用語を統一 |
| C2 | 命名規則・フォーマットを既存に統一 | 既存ファイルのスタイルを踏襲 |
| C3 | アクター名・コンポーネント名を既存と一致 | ユースケース図、コンテキスト図と照合 |
| C4 | Evidence 3点セット作成 | instructions.md, 00_raw_notes.md, work_sheet.md |
| C5 | 作業完了時に`active_context.md`を更新 | 進捗、次のステップを反映 |
| C6 | SERENA Memoryに知識を永続化 | セッション終了時に`write_memory` |

### PlantUML固有制約（PlantUML図表作成時のみ）

| # | 制約 | 説明 |
|:-:|------|------|
| P1 | if/fork/switch内でスイムレーン遷移禁止 | 70%の確率でレンダリングエラー発生 |
| P2 | SVGのXMLテキストで視覚確認禁止 | 視覚的確認はPNG画像で行う |
| P3 | ソース+PNG対比確認必須 | 4パス方式でレビュー |
| P4 | Context7確認なしでコード作成禁止 | 仕様確認後にコーディング |
| P5 | レビューログ未更新でPublish禁止 | レビュー証跡を残す |
| P6 | レビュー後の.puml修正してPublish禁止 | 修正したら再レビュー必須 |
| P7 | ソースコードから接続を推測して✅禁止 | PNG画像で視覚確認 |
| P8 | PNGと.pumlを同時に読み込み禁止 | 確証バイアス防止 |

---

## プラン出力フォーマット

### S（小）タスク用：7セクション版

```markdown
# プラン: [タスク名]

## 1. 基本情報

| 項目 | 値 |
|------|-----|
| 作成日 | YYYY-MM-DD |
| タスク規模 | S（小） |
| Evidence | docs/evidence/[dir]/ |

## 2. 目的と対象

| 項目 | 内容 |
|------|------|
| 目的 | [なぜこのタスクを行うか] |
| 対象 | [具体的な対象] |
| 除外 | [対象外とその理由] |

## 3. 参照ファイル確認結果

| # | ファイル | 状態 | 抽出した重要情報 |
|:-:|---------|:----:|-----------------|
| 1 | CLAUDE.md | ✅/❌ | [プロジェクト進捗、関連タスク状況] |
| 2 | active_context.md | ✅/❌ | [現在の状況、依存関係] |
| 3 | [タスク固有ファイル] | ✅/❌ | [要点] |

## 4. 適用される制約

| 種別 | 適用制約 |
|------|---------|
| 共通 | C1, C2, C3, C4, C5, C6 |
| PlantUML | P1〜P8（該当時） |

## 5. 成果物

| # | 成果物 | 保存先 |
|:-:|--------|--------|
| 1 | [ファイル名] | [パス] |

## 6. 作業手順

1. [手順1]
2. [手順2]
3. [手順3]

## 7. 次のアクション

| 項目 | 内容 |
|------|------|
| プラン承認後 | [最初のステップ] |
```

### M（中）タスク用：8セクション版

```markdown
# プラン: [タスク名]

## 1. 基本情報

| 項目 | 値 |
|------|-----|
| 作成日 | YYYY-MM-DD |
| タスク規模 | M（中） |
| Evidence | docs/evidence/[dir]/ |

## 2. 目的と対象

| 項目 | 内容 |
|------|------|
| 目的 | [なぜこのタスクを行うか] |
| 対象 | [具体的な対象] |
| 除外 | [対象外とその理由] |

## 3. 参照ファイル確認結果

| # | ファイル | 状態 | 抽出した重要情報 |
|:-:|---------|:----:|-----------------|
| 1 | CLAUDE.md | ✅/❌ | [プロジェクト進捗、関連タスク状況] |
| 2 | active_context.md | ✅/❌ | [現在の状況、依存関係] |
| 3 | technical_decisions.md | ✅/❌ | [関連するTD-XXX] |
| 4 | [タスク固有ファイル] | ✅/❌ | [要点] |

## 4. 適用される制約

| 種別 | 適用制約 | 特記事項 |
|------|---------|---------|
| 共通 | C1, C2, C3, C4, C5, C6 | - |
| PlantUML | P1〜P8（該当時） | [タスク固有の注意点] |

## 5. 成果物の詳細

| # | 成果物 | 構成 | 保存先 |
|:-:|--------|------|--------|
| 1 | [ファイル名] | [構成要素] | [パス] |

## 6. 作業手順

### 準備
1. [準備手順]

### 作成
1. [作成手順]

### 統合
1. [統合手順]

## 7. 設計決定事項

| # | 決定事項 | 選択肢 | 決定 | 理由 |
|:-:|---------|--------|------|------|
| 1 | [テーマ] | A / B / C | [選択] | [理由] |

## 8. 次のアクション

| 項目 | 内容 |
|------|------|
| プラン承認後 | [最初のステップ] |
| 後続作業 | [影響を受けるドキュメント] |
```

### L（大）タスク用：11セクション版

```markdown
# プラン: [タスク名]

## 1. 基本情報

| 項目 | 値 |
|------|-----|
| 作成日 | YYYY-MM-DD |
| タスク規模 | L（大） |
| Evidence | docs/evidence/[dir]/ |

## 2. 目的と対象

| 項目 | 内容 |
|------|------|
| 目的 | [なぜこのタスクを行うか] |
| 対象 | [具体的な対象] |
| 除外 | [対象外とその理由] |

## 3. 参照ファイル確認結果

| # | ファイル | 状態 | 抽出した重要情報 |
|:-:|---------|:----:|-----------------|
| 1 | CLAUDE.md | ✅/❌ | [プロジェクト進捗、関連タスク状況] |
| 2 | active_context.md | ✅/❌ | [現在の状況、依存関係] |
| 3 | technical_decisions.md | ✅/❌ | [関連するTD-XXX] |
| 4 | [タスク固有ファイル1] | ✅/❌ | [要点] |
| 5 | [タスク固有ファイル2] | ✅/❌ | [要点] |

## 4. 適用される制約

### 共通制約
- C1: `docs/proposals/`内ドキュメントと整合性を保つ
- C2: 命名規則・フォーマットを既存に統一
- C3: アクター名・コンポーネント名を既存と一致
- C4: Evidence 3点セット作成
- C5: 作業完了時に`active_context.md`を更新
- C6: SERENA Memoryに知識を永続化

### PlantUML制約（該当時）
- P1: if/fork/switch内でスイムレーン遷移禁止
- [他の該当するP制約を列挙]

### 禁止事項
- [具体的な禁止事項をタスクに応じて記載]

## 5. 設計仕様まとめ

### データモデル

| エンティティ | 主要属性 | 関連 |
|-------------|---------|------|
| [エンティティ名] | [属性リスト] | [関連エンティティ] |

### 主要フロー

```
[開始] → [処理1] → [処理2] → [終了]
         ↓
      [分岐処理]
```

### 依存関係

| 依存元 | 依存先 | 依存内容 |
|--------|--------|---------|
| [本タスク成果物] | [他ドキュメント] | [参照/更新の内容] |

## 6. 成果物の詳細

| # | 成果物 | 構成 | 依存 | 保存先 |
|:-:|--------|------|------|--------|
| 1 | [ファイル名] | [構成要素] | [依存先] | [パス] |

## 7. 作業手順

### Phase 1: 準備
1. [準備手順]

### Phase 2: 作成（依存順）
1. [作成手順1] ← 依存なし
2. [作成手順2] ← 1に依存

### Phase 3: レビュー・統合
1. [レビュー手順]
2. [統合手順]

## 8. 設計決定事項

| # | 決定事項 | 選択肢 | 決定 | 理由 | TD候補 |
|:-:|---------|--------|------|------|:------:|
| 1 | [テーマ] | A / B / C | [選択] | [理由] | ✅ / - |

## 9. 後続作業への影響

| # | 影響を受けるドキュメント | 影響内容 | 対応 |
|:-:|------------------------|---------|------|
| 1 | [ファイル名] | [影響] | [対応方法] |

## 10. リスクと対策

| # | リスク | 確率 | 影響 | 対策 |
|:-:|--------|:----:|:----:|------|
| 1 | [リスク] | 高/中/低 | 高/中/低 | [対策] |

## 11. 次のアクション

| 項目 | 内容 |
|------|------|
| プラン承認後 | [最初のステップ] |
| チェックポイント | [中間確認タイミング] |
| 完了条件 | [何をもって完了とするか] |
```

---

## メタ情報

| 項目 | 値 |
|------|-----|
| バージョン | 3.5 |
| 更新日 | 2025-12-11 |

### バージョン履歴

| Ver | 日付 | 変更内容 |
|:---:|------|---------|
| 1.0 | 2025-12-10 | 初版（ユーザー記入必須方式） |
| 2.0 | 2025-12-11 | Claudeヒアリング方式に変更 |
| 3.0 | 2025-12-11 | 厳格評価に基づく全面改訂 |
| 3.1 | 2025-12-11 | 再評価に基づく問題点解消 |
| 3.2 | 2025-12-11 | 段階的質問＋深掘り方式に変更 |
| 3.3 | 2025-12-11 | 厳格評価フィードバック反映（全問題点解消） |
| 3.4 | 2025-12-11 | AI向け指示書観点での全面改訂（決定論的実行可能性向上） |
| 3.5 | 2025-12-11 | **厳格評価78点→90点以上を目指した全問題点解消** |

### v3.5での改善点

| # | 問題（v3.4） | 対応（v3.5） |
|:-:|-------------|-------------|
| 1 | 状態管理の欠如（ステートレス未考慮） | **核心原則1: 状態管理**を新設。plan.mdへの逐次記録方式を詳細定義 |
| 2 | 「ユーザー応答を待つ」の技術的不明瞭さ | **核心原則2: 1ターン1質問**を新設。ターン終了の定義を明確化 |
| 3 | テキスト質問の出力形式が未定義 | **核心原則3: テキスト質問の出力形式**を新設。テンプレートと実例を追加 |
| 4 | 複数タスクの同時指定への対応がない | **Phase 0: 複数タスクの判定**を追加。同一種別/異種別の扱いを定義 |
| 5 | Phase 2でのContext7使用指示がない | **Phase 2: Context7での仕様確認**を追加 |
| 6 | plan.mdの更新手順が曖昧 | **Phase 3-7: 修正対応**を詳細化。Edit tool使用を明記 |
| 7 | プラン実行後のフローへの接続がない | **Phase 3-8: プラン承認後の接続**を追加 |
| 8 | AskUserQuestion失敗時の具体例がない | **ツール実行エラー: AskUserQuestionフォールバック形式**を追加 |
| 9 | 「3回失敗時は手動入力を許可」の出力形式が不明 | **[手動入力モード]**の出力形式を定義 |
| 10 | プラン修正5回超過後の処理が曖昧 | **Phase 3-7: 5回超過時の選択肢**を明確化 |
| 11 | 参照ファイル確認結果に状態列がない | プラン出力フォーマットに**状態列（✅/❌）**を追加 |
| 12 | 既存プランがある場合の扱いが不明 | **Phase 0-1: 既存plan.mdの確認**を追加 |
| 13 | タスク規模の判定ロジックが主観的 | **Phase 3-1: タスク規模の判定**を客観的基準（成果物数/依存ファイル数/設計決定数）に変更 |
| 14 | クイックリファレンスがない | **冒頭にクイックリファレンス**を追加 |
| 15 | Readエラー時の「続行確認」方法が不明 | **エラー処理A/B/C**を詳細定義 |
